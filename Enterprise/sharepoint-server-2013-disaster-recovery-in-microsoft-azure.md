---
title: Recuperación ante desastres de SharePoint Server 2013 en Microsoft Azure
ms.author: bcarter
author: brendacarter
manager: laurawi
ms.date: 04/17/2018
audience: ITPro
ms.topic: article
ms.service: o365-solutions
localization_priority: Normal
search.appverid:
- MET150
ms.collection: Ent_O365
f1.keywords:
- CSH
ms.custom: Ent_Deployment
ms.assetid: e9d14cb2-ff28-4a18-a444-cebf891880ea
description: 'Resumen: con Azure, puede crear un entorno de recuperación ante desastres para la granja de servidores local de SharePoint. En este artículo se describe cómo diseñar e implementar esta solución.'
ms.openlocfilehash: d9d17ca3357e3297a0cfba2a764cb0468fd1a0ed
ms.sourcegitcommit: 99411927abdb40c2e82d2279489ba60545989bb1
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/07/2020
ms.locfileid: "41841187"
---
# <a name="sharepoint-server-2013-disaster-recovery-in-microsoft-azure"></a><span data-ttu-id="06661-104">Recuperación ante desastres de SharePoint Server 2013 en Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="06661-104">SharePoint Server 2013 Disaster Recovery in Microsoft Azure</span></span>

 <span data-ttu-id="06661-p102">**Resumen:** con Azure, puede crear un entorno de recuperación ante desastres para la granja de servidores local de SharePoint. En este artículo se describe cómo diseñar e implementar esta solución.</span><span class="sxs-lookup"><span data-stu-id="06661-p102">**Summary:** Using Azure, you can create a disaster-recovery environment for your on-premises SharePoint farm. This article describes how to design and implement this solution.</span></span>

 <span data-ttu-id="06661-107">**Ver el vídeo de información general sobre la recuperación ante desastres de SharePoint Server 2013**</span><span class="sxs-lookup"><span data-stu-id="06661-107">**Watch the SharePoint Server 2013 disaster recovery overview video**</span></span>
> [!VIDEO https://www.microsoft.com/videoplayer/embed/1b73ec8f-29bd-44eb-aa3a-f7932784bfd9?autoplay=false]
  
 <span data-ttu-id="06661-p103">Cuando se produce un desastre en el entorno local de SharePoint, la prioridad es que el sistema vuelva a funcionar lo antes posible. La recuperación ante desastres con SharePoint es más fácil y rápida cuando ya tiene un entorno de copia de seguridad que ya se está ejecutando en Microsoft Azure. En este vídeo se explican los conceptos principales de un entorno de conmutación por error activo de SharePoint y complementa los detalles que se ofrecen en este artículo.</span><span class="sxs-lookup"><span data-stu-id="06661-p103">When disaster strikes your SharePoint on-premises environment, your top priority is to get the system running again quickly. Disaster recovery with SharePoint is quicker and easier when you have a backup environment already running in Microsoft Azure. This video explains the main concepts of a SharePoint warm failover environment and complements the full details available in this article.</span></span>
  
<span data-ttu-id="06661-111">Use este artículo con el modelo de solución: **recuperación ante desastres de SharePoint en Microsoft Azure**.</span><span class="sxs-lookup"><span data-stu-id="06661-111">Use this article with the following solution model: **SharePoint Disaster Recovery in Microsoft Azure**.</span></span>
  
<span data-ttu-id="06661-112">[![Proceso de recuperación ante desastres de SharePoint a Azure](media/SP-DR-Azure.png)](https://go.microsoft.com/fwlink/p/?LinkId=392555)</span><span class="sxs-lookup"><span data-stu-id="06661-112">[![SharePoint disaster-recovery process to Azure](media/SP-DR-Azure.png)](https://go.microsoft.com/fwlink/p/?LinkId=392555)</span></span>
  
 <span data-ttu-id="06661-113">[PDF](https://go.microsoft.com/fwlink/p/?LinkId=392555) |  [Visio](https://go.microsoft.com/fwlink/p/?LinkId=392554)</span><span class="sxs-lookup"><span data-stu-id="06661-113">[PDF](https://go.microsoft.com/fwlink/p/?LinkId=392555) |  [Visio](https://go.microsoft.com/fwlink/p/?LinkId=392554)</span></span>
  
## <a name="use-azure-infrastructure-services-for-disaster-recovery"></a><span data-ttu-id="06661-114">Usar Servicios de infraestructura de Azure para recuperación ante desastres</span><span class="sxs-lookup"><span data-stu-id="06661-114">Use Azure Infrastructure Services for disaster recovery</span></span>

<span data-ttu-id="06661-p104">Muchas organizaciones no disponen de un entorno de recuperación ante desastres para SharePoint, ya que puede resultar caro crearlo y mantenerlo en la instalación local. Servicios de infraestructura de Azure ofrece opciones atractivas para entornos de recuperación ante desastres que son más flexibles y económicas que las alternativas en instalación local.</span><span class="sxs-lookup"><span data-stu-id="06661-p104">Many organizations do not have a disaster recovery environment for SharePoint, which can be expensive to build and maintain on-premises. Azure Infrastructure Services provides compelling options for disaster recovery environments that are more flexible and less expensive than the on-premises alternatives.</span></span>
  
<span data-ttu-id="06661-117">Entre las ventajas de usar Servicios de infraestructura de Azure se incluyen:</span><span class="sxs-lookup"><span data-stu-id="06661-117">The advantages for using Azure Infrastructure Services include:</span></span>
  
- <span data-ttu-id="06661-p105">**Menos recursos costosos**: se mantienen y pagan menos recursos que en los entornos locales de recuperación ante desastres. El número de recursos depende de qué entorno de recuperación ante desastres elija: espera activa, semiactiva o pasiva.</span><span class="sxs-lookup"><span data-stu-id="06661-p105">**Fewer costly resources** Maintain and pay for fewer resources than on-premises disaster recovery environments. The number of resources depends on which disaster-recovery environment you choose: cold standby, warm standby, or hot standby.</span></span>
    
- <span data-ttu-id="06661-p106">**Mayor flexibilidad de recursos**: cuando se produce un desastre, puede escalar horizontalmente la granja de servidores de recuperación de SharePoint para cumplir los requisitos locales. Cuando ya no necesite los recursos, puede reducirlos horizontalmente.</span><span class="sxs-lookup"><span data-stu-id="06661-p106">**Better resource flexibility** In the event of a disaster, easily scale out your recovery SharePoint farm to meet load requirements. Scale in when you no longer need the resources.</span></span>
    
- <span data-ttu-id="06661-122">**Reducir el compromiso de los centros de datos** Use Servicios de infraestructura de Azure en lugar de invertir en un segundo centro de datos en una región distinta.</span><span class="sxs-lookup"><span data-stu-id="06661-122">**Lower datacenter commitment** Use Azure Infrastructure Services instead of investing in a secondary datacenter in a different region.</span></span>
    
<span data-ttu-id="06661-p107">Existen opciones menos completas para organizaciones que acaban de empezar con la recuperación ante desastres y opciones avanzadas para organizaciones con requisitos de alta resistencia. Las definiciones de entornos de espera activa, semiactiva y pasiva son algo diferentes cuando el entorno se hospeda en una plataforma en la nube. En esta tabla se describen estos entornos para crear una granja de servidores de recuperación de SharePoint en Azure.</span><span class="sxs-lookup"><span data-stu-id="06661-p107">There are less-complex options for organizations just getting started with disaster recovery and advanced options for organizations with high-resilience requirements. The definitions for cold, warm, and hot standby environments are a little different when the environment is hosted on a cloud platform. The following table describes these environments for building a SharePoint recovery farm in Azure.</span></span>
  
<span data-ttu-id="06661-126">**Tabla: Entornos de recuperación**</span><span class="sxs-lookup"><span data-stu-id="06661-126">**Table: Recovery environments**</span></span>

|<span data-ttu-id="06661-127">**Tipo de entorno de recuperación**</span><span class="sxs-lookup"><span data-stu-id="06661-127">**Type of recovery environment**</span></span>|<span data-ttu-id="06661-128">**Descripción**</span><span class="sxs-lookup"><span data-stu-id="06661-128">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="06661-129">Activa</span><span class="sxs-lookup"><span data-stu-id="06661-129">Hot</span></span>  <br/> |<span data-ttu-id="06661-130">Se aprovisiona, actualiza y ejecuta una granja completa en modo de espera.</span><span class="sxs-lookup"><span data-stu-id="06661-130">A fully sized farm is provisioned, updated, and running on standby.</span></span>  <br/> |
|<span data-ttu-id="06661-131">Semiactiva</span><span class="sxs-lookup"><span data-stu-id="06661-131">Warm</span></span>  <br/> |<span data-ttu-id="06661-132">Se crea la granja de servidores y se ponen en marcha y actualizan las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="06661-132">The farm is built and virtual machines are running and updated.</span></span>  <br/> <span data-ttu-id="06661-133">La recuperación incluye adjuntar bases de datos de contenido, aprovisionar aplicaciones de servicio y rastrear contenido.</span><span class="sxs-lookup"><span data-stu-id="06661-133">Recovery includes attaching content databases, provisioning service applications, and crawling content.</span></span>  <br/> <span data-ttu-id="06661-134">La granja de servidores puede ser una versión reducida de la granja de servidores de producción y más adelante se puede escalar horizontalmente para atender a la base completa de usuarios.</span><span class="sxs-lookup"><span data-stu-id="06661-134">The farm can be a smaller version of the production farm and then scaled out to serve the full user base.</span></span>  <br/> |
|<span data-ttu-id="06661-135">Pasiva</span><span class="sxs-lookup"><span data-stu-id="06661-135">Cold</span></span>  <br/> |<span data-ttu-id="06661-136">La granja de servidores se ha creado por completo, pero las máquinas virtuales están detenidas.</span><span class="sxs-lookup"><span data-stu-id="06661-136">The farm is fully built, but the virtual machines are stopped.</span></span>  <br/> <span data-ttu-id="06661-137">Para realizar el mantenimiento del entorno, hay que iniciar las máquinas virtuales de vez en cuando, revisar, actualizar y comprobar el entorno.</span><span class="sxs-lookup"><span data-stu-id="06661-137">Maintaining the environment includes starting the virtual machines from time to time, patching, updating, and verifying the environment.</span></span>  <br/> <span data-ttu-id="06661-138">En caso de desastre, inicie el entorno completo.</span><span class="sxs-lookup"><span data-stu-id="06661-138">Start the full environment in the event of a disaster.</span></span>  <br/> |
   
<span data-ttu-id="06661-p108">Es importante evaluar los objetivos de tiempo de recuperación y los objetivos de punto de recuperación (RPO) de la organización. Estos requisitos determinan qué entorno es la inversión más adecuada para su organización.</span><span class="sxs-lookup"><span data-stu-id="06661-p108">It's important to evaluate your organization's Recovery Time Objectives (RTOs) and Recovery Point Objectives (RPOs). These requirements determine which environment is the most appropriate investment for your organization.</span></span>
  
<span data-ttu-id="06661-p109">En este artículo se explica cómo implementar un entorno de espera semiactiva. También puede adaptarlo a un entorno de espera pasiva, pero tendrá que realizar otros procedimientos adicionales para admitir este tipo de entorno. En este artículo no se describe cómo implementar un entorno de espera activa.</span><span class="sxs-lookup"><span data-stu-id="06661-p109">The guidance in this article describes how to implement a warm standby environment. You can also adapt it to a cold standby environment, although you need to follow additional procedures to support this kind of environment. This article does not describe how to implement a hot standby environment.</span></span>
  
<span data-ttu-id="06661-144">Para obtener más información sobre las soluciones de recuperación ante desastres, consulte [High availability and disaster recovery concepts in SharePoint 2013](https://go.microsoft.com/fwlink/p/?LinkID=393114) y [Choose a disaster recovery strategy for SharePoint 2013](https://go.microsoft.com/fwlink/p/?linkid=203228).</span><span class="sxs-lookup"><span data-stu-id="06661-144">For more information about disaster recovery solutions, see [High availability and disaster recovery concepts in SharePoint 2013](https://go.microsoft.com/fwlink/p/?LinkID=393114) and [Choose a disaster recovery strategy for SharePoint 2013](https://go.microsoft.com/fwlink/p/?linkid=203228).</span></span>
  
## <a name="solution-description"></a><span data-ttu-id="06661-145">Descripción de la solución</span><span class="sxs-lookup"><span data-stu-id="06661-145">Solution description</span></span>

<span data-ttu-id="06661-146">Para la solución de recuperación ante desastres de espera semiactiva se requiere este entorno:</span><span class="sxs-lookup"><span data-stu-id="06661-146">The warm standby disaster-recovery solution requires the following environment:</span></span>
  
- <span data-ttu-id="06661-147">Una granja de servidores de producción de SharePoint local</span><span class="sxs-lookup"><span data-stu-id="06661-147">An on-premises SharePoint production farm</span></span>
    
- <span data-ttu-id="06661-148">Una granja de servidores de recuperación de SharePoint en Azure</span><span class="sxs-lookup"><span data-stu-id="06661-148">A recovery SharePoint farm in Azure</span></span>
    
- <span data-ttu-id="06661-149">Una conexión VPN de sitio a sitio entre los dos entornos</span><span class="sxs-lookup"><span data-stu-id="06661-149">A site-to-site VPN connection between the two environments</span></span>
    
<span data-ttu-id="06661-150">En esta ilustración se muestran estos tres elementos.</span><span class="sxs-lookup"><span data-stu-id="06661-150">The following figure illustrates these three elements.</span></span>
  
<span data-ttu-id="06661-151">**Ilustración: Elementos de una solución en estado de espera semiactiva en Azure**</span><span class="sxs-lookup"><span data-stu-id="06661-151">**Figure: Elements of a warm standby solution in Azure**</span></span>

![Elementos de una solución de espera semiactiva de SharePoint en Azure](media/AZarch-AZWarmStndby.png)
  
<span data-ttu-id="06661-153">El trasvase de registros de SQL Server con la Replicación del sistema de archivos distribuido (DFSR) se usa para copiar las copias de seguridad de bases de datos y los registros de transacciones en la granja de servidores de recuperación en Azure:</span><span class="sxs-lookup"><span data-stu-id="06661-153">SQL Server log shipping with Distributed File System Replication (DFSR) is used to copy database backups and transaction logs to the recovery farm in Azure:</span></span> 
  
- <span data-ttu-id="06661-p110">DFSR transfiere los registros del entorno de producción al entorno de recuperación. En un escenario WAN, resulta más eficaz usar DFSR que trasvasar los registros directamente al servidor secundario en Azure.</span><span class="sxs-lookup"><span data-stu-id="06661-p110">DFSR transfers logs from the production environment to the recovery environment. In a WAN scenario, DFSR is more efficient than shipping the logs directly to the secondary server in Azure.</span></span>
    
- <span data-ttu-id="06661-156">Los registros se reproducen para SQL Server en el entorno de recuperación de Azure.</span><span class="sxs-lookup"><span data-stu-id="06661-156">Logs are replayed to the SQL Server in the recovery environment in Azure.</span></span>
    
- <span data-ttu-id="06661-157">No adjunte bases de datos de contenido de SharePoint cuyos registros se han trasvasado en el entorno de recuperación, hasta que se realice un ejercicio de recuperación.</span><span class="sxs-lookup"><span data-stu-id="06661-157">You don't attach log-shipped SharePoint content databases in the recovery environment until a recovery exercise is performed.</span></span>
    
<span data-ttu-id="06661-158">Siga estos pasos para recuperar la granja de servidores:</span><span class="sxs-lookup"><span data-stu-id="06661-158">Perform the following steps to recover the farm:</span></span>
  
1. <span data-ttu-id="06661-159">Detenga el trasvase de registros.</span><span class="sxs-lookup"><span data-stu-id="06661-159">Stop log shipping.</span></span>
    
2. <span data-ttu-id="06661-160">Deje de aceptar tráfico a la granja de servidores principal.</span><span class="sxs-lookup"><span data-stu-id="06661-160">Stop accepting traffic to the primary farm.</span></span>
    
3. <span data-ttu-id="06661-161">Reproduzca los registros de transacciones finales.</span><span class="sxs-lookup"><span data-stu-id="06661-161">Replay the final transaction logs.</span></span>
    
4. <span data-ttu-id="06661-162">Adjunte las bases de datos de contenido a la granja de servidores.</span><span class="sxs-lookup"><span data-stu-id="06661-162">Attach the content databases to the farm.</span></span>
    
5. <span data-ttu-id="06661-163">Restaure las aplicaciones de servicio a partir de las bases de datos de servicios que se han replicado.</span><span class="sxs-lookup"><span data-stu-id="06661-163">Restore service applications from the replicated services databases.</span></span>
    
6. <span data-ttu-id="06661-164">Actualice los registros del sistema de nombres de dominio (DNS) para que apunten a la granja de servidores de recuperación.</span><span class="sxs-lookup"><span data-stu-id="06661-164">Update Domain Name System (DNS) records to point to the recovery farm.</span></span>
    
7. <span data-ttu-id="06661-165">Inicie un rastreo completo.</span><span class="sxs-lookup"><span data-stu-id="06661-165">Start a full crawl.</span></span>
    
<span data-ttu-id="06661-p111">Se recomienda ensayar periódicamente estos pasos y documentarlos para ayudarle a garantizar que la recuperación en directo se ejecutará correctamente. El proceso de adjuntar bases de datos de contenido y restaurar aplicaciones de servicio puede tardar bastante y normalmente requiere algo de configuración manual.</span><span class="sxs-lookup"><span data-stu-id="06661-p111">We recommend that you rehearse these steps regularly and document them to help ensure that your live recovery runs smoothly. Attaching content databases and restoring service applications can take some time and typically involves some manual configuration.</span></span>
  
<span data-ttu-id="06661-168">Después de realizar una recuperación, esta solución proporciona los elementos que aparecen en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="06661-168">After a recovery is performed, this solution provides the items listed in the following table.</span></span>
  
<span data-ttu-id="06661-169">**Tabla: Objetivos de recuperación de solución**</span><span class="sxs-lookup"><span data-stu-id="06661-169">**Table: Solution recovery objectives**</span></span>

|<span data-ttu-id="06661-170">**Item**</span><span class="sxs-lookup"><span data-stu-id="06661-170">**Item**</span></span>|<span data-ttu-id="06661-171">**Descripción**</span><span class="sxs-lookup"><span data-stu-id="06661-171">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="06661-172">Sitios y contenido</span><span class="sxs-lookup"><span data-stu-id="06661-172">Sites and content</span></span>  <br/> |<span data-ttu-id="06661-173">Los sitios y el contenido están disponibles en el entorno de recuperación.</span><span class="sxs-lookup"><span data-stu-id="06661-173">Sites and content are available in the recovery environment.</span></span>  <br/> |
|<span data-ttu-id="06661-174">Una nueva instancia de búsqueda</span><span class="sxs-lookup"><span data-stu-id="06661-174">A new instance of search</span></span>  <br/> |<span data-ttu-id="06661-p112">En esta solución de espera semiactiva, la búsqueda no se restaura a partir de las bases de datos de búsqueda. Los componentes de búsqueda de la granja de servidores de recuperación se configuran lo más parecido posible a la granja de servidores de producción. Después de restaurar los sitios y el contenido, se inicia un rastreo completo para recompilar el índice de búsqueda. No es necesario esperar a que se complete el rastreo para que los sitios y el contenido estén disponibles.</span><span class="sxs-lookup"><span data-stu-id="06661-p112">In this warm standby solution, search is not restored from search databases. Search components in the recovery farm are configured as similarly as possible to the production farm. After the sites and content are restored, a full crawl is started to rebuild the search index. You do not need to wait for the crawl to complete to make the sites and content available.</span></span>  <br/> |
|<span data-ttu-id="06661-179">Servicios</span><span class="sxs-lookup"><span data-stu-id="06661-179">Services</span></span>  <br/> | <span data-ttu-id="06661-p113">Los servicios que almacenan datos en las bases de datos se restauran desde las bases de datos cuyos registros se han trasvasado. Simplemente se inician los servicios que no almacenan datos en bases de datos.</span><span class="sxs-lookup"><span data-stu-id="06661-p113">Services that store data in databases are restored from the log-shipped databases. Services that do not store data in databases are simply started.</span></span> <br/>  <span data-ttu-id="06661-p114">No es necesario restaurar todos los servicios con bases de datos. Los siguientes servicios no necesitan restaurarse a partir de las bases de datos y simplemente pueden iniciarse después de la conmutación por error:</span><span class="sxs-lookup"><span data-stu-id="06661-p114">Not all services with databases need to be restored. The following services do not need to be restored from databases and can simply be started after failover:</span></span> <br/>  <span data-ttu-id="06661-184">Recolección de datos de uso y estado</span><span class="sxs-lookup"><span data-stu-id="06661-184">Usage and Health Data Collection</span></span> <br/>  <span data-ttu-id="06661-185">Servicio de estado</span><span class="sxs-lookup"><span data-stu-id="06661-185">State service</span></span> <br/>  <span data-ttu-id="06661-186">Automatización de Word</span><span class="sxs-lookup"><span data-stu-id="06661-186">Word automation</span></span> <br/>  <span data-ttu-id="06661-187">Cualquier otro servicio que no usa una base de datos</span><span class="sxs-lookup"><span data-stu-id="06661-187">Any other service that doesn't use a database</span></span> <br/> |
   
<span data-ttu-id="06661-p115">Puede trabajar con los Servicios de Consultoría de Microsoft (MCS) o un socio para tratar objetivos de recuperación más complejos. Estos se resumen en la siguiente tabla.</span><span class="sxs-lookup"><span data-stu-id="06661-p115">You can work with Microsoft Consulting Services (MCS) or a partner to address more-complex recovery objectives. These are summarized in the following table.</span></span>
  
<span data-ttu-id="06661-190">**Tabla: Otros elementos que MCS o un socio pueden tratar**</span><span class="sxs-lookup"><span data-stu-id="06661-190">**Table: Other items that can be addressed by MCS or a partner**</span></span>

|<span data-ttu-id="06661-191">**Item**</span><span class="sxs-lookup"><span data-stu-id="06661-191">**Item**</span></span>|<span data-ttu-id="06661-192">**Descripción**</span><span class="sxs-lookup"><span data-stu-id="06661-192">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="06661-193">Sincronización de soluciones de granja personalizadas</span><span class="sxs-lookup"><span data-stu-id="06661-193">Synchronizing custom farm solutions</span></span>  <br/> |<span data-ttu-id="06661-p116">Lo ideal es que la configuración de la granja de servidores de recuperación sea idéntica a la granja de servidores de producción. Puede trabajar con un consultor o un socio para evaluar si se replicarán las soluciones de granja personalizadas y si hay un proceso para mantener los dos entornos sincronizados.</span><span class="sxs-lookup"><span data-stu-id="06661-p116">Ideally, the recovery farm configuration is identical to the production farm. You can work with a consultant or partner to evaluate whether custom farm solutions are replicated and whether the process is in place for keeping the two environments synchronized.</span></span>  <br/> |
|<span data-ttu-id="06661-196">Conexiones a orígenes de datos de locales</span><span class="sxs-lookup"><span data-stu-id="06661-196">Connections to data sources on-premises</span></span>  <br/> |<span data-ttu-id="06661-197">No sería práctico replicar las conexiones en sistemas de datos back-end, como conexiones de controlador de dominio de reserva (BDC) y orígenes de contenido de búsqueda.</span><span class="sxs-lookup"><span data-stu-id="06661-197">It might not be practical to replicate connections to back-end data systems, such as backup domain controller (BDC) connections and search content sources.</span></span>  <br/> |
|<span data-ttu-id="06661-198">Escenarios de restauración de búsqueda</span><span class="sxs-lookup"><span data-stu-id="06661-198">Search restore scenarios</span></span>  <br/> |<span data-ttu-id="06661-p117">Dado que las implementaciones del motor de búsqueda Enterprise Search tienden a ser únicas y bastante complejas, para restaurar la búsqueda desde las bases de datos es necesario realizar una mayor inversión. Puede trabajar con un consultor o un socio para identificar e implementar los escenarios de restauración de búsqueda que puede necesitar la organización.</span><span class="sxs-lookup"><span data-stu-id="06661-p117">Because enterprise search deployments tend to be fairly unique and complex, restoring search from databases requires a greater investment. You can work with a consultant or partner to identify and implement search restore scenarios that your organization might require.</span></span>  <br/> |
   
<span data-ttu-id="06661-201">En las instrucciones proporcionadas en este artículo se supone que la granja de servidores ya está diseñada e implementada.</span><span class="sxs-lookup"><span data-stu-id="06661-201">The guidance provided in this article assumes that the on-premises farm is already designed and deployed.</span></span>
  
## <a name="detailed-architecture"></a><span data-ttu-id="06661-202">Arquitectura detallada</span><span class="sxs-lookup"><span data-stu-id="06661-202">Detailed architecture</span></span>

<span data-ttu-id="06661-203">Lo ideal es que la configuración de la granja de servidores de recuperación en Azure sea idéntica a la granja de servidores de producción local, incluido lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="06661-203">Ideally, the recovery farm configuration in Azure is identical to the production farm on-premises, including the following:</span></span>
  
- <span data-ttu-id="06661-204">La misma representación de roles de servidor</span><span class="sxs-lookup"><span data-stu-id="06661-204">The same representation of server roles</span></span>
    
- <span data-ttu-id="06661-205">La misma configuración de personalizaciones</span><span class="sxs-lookup"><span data-stu-id="06661-205">The same configuration of customizations</span></span>
    
- <span data-ttu-id="06661-206">La misma configuración de componentes de búsqueda</span><span class="sxs-lookup"><span data-stu-id="06661-206">The same configuration of search components</span></span>
    
<span data-ttu-id="06661-p118">El entorno de Azure puede ser una versión reducida de la granja de servidores de producción. Si va a escalar horizontalmente la granja de servidores de recuperación después de una conmutación por error, es importante que cada tipo de rol de servidor se represente desde el principio.</span><span class="sxs-lookup"><span data-stu-id="06661-p118">The environment in Azure can be a smaller version of the production farm. If you plan to scale out the recovery farm after failover, it's important that each type of server role be initially represented.</span></span>
  
<span data-ttu-id="06661-p119">Es posible que no resulte práctico replicar algunas configuraciones en el entorno de conmutación por error. Asegúrese de probar los procedimientos de conmutación por error y el entorno para ayudar a garantizar que la granja de servidores de conmutación por error ofrezca el nivel de servicio previsto.</span><span class="sxs-lookup"><span data-stu-id="06661-p119">Some configurations might not be practical to replicate in the failover environment. Be sure to test the failover procedures and environment to help ensure that the failover farm provides the expected service level.</span></span>
  
<span data-ttu-id="06661-p120">Esta solución no exige una topología específica para una granja de servidores de SharePoint. El objetivo de esta solución es usar Azure para la granja de servidores de conmutación por error y para implementar el trasvase de registros y DFSR entre los dos entornos.</span><span class="sxs-lookup"><span data-stu-id="06661-p120">This solution doesn't prescribe a specific topology for a SharePoint farm. The focus of this solution is to use Azure for the failover farm and to implement log shipping and DFSR between the two environments.</span></span>
  
### <a name="warm-standby-environments"></a><span data-ttu-id="06661-213">Entorno de espera semiactiva</span><span class="sxs-lookup"><span data-stu-id="06661-213">Warm standby environments</span></span>

<span data-ttu-id="06661-p121">En un entorno de espera semiactiva, todas las máquinas virtuales del entorno de Azure se están ejecutando. El entorno está listo para un evento o un ejercicio de conmutación por error.</span><span class="sxs-lookup"><span data-stu-id="06661-p121">In a warm standby environment, all virtual machines in the Azure environment are running. The environment is ready for a failover exercise or event.</span></span>
  
<span data-ttu-id="06661-216">En la siguiente ilustración se muestra una solución de recuperación ante desastres procedente de una granja de SharePoint local hacia una granja de SharePoint basada en Azure, que está configurada como un entorno de espera semiactiva.</span><span class="sxs-lookup"><span data-stu-id="06661-216">The following figure illustrates a disaster recovery solution from an on-premises SharePoint farm to an Azure-based SharePoint farm that is configured as a warm standby environment.</span></span>
  
<span data-ttu-id="06661-217">**Ilustración: Topología y elementos clave de una granja de producción y una granja de servidores de recuperación en espera semiactiva.**</span><span class="sxs-lookup"><span data-stu-id="06661-217">**Figure: Topology and key elements of a production farm and a warm standby recovery farm**</span></span>

![Topología de una granja de servidores de SharePoint y una granja de servidores de recuperación con espera semiactiva](media/AZarch-AZWarmStndby.png)
  
<span data-ttu-id="06661-219">En este diagrama:</span><span class="sxs-lookup"><span data-stu-id="06661-219">In this diagram:</span></span>
  
- <span data-ttu-id="06661-220">Se ilustran dos entornos en paralelo: la granja de SharePoint local y la granja de espera semiactiva en Azure.</span><span class="sxs-lookup"><span data-stu-id="06661-220">Two environments are illustrated side by side: the on-premises SharePoint farm and the warm standby farm in Azure.</span></span>
    
- <span data-ttu-id="06661-221">Cada entorno incluye un recurso compartido de archivos.</span><span class="sxs-lookup"><span data-stu-id="06661-221">Each environment includes a file share.</span></span>
    
- <span data-ttu-id="06661-p122">Cada granja de servidores incluye cuatro niveles. Para lograr alta disponibilidad, cada nivel incluye dos servidores o máquinas virtuales que están configuradas de forma idéntica para un rol específico, como los servicios front-end, la caché distribuida, los servicios back-end y las bases de datos. No hemos considerado importante destacar los componentes específicos en esta ilustración. Las dos granjas de servidores tienen una configuración idéntica.</span><span class="sxs-lookup"><span data-stu-id="06661-p122">Each farm includes four tiers. To achieve high availability, each tier includes two servers or virtual machines that are configured identically for a specific role, such as front-end services, distributed cache, back-end services, and databases. It isn't important in this illustration to call out specific components. The two farms are configured identically.</span></span>
    
- <span data-ttu-id="06661-p123">El cuarto nivel es el nivel de base de datos. El trasvase de registros se usa para copiar registros desde el servidor de bases de datos secundario en el entorno local hacia el recurso compartido de archivos en el mismo entorno.</span><span class="sxs-lookup"><span data-stu-id="06661-p123">The fourth tier is the database tier. Log shipping is used to copy logs from the secondary database server in the on-premises environment to the file share in the same environment.</span></span>
    
- <span data-ttu-id="06661-228">DFSR copia archivos desde el recurso compartido de archivos del entorno local hacia el recurso compartido de archivos en el entorno de Azure.</span><span class="sxs-lookup"><span data-stu-id="06661-228">DFSR copies files from the file share in the on-premises environment to the file share in the Azure environment.</span></span>
    
- <span data-ttu-id="06661-229">El trasvase de registros reproduce los registros desde el recurso compartido de archivos en el entorno de Azure hasta la réplica principal en el grupo disponibilidad AlwaysOn de SQL Server en el entorno de recuperación.</span><span class="sxs-lookup"><span data-stu-id="06661-229">Log shipping replays the logs from the file share in the Azure environment to the primary replica in the SQL Server AlwaysOn availability group in the recovery environment.</span></span>
    
### <a name="cold-standby-environments"></a><span data-ttu-id="06661-230">Entornos de espera pasiva</span><span class="sxs-lookup"><span data-stu-id="06661-230">Cold standby environments</span></span>

<span data-ttu-id="06661-p124">En un entorno de espera pasiva, la mayoría de las máquinas virtuales de la granja de servidores de SharePoint pueden cerrarse. (Se recomienda iniciar las máquinas virtuales de vez en cuando, como por ejemplo, cada dos semanas o una vez al mes, para que cada máquina virtual puede sincronizarse con el dominio). Las siguientes máquinas virtuales del entorno de recuperación de Azure deben seguir ejecutándose para garantizar la continuidad de las operaciones de trasvase de registros y DFSR:</span><span class="sxs-lookup"><span data-stu-id="06661-p124">In a cold standby environment, most of the SharePoint farm virtual machines can be shut down. (We recommend occasionally starting the virtual machines, such as every two weeks or once a month, so that each virtual machine can sync with the domain.) The following virtual machines in the Azure recovery environment must remain running to help ensure continuous operations of log shipping and DFSR:</span></span>
  
- <span data-ttu-id="06661-233">El recurso compartido de archivos</span><span class="sxs-lookup"><span data-stu-id="06661-233">The file share</span></span>
    
- <span data-ttu-id="06661-234">El servidor de bases de datos principal</span><span class="sxs-lookup"><span data-stu-id="06661-234">The primary database server</span></span>
    
- <span data-ttu-id="06661-235">Al menos una máquina virtual que ejecute Servicios de dominio de Windows Server Active Directory y DNS</span><span class="sxs-lookup"><span data-stu-id="06661-235">At least one virtual machine running Windows Server Active Directory Domain Services and DNS</span></span>
    
<span data-ttu-id="06661-p125">En esta ilustración se muestra un entorno de conmutación por error de Azure en el que están en funcionamiento la máquina virtual del recurso compartido de archivos y la máquina virtual de la base de datos de SharePoint principal. Las demás máquinas virtuales de SharePoint están detenidas. No se muestra la máquina virtual que ejecuta Windows Server Active Directory y DNS.</span><span class="sxs-lookup"><span data-stu-id="06661-p125">The following figure shows an Azure failover environment in which the file share virtual machine and the primary SharePoint database virtual machine are running. All other SharePoint virtual machines are stopped. The virtual machine that is running Windows Server Active Directory and DNS is not shown.</span></span>
  
<span data-ttu-id="06661-239">**Ilustración: Granja de servidores de recuperación de espera pasiva con máquinas virtuales en funcionamiento**</span><span class="sxs-lookup"><span data-stu-id="06661-239">**Figure: Cold standby recovery farm with running virtual machines**</span></span>

![Elementos de una solución de espera pasiva de SharePoint en Azure](media/AZarch-AZColdStndby.png)
  
<span data-ttu-id="06661-241">Después de la conmutación por error a un entorno de espera pasiva, se inician todas las máquinas virtuales y debe configurarse el método para lograr una alta disponibilidad de los servidores de bases de datos, como los grupos de disponibilidad AlwaysOn de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="06661-241">After failover to a cold standby environment, all virtual machines are started, and the method to achieve high availability of the database servers must be configured, such as SQL Server AlwaysOn availability groups.</span></span>
  
<span data-ttu-id="06661-242">Si se implementan varios grupos de almacenamiento (las bases de datos están dispersas en más de un conjunto de alta disponibilidad de SQL Server), la base de datos principal para cada grupo de almacenamiento debe estar ejecutándose para aceptar los registros asociados a su grupo de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="06661-242">If multiple storage groups are implemented (databases are spread across more than one SQL Server high availability set), the primary database for each storage group must be running to accept the logs associated with its storage group.</span></span>
  
### <a name="skills-and-experience"></a><span data-ttu-id="06661-243">Conocimientos y experiencia</span><span class="sxs-lookup"><span data-stu-id="06661-243">Skills and experience</span></span>

<span data-ttu-id="06661-p126">Se usan varias tecnologías en esta solución de recuperación ante desastres. Para garantizar que estas tecnologías interactúan de la manera esperada, cada componente del entorno local y el entorno de Azure debe estar instalado y configurado correctamente. Se recomienda que la persona o el grupo que configuren esta solución conozcan en profundidad las tecnologías descritas en estos artículos y tengan una sólida experiencia práctica con ellas:</span><span class="sxs-lookup"><span data-stu-id="06661-p126">Multiple technologies are used in this disaster recovery solution. To help ensure that these technologies interact as expected, each component in the on-premises and Azure environment must be installed and configured correctly. We recommend that the person or team who sets up this solution have a strong working knowledge of and hands-on skills with the technologies described in the following articles:</span></span>
  
- [<span data-ttu-id="06661-247">Servicios de replicación del Sistema de archivos distribuido (DFS)</span><span class="sxs-lookup"><span data-stu-id="06661-247">Distributed File System (DFS) Replication Services</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=392698)
    
- [<span data-ttu-id="06661-248">Clústeres de conmutación por error de Windows Server (WSFC) con SQL Server</span><span class="sxs-lookup"><span data-stu-id="06661-248">Windows Server Failover Clustering (WSFC) with SQL Server</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=392701)
    
- [<span data-ttu-id="06661-249">Grupos de disponibilidad AlwaysOn (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="06661-249">AlwaysOn Availability Groups (SQL Server)</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=392725)
    
- [<span data-ttu-id="06661-250">Realizar copias de seguridad y restaurar bases de datos de SQL Server</span><span class="sxs-lookup"><span data-stu-id="06661-250">Back Up and Restore of SQL Server Databases</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=392728)
    
- [<span data-ttu-id="06661-251">Instalación e implementación de la granja de servidores de SharePoint Server 2013</span><span class="sxs-lookup"><span data-stu-id="06661-251">SharePoint Server 2013 installation and farm deployment</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=393119)
    
- [<span data-ttu-id="06661-252">Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="06661-252">Microsoft Azure</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=392729)
    
<span data-ttu-id="06661-p127">Por último, le recomendamos que elabore scripts con los conocimientos y los use para automatizar tareas asociadas a estas tecnologías. Se pueden usar las interfaces de usuario que hay disponibles para completar todas las tareas descritas en esta solución. Sin embargo, si este proceso se realiza de manera manual podría resultar muy lento, ocasionar algún error y ofrecer resultados incoherentes.</span><span class="sxs-lookup"><span data-stu-id="06661-p127">Finally, we recommend scripting skills that you can use to automate tasks associated with these technologies. It's possible to use the available user interfaces to complete all the tasks described in this solution. However, a manual approach can be time consuming and error prone and delivers inconsistent results.</span></span>
  
<span data-ttu-id="06661-p128">Además de Windows PowerShell, también hay bibliotecas de Windows PowerShell para SQL Server, SharePoint Server y Azure. No olvide T-SQL, que también puede ayudarle a reducir el tiempo necesario para configurar y mantener el entorno de recuperación ante desastres.</span><span class="sxs-lookup"><span data-stu-id="06661-p128">In addition to Windows PowerShell, there are also Windows PowerShell libraries for SQL Server, SharePoint Server, and Azure. Don't forget T-SQL, which can also help reduce the time to configure and maintain your disaster-recovery environment.</span></span>
  
## <a name="disaster-recovery-roadmap"></a><span data-ttu-id="06661-258">Plan de recuperación ante desastres</span><span class="sxs-lookup"><span data-stu-id="06661-258">Disaster recovery roadmap</span></span>

![Representación visual del mapa de ruta de la recuperación ante desastres de SharePoint.](media/Azure-DRroadmap.png)
  
<span data-ttu-id="06661-260">En esta guía básica se da por supuesto que ya tiene una granja de servidores de SharePoint Server 2013 implementada en producción.</span><span class="sxs-lookup"><span data-stu-id="06661-260">This roadmap assumes that you already have a SharePoint Server 2013 farm deployed in production.</span></span>
  
<span data-ttu-id="06661-261">**Tabla: Guía básica de recuperación ante desastres**</span><span class="sxs-lookup"><span data-stu-id="06661-261">**Table: Roadmap for disaster recovery**</span></span>

|<span data-ttu-id="06661-262">**Fase**</span><span class="sxs-lookup"><span data-stu-id="06661-262">**Phase**</span></span>|<span data-ttu-id="06661-263">**Descripción**</span><span class="sxs-lookup"><span data-stu-id="06661-263">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="06661-264">Fase 1</span><span class="sxs-lookup"><span data-stu-id="06661-264">Phase 1</span></span>  <br/> |<span data-ttu-id="06661-265">Diseñar el entorno de recuperación ante desastres</span><span class="sxs-lookup"><span data-stu-id="06661-265">Design the disaster recovery environment.</span></span>  <br/> |
|<span data-ttu-id="06661-266">Fase 2</span><span class="sxs-lookup"><span data-stu-id="06661-266">Phase 2</span></span>  <br/> |<span data-ttu-id="06661-267">Crear la red virtual de Azure y la conexión VPN.</span><span class="sxs-lookup"><span data-stu-id="06661-267">Create the Azure virtual network and VPN connection.</span></span>  <br/> |
|<span data-ttu-id="06661-268">Fase 3</span><span class="sxs-lookup"><span data-stu-id="06661-268">Phase 3</span></span>  <br/> |<span data-ttu-id="06661-269">Implementar Windows Active Directory y servicios de nombres de dominio en la red virtual de Azure</span><span class="sxs-lookup"><span data-stu-id="06661-269">Deploy Windows Active Directory and Domain Name Services to the Azure virtual network.</span></span>  <br/> |
|<span data-ttu-id="06661-270">Fase 4</span><span class="sxs-lookup"><span data-stu-id="06661-270">Phase 4</span></span>  <br/> |<span data-ttu-id="06661-271">Implementar la granja de servidores de recuperación de SharePoint en Azure.</span><span class="sxs-lookup"><span data-stu-id="06661-271">Deploy the SharePoint recovery farm in Azure.</span></span>  <br/> |
|<span data-ttu-id="06661-272">Fase 5</span><span class="sxs-lookup"><span data-stu-id="06661-272">Phase 5</span></span>  <br/> |<span data-ttu-id="06661-273">Configurar DFSR entre granjas.</span><span class="sxs-lookup"><span data-stu-id="06661-273">Set up DFSR between the farms.</span></span>  <br/> |
|<span data-ttu-id="06661-274">Fase 6</span><span class="sxs-lookup"><span data-stu-id="06661-274">Phase 6</span></span>  <br/> |<span data-ttu-id="06661-275">Configurar el trasvase de registros a la granja de servidores de recuperación.</span><span class="sxs-lookup"><span data-stu-id="06661-275">Set up log shipping to the recovery farm.</span></span>  <br/> |
|<span data-ttu-id="06661-276">Fase 7</span><span class="sxs-lookup"><span data-stu-id="06661-276">Phase 7</span></span>  <br/> | <span data-ttu-id="06661-p129">Validar las soluciones de conmutación por error y recuperación. Esto incluye los siguientes procedimientos y tecnologías:</span><span class="sxs-lookup"><span data-stu-id="06661-p129">Validate failover and recovery solutions. This includes the following procedures and technologies:</span></span> <br/>  <span data-ttu-id="06661-279">Detener el trasvase de registros</span><span class="sxs-lookup"><span data-stu-id="06661-279">Stop log shipping.</span></span> <br/>  <span data-ttu-id="06661-280">Restaurar las copias de seguridad</span><span class="sxs-lookup"><span data-stu-id="06661-280">Restore the backups.</span></span> <br/>  <span data-ttu-id="06661-281">Rastrear el contenido</span><span class="sxs-lookup"><span data-stu-id="06661-281">Crawl content.</span></span> <br/>  <span data-ttu-id="06661-282">Recuperar servicios</span><span class="sxs-lookup"><span data-stu-id="06661-282">Recover services.</span></span> <br/>  <span data-ttu-id="06661-283">Administrar los registros DNS</span><span class="sxs-lookup"><span data-stu-id="06661-283">Manage DNS records.</span></span> <br/> |
   
## <a name="phase-1-design-the-disaster-recovery-environment"></a><span data-ttu-id="06661-284">Fase 1: Diseñar el entorno de recuperación ante desastres</span><span class="sxs-lookup"><span data-stu-id="06661-284">Phase 1: Design the disaster recovery environment</span></span>

<span data-ttu-id="06661-285">Siga las instrucciones de [Arquitecturas de Microsoft Azure para SharePoint 2013](microsoft-azure-architectures-for-sharepoint-2013.md) para diseñar el entorno de recuperación ante desastres, incluida la granja de servidores de recuperación de SharePoint.</span><span class="sxs-lookup"><span data-stu-id="06661-285">Use the guidance in [Microsoft Azure Architectures for SharePoint 2013](microsoft-azure-architectures-for-sharepoint-2013.md) to design the disaster-recovery environment, including the SharePoint recovery farm.</span></span> <span data-ttu-id="06661-286">Puede usar los gráficos de la [solución de recuperación ante desastres de SharePoint en un archivo de Azure](https://go.microsoft.com/fwlink/p/?LinkId=392554) Visio para iniciar el proceso de diseño.</span><span class="sxs-lookup"><span data-stu-id="06661-286">You can use the graphics in the [SharePoint Disaster Recovery Solution in Azure](https://go.microsoft.com/fwlink/p/?LinkId=392554) Visio file to start the design process.</span></span> <span data-ttu-id="06661-287">Le recomendamos que diseñe el entorno completo antes comenzar a trabajar en el entorno de Azure.</span><span class="sxs-lookup"><span data-stu-id="06661-287">We recommend that you design the entire environment before beginning any work in the Azure environment.</span></span>
  
<span data-ttu-id="06661-288">Además de las instrucciones proporcionadas en [Arquitecturas de Microsoft Azure para SharePoint 2013](microsoft-azure-architectures-for-sharepoint-2013.md) para el diseño de la red virtual, la conexión VPN, Active Directory y la granja de servidores de SharePoint, asegúrese de agregar un rol de recurso compartido de archivos al entorno de Azure.</span><span class="sxs-lookup"><span data-stu-id="06661-288">In addition to the guidance provided in [Microsoft Azure Architectures for SharePoint 2013](microsoft-azure-architectures-for-sharepoint-2013.md) for designing the virtual network, VPN connection, Active Directory, and SharePoint farm, be sure to add a file share role to the Azure environment.</span></span>
  
<span data-ttu-id="06661-p131">Para admitir el trasvase de registros en una solución de recuperación ante desastres, se agrega una máquina virtual de recurso compartido de archivos a la subred donde se encuentran los roles de base de datos. El recurso compartido de archivos también actúa como el tercer nodo de una Mayoría de nodo para el grupo de disponibilidad AlwaysOn de SQL Server. Se trata de la configuración recomendada para una granja de servidores de SharePoint estándar que usa grupos de disponibilidad AlwaysOn de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="06661-p131">To support log shipping in a disaster-recovery solution, a file share virtual machine is added to the subnet where the database roles reside. The file share also serves as the third node of a Node Majority for the SQL Server AlwaysOn availability group. This is the recommended configuration for a standard SharePoint farm that uses SQL Server AlwaysOn availability groups.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="06661-p132">Es importante revisar los requisitos previos para que una base de datos participe en un grupo de disponibilidad AlwaysOn de SQL Server. Para obtener más información, consulte [Requisitos previos, restricciones y recomendaciones para grupos de disponibilidad AlwaysOn](https://go.microsoft.com/fwlink/p/?LinkId=510870).</span><span class="sxs-lookup"><span data-stu-id="06661-p132">It is important to review the prerequisites for a database to participate in a SQL Server AlwaysOn availability group. For more information, see [Prerequisites, Restrictions, and Recommendations for AlwaysOn Availability Groups](https://go.microsoft.com/fwlink/p/?LinkId=510870).</span></span> 
  
<span data-ttu-id="06661-294">**Ilustración: Ubicación de un servidor de archivos utilizado para una solución de recuperación ante desastres**</span><span class="sxs-lookup"><span data-stu-id="06661-294">**Figure: Placement of a file server used for a disaster recovery solution**</span></span>

![Muestra una máquina virtual de recurso compartido de archivos que se agrega al mismo servicio en la nube que contiene los roles de servidor de bases de datos de SharePoint.](media/AZenv-FSforDFSRandWSFC.png)
  
<span data-ttu-id="06661-p133">En este diagrama, se agrega una máquina virtual de recurso compartido de archivos a la misma subred de Azure que contiene los roles de servidor de bases de datos. Recomendamos que no agregue la máquina virtual del recurso compartido de archivos a un conjunto de disponibilidad con otros roles de servidor, como los roles de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="06661-p133">In this diagram, a file share virtual machine is added to the same subnet in Azure that contains the database server roles. Do not add the file share virtual machine to an availability set with other server roles, such as the SQL Server roles.</span></span>
  
<span data-ttu-id="06661-p134">Si le preocupa la alta disponibilidad de los registros, considere la posibilidad de adoptar un enfoque diferente, mediante el uso de [copia de seguridad de SQL Server y restauración con el servicio de almacenamiento de blobs de Azure](https://go.microsoft.com/fwlink/p/?LinkId=393113). Se trata de una nueva característica de Azure que guarda los registros directamente en una dirección URL de almacenamiento de blobs. Esta solución no incluye instrucciones sobre cómo usar esta característica.</span><span class="sxs-lookup"><span data-stu-id="06661-p134">If you are concerned about the high availability of the logs, consider taking a different approach by using [SQL Server backup and restore with Azure Blob Storage Service](https://go.microsoft.com/fwlink/p/?LinkId=393113). This is a new feature in Azure that saves logs directly to a blob storage URL. This solution does not include guidance about using this feature.</span></span>
  
<span data-ttu-id="06661-p135">Cuando diseñe la granja de servidores de recuperación, tenga en cuenta que un entorno de recuperación ante desastres refleja con exactitud la granja de servidores de producción que desea recuperar. El tamaño de la granja de servidores de recuperación no es lo más importante que debe tener en cuenta al diseñar la granja de recuperación, de implementación y de prueba. La escala de la granja de servidores varía de una organización a otra según los requisitos empresariales. Puede usar una granja de servidores reducida para un breve período o hasta que las demandas de rendimiento y capacidad requieran escalar la granja de servidores.</span><span class="sxs-lookup"><span data-stu-id="06661-p135">When you design the recovery farm, keep in mind that a successful disaster recovery environment accurately reflects the production farm that you want to recover. The size of the recovery farm is not the most important thing in the recovery farm's design, deployment, and testing. Farm scale varies from organization to organization based on business requirements. It might be possible to use a scaled-down farm for a short outage or until performance and capacity demands require you to scale the farm.</span></span>
  
<span data-ttu-id="06661-p136">Configure la granja de servidores de recuperación del modo más parecido posible a la granja de servidores de producción para que cumpla los requisitos del acuerdo de nivel de servicio (SLA) y proporcione la funcionalidad que necesita para su negocio. Al diseñar el entorno de recuperación ante desastres, mire también el proceso de administración de cambios para el entorno de producción. Se recomienda ampliar el proceso de administración de cambios al entorno de recuperación, mediante la actualización del entorno de recuperación en el mismo intervalo que el entorno de producción. Como parte del proceso de administración de cambios, le recomendamos que mantenga un inventario detallado de la configuración de la granja de servidores, las aplicaciones y los usuarios.</span><span class="sxs-lookup"><span data-stu-id="06661-p136">Configure the recovery farm as identically as possible to the production farm so that it meets your service level agreement (SLA) requirements and provides the functionality that you need to support your business. When you design the disaster recovery environment, also look at your change management process for your production environment. We recommend that you extend the change management process to the recovery environment by updating the recovery environment at the same interval as the production environment. As part of the change management process, we recommend maintaining a detailed inventory of your farm configuration, applications, and users.</span></span> 
  
## <a name="phase-2-create-the-azure-virtual-network-and-vpn-connection"></a><span data-ttu-id="06661-309">Fase 2: Crear la red virtual de Azure y la conexión VPN</span><span class="sxs-lookup"><span data-stu-id="06661-309">Phase 2: Create the Azure virtual network and VPN connection</span></span>

<span data-ttu-id="06661-p137">El tema [Conectar una red local con una red virtual de Microsoft Azure](connect-an-on-premises-network-to-a-microsoft-azure-virtual-network.md) muestra cómo planear e implementar la red virtual en Azure y cómo crear la conexión VPN. Siga las instrucciones de este tema para completar los procedimientos siguientes:</span><span class="sxs-lookup"><span data-stu-id="06661-p137">[Connect an on-premises network to a Microsoft Azure virtual network](connect-an-on-premises-network-to-a-microsoft-azure-virtual-network.md) shows you how to plan and deploy the virtual network in Azure and how to create the VPN connection. Follow the guidance in the topic to complete the following procedures:</span></span>
  
- <span data-ttu-id="06661-312">Planear el espacio de direcciones IP privado de la Red virtual.</span><span class="sxs-lookup"><span data-stu-id="06661-312">Plan the private IP address space of the Virtual Network.</span></span>
    
- <span data-ttu-id="06661-313">Planear los cambios de infraestructura de enrutamiento para la Red virtual.</span><span class="sxs-lookup"><span data-stu-id="06661-313">Plan the routing infrastructure changes for the Virtual Network.</span></span>
    
- <span data-ttu-id="06661-314">Planear las reglas de firewall para el tráfico hacia y desde el dispositivo VPN local.</span><span class="sxs-lookup"><span data-stu-id="06661-314">Plan firewall rules for traffic to and from the on-premises VPN device.</span></span>
    
- <span data-ttu-id="06661-315">Crear la red virtual entre entornos locales en Azure.</span><span class="sxs-lookup"><span data-stu-id="06661-315">Create the cross-premises virtual network in Azure.</span></span>
    
- <span data-ttu-id="06661-316">Configurar el enrutamiento entre la red local y la Red virtual.</span><span class="sxs-lookup"><span data-stu-id="06661-316">Configure routing between your on-premises network and the Virtual Network.</span></span>
    
## <a name="phase-3-deploy-active-directory-and-domain-name-services-to-the-azure-virtual-network"></a><span data-ttu-id="06661-317">Fase 3: Implementar Active Directory y servicios de nombres de dominio en la red virtual de Azure</span><span class="sxs-lookup"><span data-stu-id="06661-317">Phase 3: Deploy Active Directory and Domain Name Services to the Azure virtual network</span></span>

<span data-ttu-id="06661-318">Esta fase abarca la implementación de Windows Server Active Directory y DNS en la Red virtual en un escenario híbrido, como se describe en [Arquitecturas de Microsoft Azure para SharePoint 2013](microsoft-azure-architectures-for-sharepoint-2013.md) y se muestra en esta imagen.</span><span class="sxs-lookup"><span data-stu-id="06661-318">This phase includes deploying both Windows Server Active Directory and DNS to the Virtual Network in a hybrid scenario as described in [Microsoft Azure Architectures for SharePoint 2013](microsoft-azure-architectures-for-sharepoint-2013.md) and as illustrated in the following figure.</span></span>
  
<span data-ttu-id="06661-319">**Ilustración: Configuración de dominio híbrido de Active Directory**</span><span class="sxs-lookup"><span data-stu-id="06661-319">**Figure: Hybrid Active Directory domain configuration**</span></span>

![Dos máquinas virtuales implementadas en la red virtual de Azure y la subred de la granja de servidores de SharePoint son controladores de dominio de réplica y servidores DNS.](media/AZarch-HyADdomainConfig.png)
  
<span data-ttu-id="06661-p138">En la ilustración, se implementan dos máquinas virtuales en la misma subred. Cada una de estas máquinas virtuales hospeda dos roles: Active Directory y DNS.</span><span class="sxs-lookup"><span data-stu-id="06661-p138">In the illustration, two virtual machines are deployed to the same subnet. These virtual machines are each hosting two roles: Active Directory and DNS.</span></span>
  
<span data-ttu-id="06661-p139">Antes de implementar Active Directory en Azure, lea [Directrices para implementar Windows Server Active Directory en máquinas virtuales de Azure](https://go.microsoft.com/fwlink/p/?linkid=392681). Estas directrices le ayudarán a determinar si necesita una arquitectura diferente o unos valores de configuración distintos para la solución.</span><span class="sxs-lookup"><span data-stu-id="06661-p139">Before deploying Active Directory in Azure, read [Guidelines for Deploying Windows Server Active Directory on Azure Virtual Machines](https://go.microsoft.com/fwlink/p/?linkid=392681). These guidelines help you determine whether you need a different architecture or different configuration settings for your solution.</span></span>
  
<span data-ttu-id="06661-325">Para obtener instrucciones detalladas sobre cómo configurar un controlador de dominio en Azure, consulte [Instalación de un controlador de dominio réplica de Active Directory en Redes virtuales de Azure](https://go.microsoft.com/fwlink/p/?LinkId=392687).</span><span class="sxs-lookup"><span data-stu-id="06661-325">For detailed guidance on setting up a domain controller in Azure, see [Install a Replica Active Directory Domain Controller in Azure Virtual Networks](https://go.microsoft.com/fwlink/p/?LinkId=392687).</span></span>
  
<span data-ttu-id="06661-p140">Antes de pasar a esta fase, no implementó máquinas virtuales en la Red virtual. Las máquinas virtuales para hospedar Active Directory y DNS probablemente no sean las más grandes que necesita para la solución. Antes de implementar estas máquinas virtuales, cree la máquina virtual más grande que vaya a usar en la Red virtual. De este modo, garantizará que la solución llegue a una etiqueta en Azure que permita el mayor tamaño posible. No es necesario que configure esta máquina virtual ahora, solo tiene que crearla y reservarla. Si no lo hace, podría tener una limitación al intentar crear máquinas virtuales de mayor tamaño más adelante, lo que era un problema en el momento en el que redactamos este artículo.</span><span class="sxs-lookup"><span data-stu-id="06661-p140">Before this phase, you didn't deploy virtual machines to the Virtual Network. The virtual machines for hosting Active Directory and DNS are likely not the largest virtual machines you need for the solution. Before you deploy these virtual machines, first create the largest virtual machine that you plan to use in your Virtual Network. This helps ensure that your solution lands on a tag in Azure that allows the largest size you need. You do not need to configure this virtual machine at this time. Simply create it, and set it aside. If you do not do this, you might run into a limitation when you try to create larger virtual machines later, which was an issue at the time this article was written.</span></span> 
  
## <a name="phase-4-deploy-the-sharepoint-recovery-farm-in-azure"></a><span data-ttu-id="06661-333">Fase 4: Implementar la granja de servidores de recuperación de SharePoint en Azure</span><span class="sxs-lookup"><span data-stu-id="06661-333">Phase 4: Deploy the SharePoint recovery farm in Azure</span></span>

<span data-ttu-id="06661-p141">Implemente la granja de servidores de SharePoint en la Red virtual según sus planes de diseño. Puede resultarle útil revisar el tema sobre [Planeación para SharePoint 2013 en Servicios de infraestructura de Azure](https://go.microsoft.com/fwlink/p/?LinkId=400984) antes de implementar los roles de SharePoint en Azure.</span><span class="sxs-lookup"><span data-stu-id="06661-p141">Deploy the SharePoint farm in your Virtual Network according to your design plans. It might be helpful to review [Planning for SharePoint 2013 on Azure Infrastructure Services](https://go.microsoft.com/fwlink/p/?LinkId=400984) before you deploy SharePoint roles in Azure.</span></span>
  
<span data-ttu-id="06661-336">Tenga en cuenta estas prácticas que hemos aprendido al crear nuestro entorno de prueba de concepto:</span><span class="sxs-lookup"><span data-stu-id="06661-336">Consider the following practices that we learned by building our proof of concept environment:</span></span>
  
- <span data-ttu-id="06661-337">Cree las máquinas virtuales mediante el portal de Azure o PowerShell.</span><span class="sxs-lookup"><span data-stu-id="06661-337">Create virtual machines by using the Azure portal or PowerShell.</span></span>
    
- <span data-ttu-id="06661-p142">Azure y Hyper-V no admiten la memoria dinámica. Asegúrese de tenerlo en cuenta en sus planes de capacidad y rendimiento.</span><span class="sxs-lookup"><span data-stu-id="06661-p142">Azure and Hyper-V do not support dynamic memory. Be sure this is factored into your performance and capacity plans.</span></span>
    
- <span data-ttu-id="06661-p143">Reinicie las máquinas virtuales desde la interfaz de Azure, en lugar de a través del propio inicio de sesión de la máquina virtual. La interfaz de Azure funciona mejor y es más predecible.</span><span class="sxs-lookup"><span data-stu-id="06661-p143">Restart virtual machines through the Azure interface, not from the virtual machine logon itself. Using the Azure interface works better and is more predictable.</span></span>
    
- <span data-ttu-id="06661-p144">Si quiere desconectar una máquina virtual para ahorrar gastos, use la interfaz de Azure. Si la cierra desde el inicio de sesión de la máquina virtual, los cargos seguirán acumulándose.</span><span class="sxs-lookup"><span data-stu-id="06661-p144">If you want to shut down a virtual machine to save costs, use the Azure interface. If you shut down from the virtual machine logon, charges continue to accrue.</span></span>
    
- <span data-ttu-id="06661-344">Use una convención de nomenclatura para las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="06661-344">Use a naming convention for the virtual machines.</span></span>
    
- <span data-ttu-id="06661-345">Preste atención a la ubicación del centro de datos en la que se van a implementar las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="06661-345">Pay attention to which datacenter location the virtual machines are being deployed.</span></span>
    
- <span data-ttu-id="06661-346">No se admite la característica de ajuste a escala automático de Azure para los roles de SharePoint.</span><span class="sxs-lookup"><span data-stu-id="06661-346">The automatic scaling feature in Azure is not supported for SharePoint roles.</span></span>
    
- <span data-ttu-id="06661-347">No configure los elementos de la granja de servidores que se vayan a restaurar, como las colecciones de sitios.</span><span class="sxs-lookup"><span data-stu-id="06661-347">Do not configure items in the farm that will be restored, such as site collections.</span></span> 
    
## <a name="phase-5-set-up-dfsr-between-the-farms"></a><span data-ttu-id="06661-348">Fase 5: Configurar DFSR entre las granjas de servidores</span><span class="sxs-lookup"><span data-stu-id="06661-348">Phase 5: Set up DFSR between the farms</span></span>

<span data-ttu-id="06661-p145">Para configurar la replicación de archivos mediante DFSR, use el complemento Administración de DNS. No obstante, antes de instalar DFSR, inicie sesión en el servidor de archivos local y el servidor de archivos de Azure y habilite el servicio en Windows.</span><span class="sxs-lookup"><span data-stu-id="06661-p145">To set up file replication by using DFSR, use the DNS Management snap-in. However, before the DFSR setup, log on to your on-premises file server and Azure file server and enable the service in Windows.</span></span>
  
<span data-ttu-id="06661-351">En el panel del administrador de servidores, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="06661-351">From the Server Manager Dashboard, complete the following steps:</span></span>
  
- <span data-ttu-id="06661-352">Configure el servidor local.</span><span class="sxs-lookup"><span data-stu-id="06661-352">Configure the local server.</span></span>
    
- <span data-ttu-id="06661-353">Inicie el **Asistente para agregar roles y características**.</span><span class="sxs-lookup"><span data-stu-id="06661-353">Start the **Add Roles and Features Wizard**.</span></span>
    
- <span data-ttu-id="06661-354">Abra el nodo **Servicios de archivos y almacenamiento**.</span><span class="sxs-lookup"><span data-stu-id="06661-354">Open the **File and Storage Services** node.</span></span>
    
- <span data-ttu-id="06661-355">Seleccione **Espacios de nombres DFS** y **Replicación DFS**.</span><span class="sxs-lookup"><span data-stu-id="06661-355">Select **DFS Namespaces** and **DFS replication**.</span></span>
    
- <span data-ttu-id="06661-356">Haga clic en **Siguiente** para finalizar los pasos del asistente.</span><span class="sxs-lookup"><span data-stu-id="06661-356">Click **Next** to finish the wizard steps.</span></span>
    
<span data-ttu-id="06661-357">En esta tabla se proporcionan vínculos a entradas de blog y artículos de referencia de DFSR.</span><span class="sxs-lookup"><span data-stu-id="06661-357">The following table provides links to DFSR reference articles and blog posts.</span></span>
  
<span data-ttu-id="06661-358">**Tabla: Artículos de referencia de DFSR**</span><span class="sxs-lookup"><span data-stu-id="06661-358">**Table: Reference articles for DFSR**</span></span>

|<span data-ttu-id="06661-359">**Título**</span><span class="sxs-lookup"><span data-stu-id="06661-359">**Title**</span></span>|<span data-ttu-id="06661-360">**Descripción**</span><span class="sxs-lookup"><span data-stu-id="06661-360">**Description**</span></span>|
|:-----|:-----|
|[<span data-ttu-id="06661-361">Replicación</span><span class="sxs-lookup"><span data-stu-id="06661-361">Replication</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=392732) <br/> |<span data-ttu-id="06661-362">Tema de TechNet sobre administración de DFS con vínculos para la replicación</span><span class="sxs-lookup"><span data-stu-id="06661-362">DFS Management TechNet topic with links for replication</span></span>  <br/> |
|[<span data-ttu-id="06661-363">Replicación DFS: Guía de supervivencia</span><span class="sxs-lookup"><span data-stu-id="06661-363">DFS Replication: Survival Guide</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=392737) <br/> |<span data-ttu-id="06661-364">Sitio wiki con vínculos a información sobre DFS</span><span class="sxs-lookup"><span data-stu-id="06661-364">Wiki with links to DFS information</span></span>  <br/> |
|[<span data-ttu-id="06661-365">Replicación DFS: Preguntas más frecuentes</span><span class="sxs-lookup"><span data-stu-id="06661-365">DFS Replication: Frequently Asked Questions</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=392738) <br/> |<span data-ttu-id="06661-366">Tema de TechNet sobre replicación DFS</span><span class="sxs-lookup"><span data-stu-id="06661-366">DFS Replication TechNet topic</span></span>  <br/> |
|[<span data-ttu-id="06661-367">Blog de Jose Barreto</span><span class="sxs-lookup"><span data-stu-id="06661-367">Jose Barreto's Blog</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=392739) <br/> |<span data-ttu-id="06661-368">Blog escrito por un administrador del programa principal del equipo de Servidor de archivos de Microsoft</span><span class="sxs-lookup"><span data-stu-id="06661-368">Blog written by a Principal Program Manager on the File Server team at Microsoft</span></span>  <br/> |
|[<span data-ttu-id="06661-369">Blog del equipo de Almacenamiento de Microsoft: File Cabinet</span><span class="sxs-lookup"><span data-stu-id="06661-369">The Storage Team at Microsoft - File Cabinet Blog</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=392740) <br/> |<span data-ttu-id="06661-370">Blog sobre los servicios de archivo y las características de almacenamiento en Windows Server</span><span class="sxs-lookup"><span data-stu-id="06661-370">Blog about file services and storage features in Windows Server</span></span>  <br/> |
   
## <a name="phase-6-set-up-log-shipping-to-the-recovery-farm"></a><span data-ttu-id="06661-371">Fase 6: Configurar el trasvase de registros a la granja de servidores de recuperación</span><span class="sxs-lookup"><span data-stu-id="06661-371">Phase 6: Set up log shipping to the recovery farm</span></span>

<span data-ttu-id="06661-p146">El trasvase de registros es el componente fundamental para configurar la recuperación ante desastres en este entorno. Puede usar el trasvase de registros para enviar automáticamente los archivos de registro de transacciones desde una instancia de servidor de bases de datos principal hacia una instancia de servidor de bases de datos secundario. Para configurar el trasvase de registros, vea [Configure log shipping in SharePoint 2013](https://docs.microsoft.com/sharepoint/administration/configure-log-shipping).</span><span class="sxs-lookup"><span data-stu-id="06661-p146">Log shipping is the critical component for setting up disaster recovery in this environment. You can use log shipping to automatically send transaction log files for databases from a primary database server instance to a secondary database server instance. To set up log shipping, see [Configure log shipping in SharePoint 2013](https://docs.microsoft.com/sharepoint/administration/configure-log-shipping).</span></span> 
  
> [!IMPORTANT]
> <span data-ttu-id="06661-p147">La compatibilidad con el trasvase de registros en SharePoint Server está limitada a determinadas bases de datos. Para obtener más información, consulte [Compatibilidad de alta disponibilidad y opciones de recuperación ante desastres para bases de datos de SharePoint (SharePoint 2013)](https://go.microsoft.com/fwlink/p/?LinkId=393121).</span><span class="sxs-lookup"><span data-stu-id="06661-p147">Log shipping support in SharePoint Server is limited to certain databases. For more information, see [Supported high availability and disaster recovery options for SharePoint databases (SharePoint 2013)](https://go.microsoft.com/fwlink/p/?LinkId=393121).</span></span> 
  
## <a name="phase-7-validate-failover-and-recovery"></a><span data-ttu-id="06661-377">Fase 7: Validar la conmutación por error y la recuperación</span><span class="sxs-lookup"><span data-stu-id="06661-377">Phase 7: Validate failover and recovery</span></span>

<span data-ttu-id="06661-p148">El objetivo de esta fase final consiste en comprobar que la solución de recuperación ante desastres funciona según lo previsto. Para ello, cree un evento de conmutación por error que cierre la granja de servidores de producción e inicie la granja de servidores de recuperación para sustituirla. Puede iniciar una situación de conmutación por error manualmente o mediante scripts.</span><span class="sxs-lookup"><span data-stu-id="06661-p148">The goal of this final phase is to verify that the disaster recovery solution works as planned. To do this, create a failover event that shuts down the production farm and starts up the recovery farm as a replacement. You can start a failover scenario manually or by using scripts.</span></span>
  
<span data-ttu-id="06661-p149">El primer paso consiste en detener las solicitudes entrantes de los usuarios para el contenido o los servicios de la granja de servidores. Para hacerlo, puede deshabilitar las entradas DNS o apagar los servidores front-end web. Una vez que ha "caído" la granja de servidores, puede iniciar la conmutación por error a la granja de servidores de recuperación.</span><span class="sxs-lookup"><span data-stu-id="06661-p149">The first step is to stop incoming user requests for farm services or content. You can do this by disabling DNS entries or by shutting down the front-end web servers. After the farm is "down," you can fail over to the recovery farm.</span></span>
  
### <a name="stop-log-shipping"></a><span data-ttu-id="06661-384">Detener el trasvase de registros</span><span class="sxs-lookup"><span data-stu-id="06661-384">Stop log shipping</span></span>

<span data-ttu-id="06661-p150">Debe detener el trasvase de registros antes de recuperar la granja de servidores. Primero detenga el trasvase de registros en el servidor secundario en Azure y luego deténgalo en servidor principal local. Use este script para detener el trasvase de registros primero en el servidor secundario y, después, en el servidor principal. Los nombres de base de datos que figuran en el script podrían ser distintos, según el entorno.</span><span class="sxs-lookup"><span data-stu-id="06661-p150">You must stop log shipping before farm recovery. Stop log shipping on the secondary server in Azure first, and then stop it on the primary server on-premises. Use the following script to stop log shipping on the secondary server first and then on the primary server. The database names in the script might be different, depending on your environment.</span></span>
  
```
-- This script removes log shipping from the server.
-- Commands must be executed on the secondary server first and then on the primary server.

SET NOCOUNT ON
DECLARE  @PriDB nvarchar(max)
,@SecDB nvarchar(250)
,@PriSrv nvarchar(250)
,@SecSrv nvarchar(250)

Set @PriDB= ''
SET @PriDB = UPPER(@PriDB)
SET @PriDB = REPLACE(@PriDB, ' ', '')
SET @PriDB = '''' + REPLACE(@PriDB, ',', ''', ''') + ''''

Set @SecDB = @PriDB

Exec ( 'Select  ''exec master..sp_delete_log_shipping_secondary_database '' + '''''''' + prm.primary_database +  ''''''''   
from msdb.dbo.log_shipping_monitor_primary prm INNER JOIN msdb.dbo.log_shipping_primary_secondaries sec  ON  prm.primary_database=sec.secondary_database
where prm.primary_database in ( ' + @PriDB + ' )')

Exec ( 'Select  ''exec master..sp_delete_log_shipping_primary_secondary '' + '''''''' + prm.Primary_Database + '''''', '''''' + sec.Secondary_Server + '''''', '''''' + sec.Secondary_database + ''''''''   
from msdb.dbo.log_shipping_monitor_primary prm INNER JOIN msdb.dbo.log_shipping_primary_secondaries sec  ON  prm.primary_database=sec.secondary_database
where prm.primary_database in ( ' + @PriDB + ' )')

Exec ( 'Select  ''exec master..sp_delete_log_shipping_primary_database '' + '''''''' + prm.primary_database +  ''''''''   
from msdb.dbo.log_shipping_monitor_primary prm INNER JOIN msdb.dbo.log_shipping_primary_secondaries sec  ON  prm.primary_database=sec.secondary_database
where prm.primary_database in ( ' + @PriDB + ' )')

Exec ( 'Select  ''exec master..sp_delete_log_shipping_secondary_primary '' + '''''''' + prm.primary_server + '''''', '''''' + prm.primary_database +  ''''''''   
from msdb.dbo.log_shipping_monitor_primary prm INNER JOIN msdb.dbo.log_shipping_primary_secondaries sec  ON  prm.primary_database=sec.secondary_database
where prm.primary_database in ( ' + @PriDB + ' )')

```

### <a name="restore-the-backups"></a><span data-ttu-id="06661-389">Restaurar las copias de seguridad</span><span class="sxs-lookup"><span data-stu-id="06661-389">Restore the backups</span></span>

<span data-ttu-id="06661-p151">Las copias de seguridad deben restaurarse en el orden en que se crearon. Para poder restaurar una copia de seguridad de un registro de transacción en particular, primero tiene que restaurar las copias de seguridad anteriores sin deshacer las transacciones no confirmadas (es decir, con  `WITH NORECOVERY`):</span><span class="sxs-lookup"><span data-stu-id="06661-p151">Backups must be restored in the order in which they were created. Before you can restore a particular transaction log backup, you must first restore the following previous backups without rolling back uncommitted transactions (that is, by using  `WITH NORECOVERY`):</span></span>
  
- <span data-ttu-id="06661-p152">La copia de seguridad de la base de datos completa y la última copia de seguridad diferencial: restaure estas copias de seguridad, si existe alguna, realizadas antes de la copia de seguridad del registro de transacciones concreto. Antes de crearla copia de seguridad de base de datos completa o diferencial más reciente, la base de datos usaba el modelo de recuperación completa o el modelo de recuperación de registro masivo.</span><span class="sxs-lookup"><span data-stu-id="06661-p152">The full database backup and the last differential backup - Restore these backups, if any exist, taken before the particular transaction log backup. Before the most recent full or differential database backup was created, the database was using the full recovery model or bulk-logged recovery model.</span></span>
    
- <span data-ttu-id="06661-p153">Todas las copias de seguridad del registro de transacciones: restaure cualquier copia de seguridad del registro de transacciones que se haya realizado después de la copia de seguridad de la base de datos completa o la copia de seguridad diferencial (si restaura una), pero antes de la copia de seguridad del registro de transacciones concreto. Las copias de seguridad de registros deben aplicarse siguiendo la misma secuencia en que se crearon, sin espacios en la cadena de registro.</span><span class="sxs-lookup"><span data-stu-id="06661-p153">All transaction log backups - Restore any transaction log backups taken after the full database backup or the differential backup (if you restore one) and before the particular transaction log backup. Log backups must be applied in the sequence in which they were created, without any gaps in the log chain.</span></span>
    
<span data-ttu-id="06661-p154">Para recuperar la base de datos de contenido en el servidor secundario para que se representen los sitios, quite todas las conexiones de base de datos antes de realizar la recuperación. Para restaurar la base de datos, ejecute la siguiente instrucción SQL.</span><span class="sxs-lookup"><span data-stu-id="06661-p154">To recover the content database on the secondary server so that the sites render, remove all database connections before recovery. To restore the database, run the following SQL statement.</span></span>
  
```
restore database WSS_Content with recovery

```

> [!IMPORTANT]
> <span data-ttu-id="06661-p155">Cuando usa T-SQL expresamente, especifique **WITH NORECOVERY** o **WITH RECOVERY** en cada instrucción RESTORE para eliminar la ambigüedad; esto es muy importante al escribir scripts. Una vez que se han restaurado las copias de seguridad completas y diferenciales, se pueden restaurar los registros de transacciones en SQL Server Management Studio. Además, como ya se ha detenido el trasvase de registros, la base de datos de contenido se encuentra en un estado de espera, por lo que debe cambiar el estado para el acceso total.</span><span class="sxs-lookup"><span data-stu-id="06661-p155">When you use T-SQL explicitly, specify either **WITH NORECOVERY** or **WITH RECOVERY** in every RESTORE statement to eliminate ambiguity—this is very important when writing scripts. After the full and differential backups are restored, the transaction logs can be restored in SQL Server Management Studio. Also, because log shipping is already stopped, the content database is in a standby state, so you must change the state to full access.</span></span>
  
<span data-ttu-id="06661-p156">En SQL Server Management Studio, haga clic con el botón derecho en la base de datos **WSS_Content**, seleccione **Tareas** > **Restaurar** y, después, haga clic en **Registro de transacciones** (si no ha restaurado la copia de seguridad completa, no estará disponible). Para obtener más información, consulte[Restaurar una copia de seguridad de registros de transacciones (SQL Server)](https://go.microsoft.com/fwlink/p/?LinkId=392778).</span><span class="sxs-lookup"><span data-stu-id="06661-p156">In SQL Server Management Studio, right-click the **WSS_Content** database, point to **Tasks** > **Restore**, and then click **Transaction Log** (if you have not restored the full backup, this is not available). For more information, see[Restore a Transaction Log Backup (SQL Server)](https://go.microsoft.com/fwlink/p/?LinkId=392778).</span></span>
  
### <a name="crawl-the-content-source"></a><span data-ttu-id="06661-403">Rastrear el origen de contenido</span><span class="sxs-lookup"><span data-stu-id="06661-403">Crawl the content source</span></span>

<span data-ttu-id="06661-p157">Debe iniciar un rastreo completo para que cada origen de contenido restaure el servicio Búsqueda. Tenga en cuenta que se pierde cierta información de análisis de la granja de servidores local, como las recomendaciones de búsqueda. Antes de iniciar el rastreo completo, use el cmdlet **Restore-SPEnterpriseSearchServiceApplication** de Windows PowerShell y especifique la base de datos de administración de búsqueda **Search_Service__DB_<GUID>** que se ha replicado y cuyos registros se han trasvasado. Este cmdlet proporciona la configuración, el esquema, las propiedades administradas, las reglas y los orígenes de búsqueda, y crea un conjunto predeterminado de los demás componentes.</span><span class="sxs-lookup"><span data-stu-id="06661-p157">You must start a full crawl for each content source to restore the Search Service. Note that you lose some analytics information from the on-premises farm, such as search recommendations. Before you start the full crawls, use the Windows PowerShell cmdlet **Restore-SPEnterpriseSearchServiceApplication** and specify the log-shipped and replicated Search Administration database, **Search_Service__DB_<GUID>**. This cmdlet gives the search configuration, schema, managed properties, rules, and sources and creates a default set of the other components.</span></span>
  
<span data-ttu-id="06661-408">Para iniciar un rastreo completo, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="06661-408">To start a full crawl, complete the following steps:</span></span>
  
1. <span data-ttu-id="06661-409">En Administración central de SharePoint 2013, vaya a **Administración de aplicaciones** > **Aplicaciones de servicio** > **Administrar aplicaciones de servicio** y, a continuación, haga clic en la aplicación de servicio Búsqueda que quiera rastrear.</span><span class="sxs-lookup"><span data-stu-id="06661-409">In the SharePoint 2013 Central Administration, go to **Application Management** > **Service Applications** > **Manage service applications**, and then click the Search Service application that you want to crawl.</span></span>
    
2. <span data-ttu-id="06661-410">En la página **Administración de búsquedas**, haga clic en **Orígenes de contenido**, señale el origen de contenido que quiera, haga clic en la flecha y después en **Iniciar rastreo completo**.</span><span class="sxs-lookup"><span data-stu-id="06661-410">On the **Search Administration** page, click **Content Sources**, point to the content source that you want, click the arrow, and then click **Start Full Crawl**.</span></span>
    
### <a name="recover-farm-services"></a><span data-ttu-id="06661-411">Recuperar servicios de la granja de servidores</span><span class="sxs-lookup"><span data-stu-id="06661-411">Recover farm services</span></span>

<span data-ttu-id="06661-412">En esta tabla se muestra cómo recuperar servicios que tienen bases de datos con trasvase de registros, servicios que tienen bases de datos pero no se recomienda que se restauren con el trasvase de registros y servicios que no tienen bases de datos.</span><span class="sxs-lookup"><span data-stu-id="06661-412">The following table shows how to recover services that have log-shipped databases, the services that have databases but are not recommended to restore with log shipping, and the services that do not have databases.</span></span>
  
> [!IMPORTANT]
> <span data-ttu-id="06661-413">Si restaura una base de datos de SharePoint local en el entorno de Azure no recuperará los servicios de SharePoint que no haya instalado manualmente en Azure.</span><span class="sxs-lookup"><span data-stu-id="06661-413">Restoring an on-premises SharePoint database into the Azure environment will not recover any SharePoint services that you did not already install in Azure manually.</span></span> 
  
<span data-ttu-id="06661-414">**Tabla: Referencia de la base de datos de aplicación de servicio**</span><span class="sxs-lookup"><span data-stu-id="06661-414">**Table: Service application database reference**</span></span>

|<span data-ttu-id="06661-415">**Restaurar estos servicios desde bases de datos con trasvase de registros:**</span><span class="sxs-lookup"><span data-stu-id="06661-415">**Restore these services from log-shipped databases**</span></span>|<span data-ttu-id="06661-416">**Estos servicios tienen bases de datos, pero le recomendamos que inicie estos servicios sin restaurar las bases de datos:**</span><span class="sxs-lookup"><span data-stu-id="06661-416">**These services have databases, but we recommend that you start these services without restoring their databases**</span></span>|<span data-ttu-id="06661-417">**Estos servicios no almacenan datos en bases de datos; inicie estos servicios después de la conmutación por error:**</span><span class="sxs-lookup"><span data-stu-id="06661-417">**These services do not store data in databases; start these services after failover**</span></span>|
|:-----|:-----|:-----|
| <span data-ttu-id="06661-418">Servicio de traducción automática</span><span class="sxs-lookup"><span data-stu-id="06661-418">Machine Translation Service</span></span> <br/>  <span data-ttu-id="06661-419">Servicio de metadatos administrados</span><span class="sxs-lookup"><span data-stu-id="06661-419">Managed Metadata Service</span></span> <br/>  <span data-ttu-id="06661-420">Servicio de almacenamiento seguro</span><span class="sxs-lookup"><span data-stu-id="06661-420">Secure Store Service</span></span> <br/>  <span data-ttu-id="06661-p158">Perfil de usuario. (Se admiten sólo las bases de datos de perfil y de etiquetas temáticas. No se admite la base de datos de sincronización).</span><span class="sxs-lookup"><span data-stu-id="06661-p158">User Profile. (Only the Profile and Social Tagging databases are supported. The Synchronization database is not supported.)</span></span> <br/>  <span data-ttu-id="06661-424">Servicio de configuración de suscripción de Microsoft SharePoint Foundation</span><span class="sxs-lookup"><span data-stu-id="06661-424">Microsoft SharePoint Foundation Subscription Settings Service</span></span> <br/> | <span data-ttu-id="06661-425">Recolección de datos de uso y estado</span><span class="sxs-lookup"><span data-stu-id="06661-425">Usage and Health Data Collection</span></span> <br/>  <span data-ttu-id="06661-426">Servicio de estado</span><span class="sxs-lookup"><span data-stu-id="06661-426">State service</span></span> <br/>  <span data-ttu-id="06661-427">Automatización de Word</span><span class="sxs-lookup"><span data-stu-id="06661-427">Word automation</span></span> <br/> | <span data-ttu-id="06661-428">Servicios de Excel</span><span class="sxs-lookup"><span data-stu-id="06661-428">Excel Services</span></span> <br/>  <span data-ttu-id="06661-429">PerformancePoint Services</span><span class="sxs-lookup"><span data-stu-id="06661-429">PerformancePoint Services</span></span> <br/>  <span data-ttu-id="06661-430">Conversión de PowerPoint</span><span class="sxs-lookup"><span data-stu-id="06661-430">PowerPoint Conversion</span></span> <br/>  <span data-ttu-id="06661-431">Servicio de gráficos de Visio</span><span class="sxs-lookup"><span data-stu-id="06661-431">Visio Graphics Service</span></span> <br/>  <span data-ttu-id="06661-432">Administración del trabajo</span><span class="sxs-lookup"><span data-stu-id="06661-432">Work Management</span></span> <br/> |
   
<span data-ttu-id="06661-433">En este ejemplo se muestra cómo restaurar el servicio de metadatos administrados desde una base de datos.</span><span class="sxs-lookup"><span data-stu-id="06661-433">The following example shows how to restore the Managed Metadata service from a database.</span></span>
  
<span data-ttu-id="06661-p159">Esta opción usa la base de datosManaged_Metadata_DBexistente. Esta base de datos tiene trasvase de registros, pero no hay ninguna aplicación de servicio activo en la granja de servidores secundaria, por lo que necesita estar conectado después de colocar la aplicación de servicio.</span><span class="sxs-lookup"><span data-stu-id="06661-p159">This uses the existing Managed_Metadata_DB database. This database is log shipped, but there is no active service application on the secondary farm, so it needs to be connected after the service application is in place.</span></span>
  
<span data-ttu-id="06661-436">En primer lugar, use  `New-SPMetadataServiceApplication` y especifique el modificador `DatabaseName` con el nombre de la base de datos restaurada.</span><span class="sxs-lookup"><span data-stu-id="06661-436">First, use  `New-SPMetadataServiceApplication`, and specify the  `DatabaseName` switch with the name of the restored database.</span></span>
  
<span data-ttu-id="06661-437">Después, configure la nueva aplicación de servicio de metadatos administrados en el servidor secundario, como se muestra aquí:</span><span class="sxs-lookup"><span data-stu-id="06661-437">Next, configure the new Managed Metadata Service Application on the secondary server, as follows:</span></span>
  
- <span data-ttu-id="06661-438">Nombre: Servicio de metadatos administrados</span><span class="sxs-lookup"><span data-stu-id="06661-438">Name: Managed Metadata Service</span></span>
    
- <span data-ttu-id="06661-439">Servidor de bases de datos: el nombre de la base de datos del registro de transacciones que se ha trasvasado</span><span class="sxs-lookup"><span data-stu-id="06661-439">Database server: The database name from the shipped transaction log</span></span>
    
- <span data-ttu-id="06661-440">Nombre de la base de datosManaged_Metadata_DB</span><span class="sxs-lookup"><span data-stu-id="06661-440">Database name: Managed_Metadata_DB</span></span>
    
- <span data-ttu-id="06661-441">Grupo de aplicaciones: aplicaciones de servicio de SharePoint</span><span class="sxs-lookup"><span data-stu-id="06661-441">Application pool: SharePoint Service Applications</span></span> 
    
### <a name="manage-dns-records"></a><span data-ttu-id="06661-442">Administrar los registros DNS</span><span class="sxs-lookup"><span data-stu-id="06661-442">Manage DNS records</span></span>

<span data-ttu-id="06661-443">Debe crear manualmente los registros DNS para que apunten a la granja de servidores de SharePoint.</span><span class="sxs-lookup"><span data-stu-id="06661-443">You must manually create DNS records to point to your SharePoint farm.</span></span>
  
<span data-ttu-id="06661-p160">En la mayoría de los casos donde tiene varios servidores front-end web, tiene sentido aprovechar las ventajas de la característica de equilibrio de carga de red en Windows Server 2012 o un equilibrador de carga de hardware para distribuir las solicitudes entre los servidores front-end web en la granja de servidores. El equilibrio de carga de red también puede ayudar a reducir el riesgo, mediante la distribución de las solicitudes a los demás servidores si se produce un error en uno de los servidores front-end web.</span><span class="sxs-lookup"><span data-stu-id="06661-p160">In most cases where you have multiple front-end web servers, it makes sense to take advantage of the Network Load Balancing feature in Windows Server 2012 or a hardware load balancer to distribute requests among the web-front-end servers in your farm. Network load balancing can also help reduce risk by distributing requests to the other servers if one of your web-front-end servers fails.</span></span> 
  
<span data-ttu-id="06661-p161">Normalmente, al configurar el equilibrio de carga de red, el clúster se asigna una dirección IP única. A continuación, crea un registro de host DNS en el proveedor DNS para la red que apunta al clúster. (Para este proyecto, se coloca un servidor DNS en Azure para resistir en caso de un error en el centro de datos local). Por ejemplo, puede crear un registro DNS, en el Administrador de DNS en Active Directory, por ejemplo, denominado  `https://sharepoint.contoso.com`, que señale a la dirección IP para el clúster de equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="06661-p161">Typically, when you set up network load balancing, your cluster is assigned a single IP address. You then create a DNS host record in the DNS provider for your network that points to the cluster. (For this project, we put a DNS server in Azure for resiliency in case of an on-premises datacenter failure.) For instance, you can create a DNS record, in DNS Manager in Active Directory, for example, called  `https://sharepoint.contoso.com`, that points to the IP address for your load-balanced cluster.</span></span>
  
<span data-ttu-id="06661-449">Para el acceso externo a la granja de servidores de SharePoint, puede crear un registro de host en un servidor DNS externo con la misma dirección URL que usan los clientes en `https://sharepoint.contoso.com`la intranet (por ejemplo,) que apunta a una dirección IP externa en el firewall.</span><span class="sxs-lookup"><span data-stu-id="06661-449">For external access to your SharePoint farm, you can create a host record on an external DNS server with the same URL that clients use on your intranet (for example, `https://sharepoint.contoso.com`) that points to an external IP address in your firewall.</span></span> <span data-ttu-id="06661-450">(Un procedimiento recomendado es configurar un DNS dividido para que el servidor DNS interno tenga autoridad para `contoso.com` y enrute las solicitudes directamente al clúster de la granja de servidores de SharePoint, en lugar de enrutar las solicitudes DNS al servidor DNS externo). A continuación, puede asignar la dirección IP externa a la dirección IP interna del clúster local para que los clientes encuentren los recursos que buscan.</span><span class="sxs-lookup"><span data-stu-id="06661-450">(A best practice, using this example, is to set up split DNS so that the internal DNS server is authoritative for `contoso.com` and routes requests directly to the SharePoint farm cluster, rather than routing DNS requests to your external DNS server.) You can then map the external IP address to the internal IP address of your on-premises cluster so that clients find the resources they are looking for.</span></span>
  
<span data-ttu-id="06661-451">A partir de aquí, puede que se encuentre con un par de escenarios de recuperación ante desastres diferentes:</span><span class="sxs-lookup"><span data-stu-id="06661-451">From here, you might run into a couple of different disaster-recovery scenarios:</span></span>
  
 <span data-ttu-id="06661-p163">**Escenario de ejemplo: la granja de servidores de SharePoint local no está disponible debido a un error de hardware en la granja de servidores de SharePoint local.** En este caso, una vez que ha completado los pasos para conmutar por error a la granja de SharePoint en Azure, puede configurar el equilibrio de carga de la red en los servidores front-end web de la granja de servidores de recuperación de SharePoint, del mismo modo que hizo con la granja de servidores local. Después puede redirigir el registro de host en el proveedor DNS interno para que apunte a la dirección IP del clúster de la granja de servidores de recuperación. Tenga en cuenta que los registros DNS almacenados en caché en los clientes pueden tardar un poco en actualizarse y apuntar a la granja de servidores de recuperación.</span><span class="sxs-lookup"><span data-stu-id="06661-p163">**Example scenario: The on-premises SharePoint farm is unavailable because of hardware failure in the on-premises SharePoint farm.** In this case, after you have completed the steps for failover to the Azure SharePoint farm, you can configure network load balancing on the recovery SharePoint farm's web-front-end servers, the same way you did with the on-premises farm. You can then redirect the host record in your internal DNS provider to point to the recovery farm's cluster IP address. Note that it can take some time before cached DNS records on clients are refreshed and point to the recovery farm.</span></span>
  
 <span data-ttu-id="06661-p164">**Escenario de ejemplo: el centro de datos local se pierde por completo.** Esta situación puede deberse a un desastre natural, como un incendio o una inundación. En este caso, si esto ocurriera en una empresa es probable que tuviera un centro de datos secundario hospedado en otra región, además de la subred de Azure que tiene sus propios servicios de directorio y DNS. Al igual que ocurre en el escenario de desastres anterior, puede redirigir los registros DNS internos y externos para que apunten a la granja de servidores de SharePoint en Azure. De nuevo, tenga en cuenta que la propagación del registro DNS puede tardar bastante.</span><span class="sxs-lookup"><span data-stu-id="06661-p164">**Example scenario: The on-premises datacenter is lost completely.** This scenario might occur due to a natural disaster, such as a fire or flood. In this case, for an enterprise, you would likely have a secondary datacenter hosted in another region as well as your Azure subnet that has its own directory services and DNS. As in the previous disaster scenario, you can redirect your internal and external DNS records to point to the Azure SharePoint farm. Again, take note that DNS-record propagation can take some time.</span></span>
  
<span data-ttu-id="06661-461">Si usa colecciones de sitios con nombre de host, como se recomienda en [arquitectura e implementación de colecciones de sitios con nombre de host (SharePoint 2013)](https://docs.microsoft.com/SharePoint/administration/host-named-site-collection-architecture-and-deployment), puede tener varias colecciones de sitios hospedadas por la misma aplicación web en su granja de servidores de SharePoint, `https://sales.contoso.com` con `https://marketing.contoso.com`nombres DNS únicos (por ejemplo, y).</span><span class="sxs-lookup"><span data-stu-id="06661-461">If you are using host-named site collections, as recommended in [Host-named site collection architecture and deployment (SharePoint 2013)](https://docs.microsoft.com/SharePoint/administration/host-named-site-collection-architecture-and-deployment), you might have several site collections hosted by the same web application in your SharePoint farm, with unique DNS names (for example, `https://sales.contoso.com` and `https://marketing.contoso.com`).</span></span> <span data-ttu-id="06661-462">En este caso, puede crear registros DNS para cada colección de sitios que señalen la dirección IP del clúster.</span><span class="sxs-lookup"><span data-stu-id="06661-462">In this case, you can create DNS records for each site collection that point to your cluster IP address.</span></span> <span data-ttu-id="06661-463">En cuanto una solicitud llega a los servidores front-end web de SharePoint, estos se encargan de enrutar cada solicitud a la colección de sitios adecuada.</span><span class="sxs-lookup"><span data-stu-id="06661-463">After a request reaches your SharePoint web-front-end servers, they handle routing each request to the appropriate site collection.</span></span>
  
## <a name="microsoft-proof-of-concept-environment"></a><span data-ttu-id="06661-464">Entorno de prueba de concepto de Microsoft</span><span class="sxs-lookup"><span data-stu-id="06661-464">Microsoft proof-of-concept environment</span></span>

<span data-ttu-id="06661-p166">Hemos diseñado y probado un entorno de prueba de concepto para esta solución. El objetivo de diseño para nuestro entorno de prueba era implementar y recuperar una granja de servidores de SharePoint que se puede encontrar en un entorno de cliente. Realizamos varios supuestos pero sabíamos que la granja de servidores tenía que ofrecer toda la funcionalidad de fábrica sin ninguna personalización. La topología se diseñó para alta disponibilidad mediante el uso de directrices y recomendaciones del grupo de campo y de producto.</span><span class="sxs-lookup"><span data-stu-id="06661-p166">We designed and tested a proof-of-concept environment for this solution. The design goal for our test environment was to deploy and recover a SharePoint farm that we might find in a customer environment. We made several assumptions, but we knew that the farm needed to provide all of the out-of-the-box functionality without any customizations. The topology was designed for high availability by using best practice guidance from the field and product group.</span></span>
  
<span data-ttu-id="06661-469">En esta tabla se describen las máquinas virtuales de Hyper-V que hemos creado y configurado para el entorno de prueba local.</span><span class="sxs-lookup"><span data-stu-id="06661-469">The following table describes the Hyper-V virtual machines that we created and configured for the on-premises test environment.</span></span>
  
<span data-ttu-id="06661-470">**Tabla: máquinas virtuales para prueba local**</span><span class="sxs-lookup"><span data-stu-id="06661-470">**Table: Virtual machines for on-premises test**</span></span>

|<span data-ttu-id="06661-471">**Nombre del servidor**</span><span class="sxs-lookup"><span data-stu-id="06661-471">**Server name**</span></span>|<span data-ttu-id="06661-472">**Rol**</span><span class="sxs-lookup"><span data-stu-id="06661-472">**Role**</span></span>|<span data-ttu-id="06661-473">**Configuración**</span><span class="sxs-lookup"><span data-stu-id="06661-473">**Configuration**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="06661-474">DC1</span><span class="sxs-lookup"><span data-stu-id="06661-474">DC1</span></span>  <br/> |<span data-ttu-id="06661-475">Controlador de dominio con Active Directory.</span><span class="sxs-lookup"><span data-stu-id="06661-475">Domain controller with Active Directory.</span></span>  <br/> |<span data-ttu-id="06661-476">Dos procesadores</span><span class="sxs-lookup"><span data-stu-id="06661-476">Two processors</span></span>  <br/> <span data-ttu-id="06661-477">De 512 MB a 4 GB de RAM</span><span class="sxs-lookup"><span data-stu-id="06661-477">From 512 MB through 4 GB of RAM</span></span>  <br/> <span data-ttu-id="06661-478">1 disco duro de 127 GB</span><span class="sxs-lookup"><span data-stu-id="06661-478">1 x 127-GB hard disk</span></span>  <br/> |
|<span data-ttu-id="06661-479">RRAS</span><span class="sxs-lookup"><span data-stu-id="06661-479">RRAS</span></span>  <br/> |<span data-ttu-id="06661-480">Servidor configurado con el rol servicio de enrutamiento y acceso remoto (RRAS).</span><span class="sxs-lookup"><span data-stu-id="06661-480">Server configured with the Routing and Remote Access Service (RRAS) role.</span></span>  <br/> |<span data-ttu-id="06661-481">Dos procesadores</span><span class="sxs-lookup"><span data-stu-id="06661-481">Two processors</span></span>  <br/> <span data-ttu-id="06661-482">De 2 a 8 GB de RAM</span><span class="sxs-lookup"><span data-stu-id="06661-482">2-8 GB of RAM</span></span>  <br/> <span data-ttu-id="06661-483">1 disco duro de 127 GB</span><span class="sxs-lookup"><span data-stu-id="06661-483">1 x 127-GB hard disk</span></span>  <br/> |
|<span data-ttu-id="06661-484">FS1</span><span class="sxs-lookup"><span data-stu-id="06661-484">FS1</span></span>  <br/> |<span data-ttu-id="06661-485">Servidor de archivos con recursos compartidos para copias de seguridad y un extremo para DFSR.</span><span class="sxs-lookup"><span data-stu-id="06661-485">File server with shares for backups and an end point for DFSR.</span></span>  <br/> |<span data-ttu-id="06661-486">Cuatro procesadores</span><span class="sxs-lookup"><span data-stu-id="06661-486">Four processors</span></span>  <br/> <span data-ttu-id="06661-487">De 2 a 12 GB de RAM</span><span class="sxs-lookup"><span data-stu-id="06661-487">2-12 GB of RAM</span></span>  <br/> <span data-ttu-id="06661-488">1 disco duro de 127 GB</span><span class="sxs-lookup"><span data-stu-id="06661-488">1 x 127-GB hard disk</span></span>  <br/> <span data-ttu-id="06661-489">Disco duro (SAN) 1 x 1 TB</span><span class="sxs-lookup"><span data-stu-id="06661-489">1 x 1-TB hard disk (SAN)</span></span>  <br/> <span data-ttu-id="06661-490">Disco duro 1 x 750 GB</span><span class="sxs-lookup"><span data-stu-id="06661-490">1 x 750-GB hard disk</span></span>  <br/> |
|<span data-ttu-id="06661-491">SP-WFE1, SP-WFE2</span><span class="sxs-lookup"><span data-stu-id="06661-491">SP-WFE1, SP-WFE2</span></span>  <br/> |<span data-ttu-id="06661-492">Servidor front-end web</span><span class="sxs-lookup"><span data-stu-id="06661-492">Front-end web servers.</span></span>  <br/> |<span data-ttu-id="06661-493">Cuatro procesadores</span><span class="sxs-lookup"><span data-stu-id="06661-493">Four processors</span></span>  <br/> <span data-ttu-id="06661-494">16 GB de RAM</span><span class="sxs-lookup"><span data-stu-id="06661-494">16 GB of RAM</span></span>  <br/> |
|<span data-ttu-id="06661-495">SP-APP1, SP-APP2, SP-APP3</span><span class="sxs-lookup"><span data-stu-id="06661-495">SP-APP1, SP-APP2, SP-APP3</span></span>  <br/> |<span data-ttu-id="06661-496">Servidores de aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="06661-496">Application servers.</span></span>  <br/> |<span data-ttu-id="06661-497">Cuatro procesadores</span><span class="sxs-lookup"><span data-stu-id="06661-497">Four processors</span></span>  <br/> <span data-ttu-id="06661-498">De 2 a 16 GB de RAM</span><span class="sxs-lookup"><span data-stu-id="06661-498">2-16 GB of RAM</span></span>  <br/> |
|<span data-ttu-id="06661-499">SP-SQL-HA1, SP-SQL-HA2</span><span class="sxs-lookup"><span data-stu-id="06661-499">SP-SQL-HA1, SP-SQL-HA2</span></span>  <br/> |<span data-ttu-id="06661-p167">Servidores de base de datos, configurados con los grupos de disponibilidad AlwaysOn de SQL Server 2012 para proporcionar alta disponibilidad. Esta configuración usa SP-SQL-HA1 y SP-SQL-HA2 como réplicas principales y secundarias.</span><span class="sxs-lookup"><span data-stu-id="06661-p167">Database servers, configured with SQL Server 2012 AlwaysOn availability groups to provide high availability. This configuration uses SP-SQL-HA1 and SP-SQL-HA2 as the primary and secondary replicas.</span></span>  <br/> |<span data-ttu-id="06661-502">Cuatro procesadores</span><span class="sxs-lookup"><span data-stu-id="06661-502">Four processors</span></span>  <br/> <span data-ttu-id="06661-503">De 2 a 16 GB de RAM</span><span class="sxs-lookup"><span data-stu-id="06661-503">2-16 GB of RAM</span></span>  <br/> |
   
<span data-ttu-id="06661-504">En la siguiente tabla se describe la configuración de las unidades de las máquinas virtuales de Hyper-V que hemos creado y configurado para el servidor front-end web y el servidor de aplicaciones, en el entorno de prueba local.</span><span class="sxs-lookup"><span data-stu-id="06661-504">The following table describes drive configurations for the Hyper-V virtual machines that we created and configured for the front-end web and application servers for the on-premises test environment.</span></span>
  
<span data-ttu-id="06661-505">**Tabla: Requisitos de las unidades de las máquinas virtuales para el servidor front-end web y el servidor de aplicaciones en la prueba local**</span><span class="sxs-lookup"><span data-stu-id="06661-505">**Table: Virtual machine drive requirements for the Front End Web and Application servers for the on-premises test**</span></span>

|<span data-ttu-id="06661-506">**Letra de unidad**</span><span class="sxs-lookup"><span data-stu-id="06661-506">**Drive letter**</span></span>|<span data-ttu-id="06661-507">**Tamaño**</span><span class="sxs-lookup"><span data-stu-id="06661-507">**Size**</span></span>|<span data-ttu-id="06661-508">**Nombre de directorio**</span><span class="sxs-lookup"><span data-stu-id="06661-508">**Directory name**</span></span>|<span data-ttu-id="06661-509">**Ruta de acceso**</span><span class="sxs-lookup"><span data-stu-id="06661-509">**Path**</span></span>|
|:-----|:-----|:-----|:-----|
|<span data-ttu-id="06661-510">C</span><span class="sxs-lookup"><span data-stu-id="06661-510">C</span></span>  <br/> |<span data-ttu-id="06661-511">80</span><span class="sxs-lookup"><span data-stu-id="06661-511">80</span></span>  <br/> |<span data-ttu-id="06661-512">Unidad del sistema</span><span class="sxs-lookup"><span data-stu-id="06661-512">System drive</span></span>  <br/> |<span data-ttu-id="06661-513"><DriveLetter>:\\Archivos de programa\\Microsoft SQL Server</span><span class="sxs-lookup"><span data-stu-id="06661-513"><DriveLetter>:\\Program Files\\Microsoft SQL Server</span></span>\\  <br/> |
|<span data-ttu-id="06661-514">E</span><span class="sxs-lookup"><span data-stu-id="06661-514">E</span></span>  <br/> |<span data-ttu-id="06661-515">80</span><span class="sxs-lookup"><span data-stu-id="06661-515">80</span></span>  <br/> |<span data-ttu-id="06661-516">Unidad de registro (40 GB)</span><span class="sxs-lookup"><span data-stu-id="06661-516">Log drive (40 GB)</span></span>  <br/> |<span data-ttu-id="06661-517"><DriveLetter>:\\Archivos de programa\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span><span class="sxs-lookup"><span data-stu-id="06661-517"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span></span>  <br/> |
|<span data-ttu-id="06661-518">F</span><span class="sxs-lookup"><span data-stu-id="06661-518">F</span></span>  <br/> |<span data-ttu-id="06661-519">80</span><span class="sxs-lookup"><span data-stu-id="06661-519">80</span></span>  <br/> |<span data-ttu-id="06661-520">Página (36 GB)</span><span class="sxs-lookup"><span data-stu-id="06661-520">Page (36 GB)</span></span>  <br/> |<span data-ttu-id="06661-521"><DriveLetter>:\\Archivos de programa\\Microsoft SQL Server\\MSSQL\\DATA</span><span class="sxs-lookup"><span data-stu-id="06661-521"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL\\DATA</span></span>  <br/> |
   
<span data-ttu-id="06661-p168">En esta tabla se describe la configuración de las unidades de las máquinas virtuales de Hyper-V que hemos creado y configurado para que funcionen como servidores de base de satos local. En la página **Configuración del Motor de base de datos**, seleccione la pestaña **Directorios de datos** para establecer y confirmar la configuración que se muestra en esta tabla.</span><span class="sxs-lookup"><span data-stu-id="06661-p168">The following table describes drive configurations for the Hyper-V virtual machines created and configured to serve as the on-premises database servers. On the **Database Engine Configuration** page, access the **Data Directories** tab to set and confirm the settings shown in the following table.</span></span>
  
<span data-ttu-id="06661-524">**Tabla: Requisitos de las unidades de las máquinas virtuales para el servidor de bases de datos en la prueba local**</span><span class="sxs-lookup"><span data-stu-id="06661-524">**Table: Virtual machine drive requirements for the database server for the on-premises test**</span></span>

|<span data-ttu-id="06661-525">**Letra de unidad**</span><span class="sxs-lookup"><span data-stu-id="06661-525">**Drive letter**</span></span>|<span data-ttu-id="06661-526">**Tamaño**</span><span class="sxs-lookup"><span data-stu-id="06661-526">**Size**</span></span>|<span data-ttu-id="06661-527">**Nombre de directorio**</span><span class="sxs-lookup"><span data-stu-id="06661-527">**Directory name**</span></span>|<span data-ttu-id="06661-528">**Ruta de acceso**</span><span class="sxs-lookup"><span data-stu-id="06661-528">**Path**</span></span>|
|:-----|:-----|:-----|:-----|
|<span data-ttu-id="06661-529">C</span><span class="sxs-lookup"><span data-stu-id="06661-529">C</span></span>  <br/> |<span data-ttu-id="06661-530">80</span><span class="sxs-lookup"><span data-stu-id="06661-530">80</span></span>  <br/> |<span data-ttu-id="06661-531">Directorio raíz de datos</span><span class="sxs-lookup"><span data-stu-id="06661-531">Data root directory</span></span>  <br/> |<span data-ttu-id="06661-532"><DriveLetter>:\\Archivos de programa\\Microsoft SQL Server</span><span class="sxs-lookup"><span data-stu-id="06661-532"><DriveLetter>:\\Program Files\\Microsoft SQL Server</span></span>\\  <br/> |
|<span data-ttu-id="06661-533">E</span><span class="sxs-lookup"><span data-stu-id="06661-533">E</span></span>  <br/> |<span data-ttu-id="06661-534">500</span><span class="sxs-lookup"><span data-stu-id="06661-534">500</span></span>  <br/> |<span data-ttu-id="06661-535">Directorio de base de datos de usuario</span><span class="sxs-lookup"><span data-stu-id="06661-535">User database directory</span></span>  <br/> |<span data-ttu-id="06661-536"><DriveLetter>:\\Archivos de programa\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span><span class="sxs-lookup"><span data-stu-id="06661-536"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span></span>  <br/> |
|<span data-ttu-id="06661-537">F</span><span class="sxs-lookup"><span data-stu-id="06661-537">F</span></span>  <br/> |<span data-ttu-id="06661-538">500</span><span class="sxs-lookup"><span data-stu-id="06661-538">500</span></span>  <br/> |<span data-ttu-id="06661-539">Directorio de registro de base de datos de usuario</span><span class="sxs-lookup"><span data-stu-id="06661-539">User database log directory</span></span>  <br/> |<span data-ttu-id="06661-540"><DriveLetter>:\\Archivos de programa\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span><span class="sxs-lookup"><span data-stu-id="06661-540"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span></span>  <br/> |
|<span data-ttu-id="06661-541">G</span><span class="sxs-lookup"><span data-stu-id="06661-541">G</span></span>  <br/> |<span data-ttu-id="06661-542">500</span><span class="sxs-lookup"><span data-stu-id="06661-542">500</span></span>  <br/> |<span data-ttu-id="06661-543">Directorio de base de datos temporal</span><span class="sxs-lookup"><span data-stu-id="06661-543">Temp DB directory</span></span>  <br/> |<span data-ttu-id="06661-544"><DriveLetter>:\\Archivos de programa\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span><span class="sxs-lookup"><span data-stu-id="06661-544"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span></span>  <br/> |
|<span data-ttu-id="06661-545">H</span><span class="sxs-lookup"><span data-stu-id="06661-545">H</span></span>  <br/> |<span data-ttu-id="06661-546">500</span><span class="sxs-lookup"><span data-stu-id="06661-546">500</span></span>  <br/> |<span data-ttu-id="06661-547">Directorio de registro de base de datos temporal</span><span class="sxs-lookup"><span data-stu-id="06661-547">Temp DB log directory</span></span>  <br/> |<span data-ttu-id="06661-548"><DriveLetter>:\\Archivos de programa\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span><span class="sxs-lookup"><span data-stu-id="06661-548"><DriveLetter>:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA</span></span>  <br/> |
   
### <a name="setting-up-the-test-environment"></a><span data-ttu-id="06661-549">Configuración del entorno de prueba</span><span class="sxs-lookup"><span data-stu-id="06661-549">Setting up the test environment</span></span>

<span data-ttu-id="06661-p169">Durante las distintas fases de implementación, el equipo de pruebas normalmente trabajó primero en la arquitectura local y luego en el entorno de Azure correspondiente. Esto refleja casos reales generales en los que ya se están ejecutando granjas de servidores de producción. Es muy importante que tenga en cuenta la carga de trabajo, la capacidad y el rendimiento típico de la granja de producción actual. Además de crear un modelo de recuperación ante desastres que resulte adecuado para los requisitos de la empresa, debe cambiar el tamaño de los servidores de la granja de recuperación para que ofrezcan un nivel mínimo de servicio. En un entorno de espera pasiva o semiactiva, una granja de servidores de recuperación tiene normalmente un tamaño menor que una granja de servidores de producción. Una vez que la granja de servidores de recuperación está estable y en producción, puede escalarla verticalmente y horizontalmente para satisfacer los requisitos de carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="06661-p169">During the different deployment phases, the test team typically worked on the on-premises architecture first and then on the corresponding Azure environment. This reflects the general real-world cases where in-house production farms are already running. What is even more important is that you should know the current production workload, capacity, and typical performance. In addition to building a disaster recovery model that can meet business requirements, you should size the recovery farm servers to deliver a minimum level of service. In a cold or warm standby environment, a recovery farm is typically smaller than a production farm. After the recovery farm is stable and in production, the farm can be scaled up and out to meet workload requirements.</span></span>
  
<span data-ttu-id="06661-556">Implementamos nuestro entorno de prueba en tres fases:</span><span class="sxs-lookup"><span data-stu-id="06661-556">We deployed our test environment in the following three phases:</span></span>
  
- <span data-ttu-id="06661-557">Configurar la infraestructura híbrida</span><span class="sxs-lookup"><span data-stu-id="06661-557">Set up the hybrid infrastructure</span></span>
    
- <span data-ttu-id="06661-558">Aprovisionar los servidores</span><span class="sxs-lookup"><span data-stu-id="06661-558">Provision the servers</span></span>
    
- <span data-ttu-id="06661-559">Implementar las granjas de servidores de SharePoint</span><span class="sxs-lookup"><span data-stu-id="06661-559">Deploy the SharePoint farms</span></span>
    
#### <a name="set-up-the-hybrid-infrastructure"></a><span data-ttu-id="06661-560">Configurar la infraestructura híbrida</span><span class="sxs-lookup"><span data-stu-id="06661-560">Set up the hybrid infrastructure</span></span>

<span data-ttu-id="06661-p170">Esta fase supuso configurar un entorno de dominio para la granja de servidores local y para la granja de servidores de recuperación en Azure. Además de las tareas normales asociadas con la configuración de Active Directory, el equipo de pruebas implementó una solución de enrutamiento y una conexión VPN entre los dos entornos.</span><span class="sxs-lookup"><span data-stu-id="06661-p170">This phase involved setting up a domain environment for the on-premises farm and for the recovery farm in Azure. In addition to the normal tasks associated with configuring Active Directory, the test team implemented a routing solution and a VPN connection between the two environments.</span></span>
  
#### <a name="provision-the-servers"></a><span data-ttu-id="06661-563">Aprovisionar los servidores</span><span class="sxs-lookup"><span data-stu-id="06661-563">Provision the servers</span></span>

<span data-ttu-id="06661-p171">Además de los servidores de la granja, había que aprovisionar servidores para los controladores de dominio y configurar un servidor para controlar RRAS, así como la VPN de sitio a sitio. Se aprovisionaron dos servidores de archivos para el servicio DFSR y varios equipos cliente para el personal del equipo de pruebas.</span><span class="sxs-lookup"><span data-stu-id="06661-p171">In addition to the farm servers, it was necessary to provision servers for the domain controllers and configure a server to handle RRAS as well as the site-to-site VPN. Two file servers were provisioned for the DFSR service, and several client computers were provisioned for testers.</span></span>
  
#### <a name="deploy-the-sharepoint-farms"></a><span data-ttu-id="06661-566">Implementar las granjas de servidores de SharePoint</span><span class="sxs-lookup"><span data-stu-id="06661-566">Deploy the SharePoint farms</span></span>

<span data-ttu-id="06661-p172">Las granjas de servidores de SharePoint se implementaron en dos fases para simplificar la estabilización del entorno y la solución de problemas, en caso de que fuera necesario. Durante la primera fase, cada granja de servidores se implementó en el número mínimo de servidores para cada nivel de la topología, con el objetivo de admitir la funcionalidad necesaria.</span><span class="sxs-lookup"><span data-stu-id="06661-p172">The SharePoint farms were deployed in two stages in order to simplify environment stabilization and troubleshooting, if required. During the first stage, each farm was deployed on the minimum number of servers for each tier of the topology to support the required functionality.</span></span>
  
<span data-ttu-id="06661-p173">Creamos los servidores de bases de datos con SQL Server instalado antes de crear los servidores de SharePoint 2013. Como se trataba de una nueva implementación, creamos los grupos de disponibilidad antes de implementar SharePoint: creamos tres grupos siguiendo las recomendaciones de MCS.</span><span class="sxs-lookup"><span data-stu-id="06661-p173">We created the database servers with SQL Server installed before creating the SharePoint 2013 servers. Because this was a new deployment, we created the availability groups before deploying SharePoint. We created three groups based on MCS best practice guidance.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="06661-p174">Cree bases de datos de marcador de posición para poder crear los grupos de disponibilidad antes de instalar SharePoint. Para más información, consulte [Configuración de grupos de disponibilidad AlwaysOn de SQL Server 2012 para SharePoint 2013](https://go.microsoft.com/fwlink/p/?LinkId=517626).</span><span class="sxs-lookup"><span data-stu-id="06661-p174">Create placeholder databases so that you can create availability groups before the SharePoint installation. For more information, see [Configure SQL Server 2012 AlwaysOn Availability Groups for SharePoint 2013](https://go.microsoft.com/fwlink/p/?LinkId=517626)</span></span>
  
<span data-ttu-id="06661-574">Creamos la granja de servidores y unimos servidores adicionales en este orden:</span><span class="sxs-lookup"><span data-stu-id="06661-574">We created the farm and joined additional servers in the following order:</span></span>
  
- <span data-ttu-id="06661-575">Aprovisionar SP-SQL-HA1 y SP-SQL-HA2.</span><span class="sxs-lookup"><span data-stu-id="06661-575">Provision SP-SQL-HA1 and SP-SQL-HA2.</span></span>
    
- <span data-ttu-id="06661-576">Configurar AlwaysOn y crear los tres grupos de disponibilidad para la granja de servidores.</span><span class="sxs-lookup"><span data-stu-id="06661-576">Configure AlwaysOn and create the three availability groups for the farm.</span></span> 
    
- <span data-ttu-id="06661-577">Aprovisionar SP-APP1 para hospedar Administración central.</span><span class="sxs-lookup"><span data-stu-id="06661-577">Provision SP-APP1 to host Central Administration.</span></span>
    
- <span data-ttu-id="06661-578">Aprovisionar WFE1 SP y WFE2 SP para hospedar la caché distribuida.</span><span class="sxs-lookup"><span data-stu-id="06661-578">Provision SP-WFE1 and SP-WFE2 to host the distributed cache.</span></span> 
    
<span data-ttu-id="06661-579">Usamos el parámetro  _skipRegisterAsDistributedCachehost_ cuando ejecutamos **psconfig.exe** en la línea de comandos.</span><span class="sxs-lookup"><span data-stu-id="06661-579">We used the  _skipRegisterAsDistributedCachehost_ parameter when we ran **psconfig.exe** at the command line.</span></span> <span data-ttu-id="06661-580">Para más información, vea [Planear las fuentes y el servicio de caché distribuida en SharePoint Server 2013](https://docs.microsoft.com/sharepoint/administration/plan-for-feeds-and-the-distributed-cache-service).</span><span class="sxs-lookup"><span data-stu-id="06661-580">For more information, see [Plan for feeds and the Distributed Cache service in SharePoint Server 2013](https://docs.microsoft.com/sharepoint/administration/plan-for-feeds-and-the-distributed-cache-service).</span></span> 
  
<span data-ttu-id="06661-581">Repetimos estos pasos en el entorno de recuperación:</span><span class="sxs-lookup"><span data-stu-id="06661-581">We repeated the following steps in the recovery environment:</span></span>
  
- <span data-ttu-id="06661-582">Aprovisionar AZ-SQL-HA1 y AZ-SQL-HA2.</span><span class="sxs-lookup"><span data-stu-id="06661-582">Provision AZ-SQL-HA1 and AZ-SQL-HA2.</span></span>
    
- <span data-ttu-id="06661-583">Configurar AlwaysOn y crear los tres grupos de disponibilidad para la granja de servidores.</span><span class="sxs-lookup"><span data-stu-id="06661-583">Configure AlwaysOn and create the three availability groups for the farm.</span></span>
    
- <span data-ttu-id="06661-584">Aprovisionar AZ-APP1 para hospedar Administración central.</span><span class="sxs-lookup"><span data-stu-id="06661-584">Provision AZ-APP1 to host Central Administration.</span></span>
    
- <span data-ttu-id="06661-585">Aprovisionar WFE1 AZ y AZ-WFE2 para hospedar la caché distribuida.</span><span class="sxs-lookup"><span data-stu-id="06661-585">Provision AZ-WFE1 and AZ-WFE2 to host the distributed cache.</span></span>
    
<span data-ttu-id="06661-p176">Después de configurar la caché distribuida y agregar los usuarios y el contenido de prueba, comenzamos la fase dos de la implementación. Para esto fue necesario escalar horizontalmente los niveles y configurar los servidores de la granja para que admitieran la topología de alta disponibilidad descrita en la arquitectura de la granja de servidores.</span><span class="sxs-lookup"><span data-stu-id="06661-p176">After we configured the distributed cache and added test users and test content, we started stage two of the deployment. This required scaling out the tiers and configuring the farm servers to support the high-availability topology described in the farm architecture.</span></span>
  
<span data-ttu-id="06661-588">En esta tabla se describen las máquinas virtuales, las subredes y los conjuntos de disponibilidad que configuramos para nuestra granja de servidores de recuperación.</span><span class="sxs-lookup"><span data-stu-id="06661-588">The following table describes the virtual machines, subnets, and availability sets we set up for our recovery farm.</span></span>
  
<span data-ttu-id="06661-589">**Tabla: Infraestructura de la granja de servidores de recuperación**</span><span class="sxs-lookup"><span data-stu-id="06661-589">**Table: Recovery farm infrastructure**</span></span>

|<span data-ttu-id="06661-590">**Nombre del servidor**</span><span class="sxs-lookup"><span data-stu-id="06661-590">**Server name**</span></span>|<span data-ttu-id="06661-591">**Rol**</span><span class="sxs-lookup"><span data-stu-id="06661-591">**Role**</span></span>|<span data-ttu-id="06661-592">**Configuración**</span><span class="sxs-lookup"><span data-stu-id="06661-592">**Configuration**</span></span>|<span data-ttu-id="06661-593">**Subred**</span><span class="sxs-lookup"><span data-stu-id="06661-593">**Subnet**</span></span>|<span data-ttu-id="06661-594">**Conjunto de disponibilidad**</span><span class="sxs-lookup"><span data-stu-id="06661-594">**Availability set**</span></span>|
|:-----|:-----|:-----|:-----|:-----|
|<span data-ttu-id="06661-595">spDRAD</span><span class="sxs-lookup"><span data-stu-id="06661-595">spDRAD</span></span>  <br/> |<span data-ttu-id="06661-596">Controlador de dominio con Active Directory</span><span class="sxs-lookup"><span data-stu-id="06661-596">Domain controller with Active Directory</span></span>  <br/> |<span data-ttu-id="06661-597">Dos procesadores</span><span class="sxs-lookup"><span data-stu-id="06661-597">Two processors</span></span>  <br/> <span data-ttu-id="06661-598">De 512 MB a 4 GB de RAM</span><span class="sxs-lookup"><span data-stu-id="06661-598">From 512 MB through 4 GB of RAM</span></span>  <br/> <span data-ttu-id="06661-599">1 disco duro de 127 GB</span><span class="sxs-lookup"><span data-stu-id="06661-599">1 x 127-GB hard disk</span></span>  <br/> |<span data-ttu-id="06661-600">sp-ADservers</span><span class="sxs-lookup"><span data-stu-id="06661-600">sp-ADservers</span></span>  <br/> ||
|<span data-ttu-id="06661-601">AZ-SP-FS</span><span class="sxs-lookup"><span data-stu-id="06661-601">AZ-SP-FS</span></span>  <br/> |<span data-ttu-id="06661-602">Servidor de archivos con recursos compartidos para copias de seguridad y un extremo para DFSR</span><span class="sxs-lookup"><span data-stu-id="06661-602">File server with shares for backups and an endpoint for DFSR</span></span>  <br/> | <span data-ttu-id="06661-603">Configuración de A5:</span><span class="sxs-lookup"><span data-stu-id="06661-603">A5 configuration:</span></span> <br/>  <span data-ttu-id="06661-604">Dos procesadores</span><span class="sxs-lookup"><span data-stu-id="06661-604">Two processors</span></span> <br/>  <span data-ttu-id="06661-605">14 GB de RAM</span><span class="sxs-lookup"><span data-stu-id="06661-605">14 GB of RAM</span></span> <br/>  <span data-ttu-id="06661-606">1 disco duro de 127 GB</span><span class="sxs-lookup"><span data-stu-id="06661-606">1 x 127-GB hard disk</span></span> <br/>  <span data-ttu-id="06661-607">1 disco duro de 135 GB</span><span class="sxs-lookup"><span data-stu-id="06661-607">1 x 135-GB hard disk</span></span> <br/>  <span data-ttu-id="06661-608">1 disco duro de 127 GB</span><span class="sxs-lookup"><span data-stu-id="06661-608">1 x 127-GB hard disk</span></span> <br/>  <span data-ttu-id="06661-609">1 disco duro de 150 GB</span><span class="sxs-lookup"><span data-stu-id="06661-609">1 x 150-GB hard disk</span></span> <br/> |<span data-ttu-id="06661-610">sp-databaseservers</span><span class="sxs-lookup"><span data-stu-id="06661-610">sp-databaseservers</span></span>  <br/> |<span data-ttu-id="06661-611">DATA_SET</span><span class="sxs-lookup"><span data-stu-id="06661-611">DATA_SET</span></span>  <br/> |
|<span data-ttu-id="06661-612">AZ-WFE1, AZ -WFE2</span><span class="sxs-lookup"><span data-stu-id="06661-612">AZ-WFE1, AZ -WFE2</span></span>  <br/> |<span data-ttu-id="06661-613">Servidores front-end web</span><span class="sxs-lookup"><span data-stu-id="06661-613">Front End Web servers</span></span>  <br/> | <span data-ttu-id="06661-614">Configuración de A5:</span><span class="sxs-lookup"><span data-stu-id="06661-614">A5 configuration:</span></span> <br/>  <span data-ttu-id="06661-615">Dos procesadores</span><span class="sxs-lookup"><span data-stu-id="06661-615">Two processors</span></span> <br/>  <span data-ttu-id="06661-616">14 GB de RAM</span><span class="sxs-lookup"><span data-stu-id="06661-616">14 GB of RAM</span></span> <br/>  <span data-ttu-id="06661-617">1 disco duro de 127 GB</span><span class="sxs-lookup"><span data-stu-id="06661-617">1 x 127-GB hard disk</span></span> <br/> |<span data-ttu-id="06661-618">sp-webservers</span><span class="sxs-lookup"><span data-stu-id="06661-618">sp-webservers</span></span>  <br/> |<span data-ttu-id="06661-619">WFE_SET</span><span class="sxs-lookup"><span data-stu-id="06661-619">WFE_SET</span></span>  <br/> |
|<span data-ttu-id="06661-620">AZ -APP1, AZ -APP2, AZ -APP3</span><span class="sxs-lookup"><span data-stu-id="06661-620">AZ -APP1, AZ -APP2, AZ -APP3</span></span>  <br/> |<span data-ttu-id="06661-621">Servidores de aplicaciones</span><span class="sxs-lookup"><span data-stu-id="06661-621">Application servers</span></span>  <br/> | <span data-ttu-id="06661-622">Configuración de A5:</span><span class="sxs-lookup"><span data-stu-id="06661-622">A5 configuration:</span></span> <br/>  <span data-ttu-id="06661-623">Dos procesadores</span><span class="sxs-lookup"><span data-stu-id="06661-623">Two processors</span></span> <br/>  <span data-ttu-id="06661-624">14 GB de RAM</span><span class="sxs-lookup"><span data-stu-id="06661-624">14 GB of RAM</span></span> <br/>  <span data-ttu-id="06661-625">1 disco duro de 127 GB</span><span class="sxs-lookup"><span data-stu-id="06661-625">1 x 127-GB hard disk</span></span> <br/> |<span data-ttu-id="06661-626">sp-applicationservers</span><span class="sxs-lookup"><span data-stu-id="06661-626">sp-applicationservers</span></span>  <br/> |<span data-ttu-id="06661-627">APP_SET</span><span class="sxs-lookup"><span data-stu-id="06661-627">APP_SET</span></span>  <br/> |
|<span data-ttu-id="06661-628">AZ -SQL-HA1, AZ -SQL-HA2</span><span class="sxs-lookup"><span data-stu-id="06661-628">AZ -SQL-HA1, AZ -SQL-HA2</span></span>  <br/> |<span data-ttu-id="06661-629">Servidores de base de datos y réplicas principales y secundarias para los grupos de disponibilidad AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="06661-629">Database servers and primary and secondary replicas for AlwaysOn availability groups</span></span>  <br/> | <span data-ttu-id="06661-630">Configuración de A5:</span><span class="sxs-lookup"><span data-stu-id="06661-630">A5 configuration:</span></span> <br/>  <span data-ttu-id="06661-631">Dos procesadores</span><span class="sxs-lookup"><span data-stu-id="06661-631">Two processors</span></span> <br/>  <span data-ttu-id="06661-632">14 GB de RAM</span><span class="sxs-lookup"><span data-stu-id="06661-632">14 GB of RAM</span></span> <br/> |<span data-ttu-id="06661-633">sp-databaseservers</span><span class="sxs-lookup"><span data-stu-id="06661-633">sp-databaseservers</span></span>  <br/> |<span data-ttu-id="06661-634">DATA_SET</span><span class="sxs-lookup"><span data-stu-id="06661-634">DATA_SET</span></span>  <br/> |
   
### <a name="operations"></a><span data-ttu-id="06661-635">Operaciones</span><span class="sxs-lookup"><span data-stu-id="06661-635">Operations</span></span>

<span data-ttu-id="06661-636">En cuanto el equipo de pruebas estabilizó los entornos de la granja de servidores y finalizó las pruebas funcionales, empezó a realizar estas tareas de operaciones, necesarias para configurar el entorno de recuperación local:</span><span class="sxs-lookup"><span data-stu-id="06661-636">After the test team stabilized the farm environments and completed functional testing, they started the following operations tasks required to configure the on-premises recovery environment:</span></span>
  
- <span data-ttu-id="06661-637">Configurar copias de seguridad completas y diferenciales</span><span class="sxs-lookup"><span data-stu-id="06661-637">Configure full and differential backups.</span></span>
    
- <span data-ttu-id="06661-638">Configurar DFSR en los servidores de archivos que transfieren los registros de transacciones entre el entorno local y el entorno de Azure.</span><span class="sxs-lookup"><span data-stu-id="06661-638">Configure DFSR on the file servers that transfer transaction logs between the on-premises environment and the Azure environment.</span></span>
    
- <span data-ttu-id="06661-639">Configurar el trasvase de registros en el servidor de bases de datos principal.</span><span class="sxs-lookup"><span data-stu-id="06661-639">Configure log shipping on the primary database server.</span></span>
    
- <span data-ttu-id="06661-p177">Estabilizar, validar y solucionar problemas de trasvase de registros, según sea necesario. Esto incluye identificar y documentar cualquier comportamiento que pueda causar problemas, como la latencia de red, que podría ocasionar errores de trasvase de registros o de sincronización de archivos DFSR.</span><span class="sxs-lookup"><span data-stu-id="06661-p177">Stabilize, validate, and troubleshoot log shipping, as required. This included identifying and documenting any behavior that might cause issues, such as network latency, which would cause log shipping or DFSR file synchronization failures.</span></span>
    
### <a name="databases"></a><span data-ttu-id="06661-642">Bases de datos</span><span class="sxs-lookup"><span data-stu-id="06661-642">Databases</span></span>

<span data-ttu-id="06661-643">Nuestras pruebas de conmutación por error incluyeron estas bases de datos:</span><span class="sxs-lookup"><span data-stu-id="06661-643">Our failover tests involved the following databases:</span></span> 
  
- <span data-ttu-id="06661-644">WSS_Content</span><span class="sxs-lookup"><span data-stu-id="06661-644">WSS_Content</span></span>
    
- <span data-ttu-id="06661-645">ManagedMetadata</span><span class="sxs-lookup"><span data-stu-id="06661-645">ManagedMetadata</span></span>
    
- <span data-ttu-id="06661-646">Base de datos de perfil</span><span class="sxs-lookup"><span data-stu-id="06661-646">Profile DB</span></span>
    
- <span data-ttu-id="06661-647">Base de datos de sincronización</span><span class="sxs-lookup"><span data-stu-id="06661-647">Sync DB</span></span>
    
- <span data-ttu-id="06661-648">Base de datos social</span><span class="sxs-lookup"><span data-stu-id="06661-648">Social DB</span></span>
    
- <span data-ttu-id="06661-649">Concentrador de tipo de contenido (una base de datos para un concentrador de sindicación de tipo de contenido dedicado)</span><span class="sxs-lookup"><span data-stu-id="06661-649">Content Type Hub (a database for a dedicated Content Type Syndication Hub)</span></span>
    
## <a name="troubleshooting-tips"></a><span data-ttu-id="06661-650">Sugerencias para solucionar problemas</span><span class="sxs-lookup"><span data-stu-id="06661-650">Troubleshooting tips</span></span>

<span data-ttu-id="06661-651">En esta sección se explican los problemas producidos durante las pruebas y sus soluciones.</span><span class="sxs-lookup"><span data-stu-id="06661-651">The section explains the problems we encountered during our testing and their solutions.</span></span> 
  
### <a name="using-the-term-store-management-tool-caused-the-error-the-managed-metadata-store-or-connection-is-currently-not-available"></a><span data-ttu-id="06661-652">Al usar la Herramienta de administración del almacén de términos se produce un error que indica que la conexión o el almacén de metadatos administrado no están disponibles"</span><span class="sxs-lookup"><span data-stu-id="06661-652">Using the Term Store Management Tool caused the error, "The Managed Metadata Store or Connection is currently not available."</span></span>

<span data-ttu-id="06661-653">Asegúrese de que la cuenta del grupo de aplicaciones usada por la aplicación web tiene acceso de lectura al permiso del almacén de términos.</span><span class="sxs-lookup"><span data-stu-id="06661-653">Ensure that the application pool account used by the web application has the Read Access to Term Store permission.</span></span>
  
### <a name="custom-term-sets-are-not-available-in-the-site-collection"></a><span data-ttu-id="06661-654">Los conjuntos de términos personalizados no están disponibles en la colección de sitios</span><span class="sxs-lookup"><span data-stu-id="06661-654">Custom term sets are not available in the site collection</span></span>

<span data-ttu-id="06661-p178">Compruebe si falta alguna asociación de aplicación de servicio entre la colección de sitios de contenido y el centro de tipo de contenido. Además, en la pantalla **Metadatos administrados:<site collection name> Propiedades de conexión**, asegúrese de que esté habilitada esta opción: **Esta aplicación de servicio es la ubicación de almacenamiento predeterminada para conjuntos de términos específicos de columnas**.</span><span class="sxs-lookup"><span data-stu-id="06661-p178">Check for a missing service application association between your content site collection and your content type hub. In addition, under the **Managed Metadata - <site collection name> Connection** properties screen, make sure this option is enabled: **This service application is the default storage location for column specific term sets.**</span></span>
  
### <a name="the-get-adforest-windows-powershell-command-generates-the-error-the-term-get-adforest-is-not-recognized-as-the-name-of-a-cmdlet-function-script-file-or-operable-program"></a><span data-ttu-id="06661-657">El comando Get-ADForest de Windows PowerShell genera el error: "El término 'Get-ADForest' no se reconoce como nombre de un cmdlet, función, archivo de script o programa ejecutable"</span><span class="sxs-lookup"><span data-stu-id="06661-657">The Get-ADForest Windows PowerShell command generates the error, "The term 'Get-ADForest' is not recognized as the name of a cmdlet, function, script file, or operable program."</span></span>

<span data-ttu-id="06661-p179">Cuando configure los perfiles de usuario, necesitará el nombre del bosque de Active Directory. En el Asistente para agregar roles y características, asegúrese de que ha habilitado el Módulo Active Directory para Windows PowerShell (en la sección **Herramientas de administración remota del servidor>Herramientas de administración de roles>Herramientas de AD DS y AD LDS**). Además, ejecute estos comandos antes de usar **Get ADForest** para asegurarse de que se cargan las dependencias de software.</span><span class="sxs-lookup"><span data-stu-id="06661-p179">When setting up user profiles, you need the Active Directory forest name. In the Add Roles and Features Wizard, ensure that you have enabled the Active Directory Module for Windows PowerShell (under the **Remote Server Administration Tools>Role Administration Tools>AD DS and AD LDS Tools** section). In addition, run the following commands before using **Get-ADForest** to help ensure that your software dependencies are loaded.</span></span>
  
```
Import-module servermanager
Import-module activedirectory

```

### <a name="availability-group-creation-fails-at-starting-the-alwayson_health-xevent-session-on-server-name"></a><span data-ttu-id="06661-661">Se produce un error en la creación del grupo de disponibilidad al iniciar la sesión de XEvent 'AlwaysOn_health' en '<server name>'</span><span class="sxs-lookup"><span data-stu-id="06661-661">Availability group creation fails at Starting the 'AlwaysOn_health' XEvent session on '<server name>'</span></span>

<span data-ttu-id="06661-662">Asegúrese de que los dos nodos del clúster de conmutación por error tienen el estado "Arriba" y no "En pausa" o "Detenido".</span><span class="sxs-lookup"><span data-stu-id="06661-662">Ensure that both nodes of your failover cluster are in the Status "Up" and not "Paused" or "Stopped".</span></span> 
  
### <a name="sql-server-log-shipping-job-fails-with-access-denied-error-trying-to-connect-to-the-file-share"></a><span data-ttu-id="06661-663">El trabajo de trasvase de registros de SQL Server genera un error de acceso denegado al intentar conectar con el recurso compartido de archivos</span><span class="sxs-lookup"><span data-stu-id="06661-663">SQL Server log shipping job fails with access denied error trying to connect to the file share</span></span>

<span data-ttu-id="06661-664">Asegúrese de que el Agente SQL Server se ejecuta con credenciales de red, en lugar de las credenciales predeterminadas.</span><span class="sxs-lookup"><span data-stu-id="06661-664">Ensure that your SQL Server Agent is running under network credentials, instead of the default credentials.</span></span>
  
### <a name="sql-server-log-shipping-job-indicates-success-but-no-files-are-copied"></a><span data-ttu-id="06661-665">El trabajo de trasvase de registros de SQL Server indica que se ha realizado correctamente, pero no se ha copiado ningún archivo</span><span class="sxs-lookup"><span data-stu-id="06661-665">SQL Server log shipping job indicates success, but no files are copied</span></span>

<span data-ttu-id="06661-p180">Esto sucede porque la preferencia de copia de seguridad predeterminada para un grupo de disponibilidad es **Preferir secundaria**. Asegúrese de ejecutar la tarea de trasvase de registros desde el servidor secundario para el grupo de disponibilidad, en lugar de usar el servidor principal, o devolverá un error silenciosamente.</span><span class="sxs-lookup"><span data-stu-id="06661-p180">This happens because the default backup preference for an availability group is **Prefer Secondary**. Ensure that you run the log shipping job from the secondary server for the availability group instead of the primary; otherwise, the job will fail silently.</span></span> 
  
### <a name="managed-metadata-service-or-other-sharepoint-service-fails-to-start-automatically-after-installation"></a><span data-ttu-id="06661-668">El servicio de metadatos administrados (u otro servicio de SharePoint) no se puede iniciar automáticamente después de la instalación</span><span class="sxs-lookup"><span data-stu-id="06661-668">Managed Metadata service (or other SharePoint service) fails to start automatically after installation</span></span>

<span data-ttu-id="06661-669">Los servicios pueden tardar varios minutos en iniciarse, en función del rendimiento y la carga actual del servidor de SharePoint.</span><span class="sxs-lookup"><span data-stu-id="06661-669">Services might take several minutes to start, depending on the performance and current load of your SharePoint Server.</span></span> <span data-ttu-id="06661-670">Haga clic manualmente en **iniciar** para el servicio y proporcione la hora adecuada para el inicio mientras que, de vez en cuando, actualice la pantalla de servicios en el servidor para supervisar su estado.</span><span class="sxs-lookup"><span data-stu-id="06661-670">Manually click **Start** for the service and provide adequate time for startup while occasionally refreshing the Services on Server screen to monitor its status.</span></span> <span data-ttu-id="06661-671">En caso de que el servicio permanezca detenido, habilite el registro de diagnóstico de SharePoint, intente volver a iniciar el servicio y compruebe si hay errores en el registro.</span><span class="sxs-lookup"><span data-stu-id="06661-671">In case the service remains stopped, enable SharePoint diagnostic logging, attempt to start the service again, and then check the log for errors.</span></span> <span data-ttu-id="06661-672">Para obtener más información, vea [configurar el registro de diagnóstico en SharePoint 2013](https://docs.microsoft.com/sharepoint/administration/configure-diagnostic-logging)</span><span class="sxs-lookup"><span data-stu-id="06661-672">For more information, see [Configure diagnostic logging in SharePoint 2013](https://docs.microsoft.com/sharepoint/administration/configure-diagnostic-logging)</span></span>
  
### <a name="after-changing-dns-to-the-azure-failover-environment-client-browsers-continue-to-use-the-old-ip-address-for-the-sharepoint-site"></a><span data-ttu-id="06661-673">Después de cambiar DNS al entorno de conmutación por error de Azure, los exploradores de los clientes siguen usando la antigua dirección IP para el sitio de SharePoint</span><span class="sxs-lookup"><span data-stu-id="06661-673">After changing DNS to the Azure failover environment, client browsers continue to use the old IP address for the SharePoint site</span></span>

<span data-ttu-id="06661-p182">Es posible que el cambio de DNS no esté visible para todos los clientes inmediatamente. En un cliente de prueba, ejecute este comando desde un símbolo del sistema con privilegios elevados e intente acceder de nuevo al sitio.</span><span class="sxs-lookup"><span data-stu-id="06661-p182">Your DNS change might not be visible to all clients immediately. On a test client, perform the following command from an elevated command prompt and attempt to access the site again.</span></span>
  
```
Ipconfig /flushdns
```

## <a name="additional-resources"></a><span data-ttu-id="06661-676">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="06661-676">Additional resources</span></span>

[<span data-ttu-id="06661-677">Compatibilidad de alta disponibilidad y opciones de recuperación ante desastres para bases de datos de SharePoint</span><span class="sxs-lookup"><span data-stu-id="06661-677">Supported high availability and disaster recovery options for SharePoint databases</span></span>](https://docs.microsoft.com/sharepoint/administration/supported-high-availability-and-disaster-recovery-options-for-sharepoint-databas)
  
[<span data-ttu-id="06661-678">Configuración de grupos de disponibilidad AlwaysOn de SQL Server 2012 para SharePoint 2013</span><span class="sxs-lookup"><span data-stu-id="06661-678">Configure SQL Server 2012 AlwaysOn Availability Groups for SharePoint 2013</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=393122)
  
## <a name="see-also"></a><span data-ttu-id="06661-679">Vea también</span><span class="sxs-lookup"><span data-stu-id="06661-679">See Also</span></span>

[<span data-ttu-id="06661-680">Adopción de la nube y soluciones híbridas</span><span class="sxs-lookup"><span data-stu-id="06661-680">Cloud adoption and hybrid solutions</span></span>](cloud-adoption-and-hybrid-solutions.md)



