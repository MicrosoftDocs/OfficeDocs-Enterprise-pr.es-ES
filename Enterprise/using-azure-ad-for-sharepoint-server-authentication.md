---
title: Uso de Azure AD para la autenticación de SharePoint Server
ms.author: tracyp
author: MSFTTracyP
ms.reviewer: kirke, josephd, kirks
manager: laurawi
audience: ITPro
ms.topic: article
ms.service: o365-solutions
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Ent_O365
- Ent_O365_Hybrid
ms.custom: Ent_Solutions
ms.assetid: ''
description: 'Resumen: Obtenga información sobre cómo omitir Azure Access Control Service y usar SAML 1,1 para autenticar a los usuarios de SharePoint Server con Azure Active Directory.'
ms.openlocfilehash: c2c9f33aa5e095a8b7fdde08e80cb1a61e88f3eb
ms.sourcegitcommit: 08e1e1c09f64926394043291a77856620d6f72b5
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 05/15/2019
ms.locfileid: "34070796"
---
# <a name="using-azure-ad-for-sharepoint-server-authentication"></a><span data-ttu-id="15b09-103">Uso de Azure AD para la autenticación de SharePoint Server</span><span class="sxs-lookup"><span data-stu-id="15b09-103">Using Azure AD for SharePoint Server Authentication</span></span>

 <span data-ttu-id="15b09-104">**Resumen:** Obtenga información sobre cómo autenticar a los usuarios de SharePoint Server 2016 con Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="15b09-104">**Summary:** Learn how to authenticate your SharePoint Server 2016 users with Azure Active Directory.</span></span> 

<blockquote>
<p><span data-ttu-id="15b09-105">Este artículo hace referencia a ejemplos de código para interactuar con el gráfico de Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="15b09-105">This article refers to code samples for interacting with Azure Active Directory Graph.</span></span> <span data-ttu-id="15b09-106">Puede descargar los ejemplos de código [aquí](https://github.com/kaevans/spsaml11/tree/master/scripts).</span><span class="sxs-lookup"><span data-stu-id="15b09-106">You can download the code samples [here](https://github.com/kaevans/spsaml11/tree/master/scripts).</span></span></p>
</blockquote>

<span data-ttu-id="15b09-107">SharePoint Server 2016 permite autenticar a los usuarios mediante la autenticación basada en notificaciones, lo que facilita la administración de los usuarios mediante su autenticación con proveedores de identidades diferentes en los que confía, pero que otras personas administran.</span><span class="sxs-lookup"><span data-stu-id="15b09-107">SharePoint Server 2016 provides the ability to authenticate users using claims-based authentication, making it easy to manage your users by authenticating them with different identity providers that you trust but someone else manages.</span></span> <span data-ttu-id="15b09-108">Por ejemplo, en lugar de administrar la autenticación de usuario a través de los servicios de dominio de Active Directory (AD DS), puede permitir que los usuarios se autentiquen con Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="15b09-108">For example, instead of managing user authentication through Active Directory Domain Services (AD DS), you could enable users to authenticate using Azure Active Directory (Azure AD).</span></span> <span data-ttu-id="15b09-109">Esto habilita la autenticación para los usuarios de solo nube con el sufijo onmicrosoft.com en su nombre de usuario, los usuarios sincronizados con un directorio local y los usuarios invitados invitados desde otros directorios.</span><span class="sxs-lookup"><span data-stu-id="15b09-109">This enables authentication for cloud-only users with the onmicrosoft.com suffix in their username, users synchronized with an on-premises directory, and invited guest users from other directories.</span></span> <span data-ttu-id="15b09-110">También le permite aprovechar las ventajas de las características de Azure AD, como la autenticación multifactor y las capacidades de informes avanzadas.</span><span class="sxs-lookup"><span data-stu-id="15b09-110">It also enables you to take advantage of Azure AD features such as multi-factor authentication and advanced reporting capabilities.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="15b09-111">La solución que se describe en este artículo también puede usarse con SharePoint Server 2013; sin embargo, tenga en cuenta que SharePoint Server 2013 está llegando al final de la compatibilidad estándar.</span><span class="sxs-lookup"><span data-stu-id="15b09-111">The solution described in this article can also be used with SharePoint Server 2013; however, keep in mind that SharePoint Server 2013 is nearing the end of mainstream support.</span></span> <span data-ttu-id="15b09-112">Para obtener más información, vea [Directiva de ciclo de vida de Microsoft](https://support.microsoft.com/en-us/lifecycle/search?alpha=SharePoint%20Server%202013) y [Directiva de servicio del producto actualizada para SharePoint 2013](https://technet.microsoft.com/library/684173bb-e90a-4eb7-b268-b8d7458bc802(v=office.16).aspx).</span><span class="sxs-lookup"><span data-stu-id="15b09-112">For more information, see [Microsoft Lifecycle Policy](https://support.microsoft.com/en-us/lifecycle/search?alpha=SharePoint%20Server%202013) and [Updated Product Servicing Policy for SharePoint 2013](https://technet.microsoft.com/library/684173bb-e90a-4eb7-b268-b8d7458bc802(v=office.16).aspx).</span></span>

<span data-ttu-id="15b09-113">En este artículo se explica cómo se puede usar Azure AD en lugar de su AD DS local para autenticar a los usuarios.</span><span class="sxs-lookup"><span data-stu-id="15b09-113">This article explains how you can use Azure AD instead of your on-premises AD DS to authenticate your users.</span></span> <span data-ttu-id="15b09-114">En esta configuración, Azure AD se convierte en un proveedor de identidad de confianza para SharePoint Server 2016.</span><span class="sxs-lookup"><span data-stu-id="15b09-114">In this configuration, Azure AD becomes a trusted identity provider for SharePoint Server 2016.</span></span> <span data-ttu-id="15b09-115">Esta configuración agrega un método de autenticación de usuario que es independiente de la autenticación de AD DS que usa la instalación de SharePoint Server 2016.</span><span class="sxs-lookup"><span data-stu-id="15b09-115">This configuration adds a user authentication method that is separate from the AD DS authentication used by the SharePoint Server 2016 installation itself.</span></span> <span data-ttu-id="15b09-116">Para sacarle el máximo partido a este artículo, recomendamos que esté familiarizado con WS-Federation.</span><span class="sxs-lookup"><span data-stu-id="15b09-116">To benefit from this article, you should be familiar with WS-Federation.</span></span> <span data-ttu-id="15b09-117">Para más información, consulte el tema de [introducción a WS-Federation ](https://go.microsoft.com/fwlink/p/?linkid=188052).</span><span class="sxs-lookup"><span data-stu-id="15b09-117">For more information, see [Understanding WS-Federation](https://go.microsoft.com/fwlink/p/?linkid=188052).</span></span> <span data-ttu-id="15b09-118">Para obtener información detallada sobre la integración de SharePoint local con Azure Active Directory, vea el [tutorial dedicado](https://docs.microsoft.com/azure/active-directory/saas-apps/sharepoint-on-premises-tutorial).</span><span class="sxs-lookup"><span data-stu-id="15b09-118">For detailed information about integration of SharePoint on-premises with Azure Active Directory, see the [dedicated tutorial](https://docs.microsoft.com/azure/active-directory/saas-apps/sharepoint-on-premises-tutorial).</span></span>

![Uso de Azure AD para la autenticación de SharePoint](media/SAML11/fig1-architecture.png)

<span data-ttu-id="15b09-120">Anteriormente, esta configuración habría requerido un servicio de Federación como Azure Access Control Service (ACS) en la nube o un entorno que hospede los servicios de Federación de Active Directory (AD FS) para transformar los tokens de SAML 2,0 a SAML 1,1.</span><span class="sxs-lookup"><span data-stu-id="15b09-120">Previously, this configuration would have required a federation service such as Azure Access Control Service (ACS) in the cloud or an environment that hosts Active Directory Federation Services (AD FS) to transform tokens from SAML 2.0 to SAML 1.1.</span></span> <span data-ttu-id="15b09-121">Esta transformación ya no es necesaria ya que Azure AD ahora habilita la emisión de tokens SAML 1,1.</span><span class="sxs-lookup"><span data-stu-id="15b09-121">This transformation is no longer required as Azure AD now enables issuing SAML 1.1 tokens.</span></span> <span data-ttu-id="15b09-122">El diagrama anterior muestra cómo funciona la autenticación para los usuarios de SharePoint 2016 en esta configuración, lo que demuestra que ya no es necesario que un intermediario realice esta transformación.</span><span class="sxs-lookup"><span data-stu-id="15b09-122">The diagram above shows how authentication works for SharePoint 2016 users in this configuration, demonstrating that there is no longer a requirement for an intermediary to perform this transformation.</span></span>

> [!NOTE]
> <span data-ttu-id="15b09-123">Esta configuración funciona si la granja de servidores de SharePoint está hospedada en máquinas virtuales de Azure o en local.</span><span class="sxs-lookup"><span data-stu-id="15b09-123">This configuration works whether the SharePoint farm is hosted in Azure virtual machines or on-premises.</span></span> <span data-ttu-id="15b09-124">No requiere que se abran otros puertos de firewall que no sean la garantía de que los usuarios puedan acceder a Azure Active Directory desde el explorador.</span><span class="sxs-lookup"><span data-stu-id="15b09-124">It does not require opening additional firewall ports other than ensuring users can access Azure Active Directory from their browser.</span></span>

<span data-ttu-id="15b09-125">Para obtener información sobre la accesibilidad de SharePoint 2016, vea [directrices de accesibilidad en SharePoint Server 2016](https://go.microsoft.com/fwlink/p/?LinkId=393123).</span><span class="sxs-lookup"><span data-stu-id="15b09-125">For information about SharePoint 2016 accessibility, see [Accessibility Guidelines in SharePoint Server 2016](https://go.microsoft.com/fwlink/p/?LinkId=393123).</span></span>

## <a name="configuration-overview"></a><span data-ttu-id="15b09-126">Descripción general de la configuración</span><span class="sxs-lookup"><span data-stu-id="15b09-126">Configuration overview</span></span>

<span data-ttu-id="15b09-127">Siga estos pasos generales para configurar el entorno para que use Azure AD como un proveedor de identidades de SharePoint Server 2016.</span><span class="sxs-lookup"><span data-stu-id="15b09-127">Follow these general steps to set up your environment to use Azure AD as a SharePoint Server 2016 identity provider.</span></span>

1. <span data-ttu-id="15b09-128">Cree un nuevo directorio de Azure AD o use el directorio existente.</span><span class="sxs-lookup"><span data-stu-id="15b09-128">Create a new Azure AD directory or use your existing directory.</span></span>
2. <span data-ttu-id="15b09-129">Asegúrese de que la zona de la aplicación web que desea proteger con Azure AD esté configurada para usar SSL.</span><span class="sxs-lookup"><span data-stu-id="15b09-129">Ensure the zone for the web application that you want to secure with Azure AD is configured to use SSL.</span></span>
3. <span data-ttu-id="15b09-130">Cree una nueva aplicación de empresa en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="15b09-130">Create a new enterprise application in Azure AD.</span></span>
4. <span data-ttu-id="15b09-131">Configure un nuevo proveedor de identidades de confianza en SharePoint Server 2016.</span><span class="sxs-lookup"><span data-stu-id="15b09-131">Configure a new trusted identity provider in SharePoint Server 2016.</span></span>
5. <span data-ttu-id="15b09-132">Establezca los permisos para la aplicación Web.</span><span class="sxs-lookup"><span data-stu-id="15b09-132">Set the permissions for the web application.</span></span>
6. <span data-ttu-id="15b09-133">Agregue una directiva de emisión de token SAML 1,1 en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="15b09-133">Add a SAML 1.1 token issuance policy in Azure AD.</span></span>
7. <span data-ttu-id="15b09-134">Compruebe el nuevo proveedor.</span><span class="sxs-lookup"><span data-stu-id="15b09-134">Verify the new provider.</span></span>

<span data-ttu-id="15b09-135">En las secciones siguientes se describe cómo realizar estas tareas.</span><span class="sxs-lookup"><span data-stu-id="15b09-135">The following sections describe how to perform these tasks.</span></span>

## <a name="step-1-create-a-new-azure-ad-directory-or-use-your-existing-directory"></a><span data-ttu-id="15b09-136">Paso 1: crear un nuevo directorio de Azure AD o usar el directorio existente</span><span class="sxs-lookup"><span data-stu-id="15b09-136">Step 1: Create a new Azure AD directory or use your existing directory</span></span>

<span data-ttu-id="15b09-137">En el portal de Azure[https://portal.azure.com](https://portal.azure.com)(), cree un nuevo directorio.</span><span class="sxs-lookup"><span data-stu-id="15b09-137">In the Azure Portal ([https://portal.azure.com](https://portal.azure.com)), create a new directory.</span></span> <span data-ttu-id="15b09-138">Proporcione el nombre de la organización, el nombre del dominio inicial y el país o la región.</span><span class="sxs-lookup"><span data-stu-id="15b09-138">Provide the organization name, initial domain name, and the country or region.</span></span>

![Creación de un directorio](media/SAML11/fig2-createdirectory.png) 

 <span data-ttu-id="15b09-140">Si ya tiene un directorio como el que se usa para Microsoft Office 365 o su suscripción de Microsoft Azure, puede usar ese directorio en su lugar.</span><span class="sxs-lookup"><span data-stu-id="15b09-140">If you already have a directory such as the one used for Microsoft Office 365 or your Microsoft Azure subscription, you can use that directory instead.</span></span> <span data-ttu-id="15b09-141">Debe tener permisos para registrar las aplicaciones en el directorio.</span><span class="sxs-lookup"><span data-stu-id="15b09-141">You must have permissions to register applications in the directory.</span></span>

## <a name="step-2-ensure-the-zone-for-the-web-application-that-you-want-to-secure-with-azure-ad-is-configured-to-use-ssl"></a><span data-ttu-id="15b09-142">Paso 2: asegurarse de que la zona de la aplicación web que desea proteger con Azure AD está configurada para usar SSL</span><span class="sxs-lookup"><span data-stu-id="15b09-142">Step 2: Ensure the zone for the web application that you want to secure with Azure AD is configured to use SSL</span></span>

<span data-ttu-id="15b09-143">Este artículo se escribió con la arquitectura de referencia en [ejecutar una granja de servidores de SharePoint Server 2016 de alta disponibilidad en Azure](https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/sharepoint).</span><span class="sxs-lookup"><span data-stu-id="15b09-143">This article was written using the reference architecture in [Run a high availability SharePoint Server 2016 farm in Azure](https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/sharepoint).</span></span> <span data-ttu-id="15b09-144">Los scripts adjuntos del artículo que se usan para implementar la solución que se describe en [este artículo](https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/sharepoint) crean un sitio que no usa SSL.</span><span class="sxs-lookup"><span data-stu-id="15b09-144">The article’s accompanying scripts used to deploy the solution described in [this article](https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/sharepoint) create a site that does not use SSL.</span></span>  

<span data-ttu-id="15b09-145">El uso de SAML requiere que la aplicación esté configurada para usar SSL.</span><span class="sxs-lookup"><span data-stu-id="15b09-145">Using SAML requires the application be configured to use SSL.</span></span> <span data-ttu-id="15b09-146">Si la aplicación Web de SharePoint no está configurada para usar SSL, use los siguientes pasos para crear un nuevo certificado autofirmado para configurar la aplicación web para SSL.</span><span class="sxs-lookup"><span data-stu-id="15b09-146">If your SharePoint web application is not configured to use SSL, use the following steps to create a new self-signed certificate to configure the web application for SSL.</span></span> <span data-ttu-id="15b09-147">Esta configuración solo está diseñada para un entorno de laboratorio y no está pensada para producción.</span><span class="sxs-lookup"><span data-stu-id="15b09-147">This configuration is only meant for a lab environment and is not intended for production.</span></span> <span data-ttu-id="15b09-148">Los entornos de producción deben usar un certificado firmado.</span><span class="sxs-lookup"><span data-stu-id="15b09-148">Production environments should use a signed certificate.</span></span>

1. <span data-ttu-id="15b09-149">Vaya a \*\*\*\* > **Administración** > central de administración de aplicaciones**Administrar aplicaciones web**y elija la aplicación web que debe extenderse para usar SSL.</span><span class="sxs-lookup"><span data-stu-id="15b09-149">Go to **Central Administration** > **Application Management** > **Manage Web Applications**, and choose the web application that needs to be extended to use SSL.</span></span> <span data-ttu-id="15b09-150">Seleccione la aplicación web y haga clic en el botón **extender cinta** .</span><span class="sxs-lookup"><span data-stu-id="15b09-150">Select the web application and click the **Extend ribbon** button.</span></span> <span data-ttu-id="15b09-151">Extienda la aplicación web para usar la misma dirección URL, pero use SSL con el puerto 443.</span><span class="sxs-lookup"><span data-stu-id="15b09-151">Extend the web application to use the same URL but use SSL with port 443.</span></span><br/><span data-ttu-id="15b09-152">![Extensión de la aplicación web a otro sitio de IIS](media/SAML11/fig3-extendwebapptoiis.png)</span><span class="sxs-lookup"><span data-stu-id="15b09-152">![Extending the web app to another IIS site](media/SAML11/fig3-extendwebapptoiis.png)</span></span><br/>
2. <span data-ttu-id="15b09-153">En Administrador de IIS, haga doble clic en **Certificados de servidor**.</span><span class="sxs-lookup"><span data-stu-id="15b09-153">In IIS Manager, double-click **Server Certificates**.</span></span>
3. <span data-ttu-id="15b09-154">En el panel **Acciones**, haga clic en **Crear certificado autofirmado**.</span><span class="sxs-lookup"><span data-stu-id="15b09-154">In the **Actions** pane, click **Create Self-Signed Certificate**.</span></span> <span data-ttu-id="15b09-155">Escriba un nombre descriptivo para el certificado en el cuadro Especifique un nombre descriptivo para el certificado y haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="15b09-155">Type a friendly name for the certificate in the Specify a friendly name for the certificate box, and then click **OK**.</span></span>
4. <span data-ttu-id="15b09-156">En el cuadro de diálogo **editar enlace de sitio** , asegúrese de que el nombre de host es el mismo que el nombre descriptivo, como se muestra en la siguiente imagen.</span><span class="sxs-lookup"><span data-stu-id="15b09-156">From the **Edit Site Binding** dialog box, ensure the host name is the same as the friendly name, as illustrated in the following image.</span></span><br/><span data-ttu-id="15b09-157">![Edición del enlace de sitios en IIS](media/SAML11/fig4-editsitebinding.png)</span><span class="sxs-lookup"><span data-stu-id="15b09-157">![Editing site binding in IIS](media/SAML11/fig4-editsitebinding.png)</span></span><br/>

<span data-ttu-id="15b09-158">Cada uno de los servidores front-end web de la granja de servidores de SharePoint requerirá la configuración del certificado para el enlace de sitio en IIS.</span><span class="sxs-lookup"><span data-stu-id="15b09-158">Each of the web front end servers in the SharePoint farm will require configuring the certificate for the site binding in IIS.</span></span>


## <a name="step-3-create-a-new-enterprise-application-in-azure-ad"></a><span data-ttu-id="15b09-159">Paso 3: crear una nueva aplicación de empresa en Azure AD</span><span class="sxs-lookup"><span data-stu-id="15b09-159">Step 3: Create a new enterprise application in Azure AD</span></span>

1. <span data-ttu-id="15b09-160">En el portal de Azure[https://portal.azure.com](https://portal.azure.com)(), abra el directorio de Azure ad.</span><span class="sxs-lookup"><span data-stu-id="15b09-160">In the Azure Portal ([https://portal.azure.com](https://portal.azure.com)), open your Azure AD directory.</span></span> <span data-ttu-id="15b09-161">Haga clic en **aplicaciones de empresa**y, a continuación, en **nueva aplicación**.</span><span class="sxs-lookup"><span data-stu-id="15b09-161">Click **Enterprise Applications**, then click **New application**.</span></span> <span data-ttu-id="15b09-162">Elija **aplicación que no sea de Galería**.</span><span class="sxs-lookup"><span data-stu-id="15b09-162">Choose **Non-gallery application**.</span></span> <span data-ttu-id="15b09-163">Proporcione un nombre como la *integración de SAML de SharePoint* y haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="15b09-163">Provide a name such as *SharePoint SAML Integration* and click **Add**.</span></span><br/><span data-ttu-id="15b09-164">![Adición de una nueva aplicación que no es de Galería](media/SAML11/fig5-addnongalleryapp.png)</span><span class="sxs-lookup"><span data-stu-id="15b09-164">![Adding a new non-gallery application](media/SAML11/fig5-addnongalleryapp.png)</span></span><br/>
2. <span data-ttu-id="15b09-165">Haga clic en el vínculo de inicio de sesión único en el panel de navegación para configurar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="15b09-165">Click the Single sign-on link in the navigation pane to configure the application.</span></span> <span data-ttu-id="15b09-166">Cambie el desplegable de **modo de inicio de sesión único** a **Inicio de sesión basado en SAML** para mostrar las propiedades de configuración de SAML para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="15b09-166">Change the **Single Sign-on Mode** dropdown to **SAML-based Sign-on** to reveal the SAML configuration properties for the application.</span></span> <span data-ttu-id="15b09-167">Configure con las siguientes propiedades:</span><span class="sxs-lookup"><span data-stu-id="15b09-167">Configure with the following properties:</span></span><br/>
    - <span data-ttu-id="15b09-168">Identificador`urn:sharepoint:portal.contoso.local`</span><span class="sxs-lookup"><span data-stu-id="15b09-168">Identifier: `urn:sharepoint:portal.contoso.local`</span></span>
    - <span data-ttu-id="15b09-169">Dirección URL de respuesta:`https://portal.contoso.local/_trust/default.aspx`</span><span class="sxs-lookup"><span data-stu-id="15b09-169">Reply URL: `https://portal.contoso.local/_trust/default.aspx`</span></span>
    - <span data-ttu-id="15b09-170">Dirección URL de inicio de sesión:`https://portal.contoso.local/_trust/default.aspx`</span><span class="sxs-lookup"><span data-stu-id="15b09-170">Sign-on URL: `https://portal.contoso.local/_trust/default.aspx`</span></span>
    - <span data-ttu-id="15b09-171">Identificador de usuario:`user.userprincipalname`</span><span class="sxs-lookup"><span data-stu-id="15b09-171">User Identifier: `user.userprincipalname`</span></span><br/>
    - <span data-ttu-id="15b09-172">Nota: Recuerde cambiar las direcciones URL reemplazando *portal. contoso. local* por la dirección URL del sitio de SharePoint que desea proteger.</span><span class="sxs-lookup"><span data-stu-id="15b09-172">Note: Remember to change the URLs by replacing *portal.contoso.local* with the URL of the SharePoint site you want to secure.</span></span><br/>
3. <span data-ttu-id="15b09-173">Configure una tabla (similar a la tabla 1 a continuación) que incluya las filas siguientes:</span><span class="sxs-lookup"><span data-stu-id="15b09-173">Set up a table (similar to Table 1 below) that includes the following rows:</span></span><br/> 
    - <span data-ttu-id="15b09-174">Realm</span><span class="sxs-lookup"><span data-stu-id="15b09-174">Realm</span></span>
    - <span data-ttu-id="15b09-175">Ruta de acceso completa al archivo de certificado de firma de SAML</span><span class="sxs-lookup"><span data-stu-id="15b09-175">Full path to SAML signing certificate file</span></span>
    - <span data-ttu-id="15b09-176">URL del servicio de inicio de sesión único (Single Sign-on) de SAML (reemplazando */saml2* por */wsfed*)</span><span class="sxs-lookup"><span data-stu-id="15b09-176">SAML Single Sign-On service URL (replacing */saml2* with */wsfed*)</span></span>
    - <span data-ttu-id="15b09-177">IDENTIFICADOR del objeto de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="15b09-177">Application Object ID.</span></span> <br/>
<span data-ttu-id="15b09-178">Copie el valor *identificador* en la propiedad *Realm* en una tabla (vea la tabla 1 a continuación).</span><span class="sxs-lookup"><span data-stu-id="15b09-178">Copy the *Identifier* value into the *Realm* property into a table  (See Table 1 below.)</span></span>
4. <span data-ttu-id="15b09-179">Guarde los cambios.</span><span class="sxs-lookup"><span data-stu-id="15b09-179">Save your changes.</span></span>
5. <span data-ttu-id="15b09-180">Haga clic en el vínculo **Configurar (nombre de la aplicación)** para acceder a la página configurar el inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="15b09-180">Click the **Configure (app name)** link to access the Configure sign-on page.</span></span><br/><span data-ttu-id="15b09-181">![Configuración de una página de inicio de sesión único](media/SAML11/fig7-configssopage.png)</span><span class="sxs-lookup"><span data-stu-id="15b09-181">![Configuring a single-sign on page](media/SAML11/fig7-configssopage.png)</span></span><br/> 
    -  <span data-ttu-id="15b09-182">Haga clic en el vínculo **certificado de firma de SAML-RAW** para descargar el certificado de firma de SAML como un archivo con la extensión. cer.</span><span class="sxs-lookup"><span data-stu-id="15b09-182">Click the **SAML Signing Certificate - Raw** link to download the SAML Signing Certificate as a file with the .cer extension.</span></span> <span data-ttu-id="15b09-183">Copie y pegue la ruta de acceso completa del archivo descargado en la tabla.</span><span class="sxs-lookup"><span data-stu-id="15b09-183">Copy and paste the full path to the downloaded file into your table.</span></span>
    - <span data-ttu-id="15b09-184">Copie y pegue el vínculo de la dirección URL del servicio de inicio de sesión único de SAML en el, reemplazando la parte */saml2* de la dirección URL por */wsfed*.</span><span class="sxs-lookup"><span data-stu-id="15b09-184">Copy and paste the SAML Single Sign-On Service URL link into your, replacing the */saml2* portion of the URL with */wsfed*.</span></span><br/>
6.  <span data-ttu-id="15b09-185">Navegue hasta el panel de **propiedades** de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="15b09-185">Navigate to the **Properties** pane for the application.</span></span> <span data-ttu-id="15b09-186">Copie y pegue el valor del identificador de objeto en la tabla que configuró en el paso 3.</span><span class="sxs-lookup"><span data-stu-id="15b09-186">Copy and paste the Object ID value into the table you set up in Step 3.</span></span><br/><span data-ttu-id="15b09-187">![Panel de propiedades de la aplicación](media/SAML11/fig8-propertiespane.png)</span><span class="sxs-lookup"><span data-stu-id="15b09-187">![Properties pane for the application](media/SAML11/fig8-propertiespane.png)</span></span><br/>
7. <span data-ttu-id="15b09-188">Con los valores que ha capturado, asegúrese de que la tabla que configuró en el paso 3 sea similar a la tabla 1 siguiente.</span><span class="sxs-lookup"><span data-stu-id="15b09-188">Using the values you captured, make sure the table you set up in Step 3 resembles Table 1 below.</span></span>


| <span data-ttu-id="15b09-189">Tabla 1: valores capturados</span><span class="sxs-lookup"><span data-stu-id="15b09-189">Table 1: Values captured</span></span>  |  |
|---------|---------|
|<span data-ttu-id="15b09-190">Realm</span><span class="sxs-lookup"><span data-stu-id="15b09-190">Realm</span></span> | `urn:sharepoint:portal.contoso.local` |
|<span data-ttu-id="15b09-191">Ruta de acceso completa al archivo de certificado de firma de SAML</span><span class="sxs-lookup"><span data-stu-id="15b09-191">Full path to SAML signing certificate file</span></span> | `C:/temp/SharePoint SAML Integration.cer`  |
|<span data-ttu-id="15b09-192">Dirección URL del servicio de inicio de sesión único de SAML (reemplace/saml2 por/wsfed)</span><span class="sxs-lookup"><span data-stu-id="15b09-192">SAML single sign-on service URL (replace /saml2 with /wsfed)</span></span> | `https://login.microsoftonline.com/b1726649-b616-460d-8d20-defab80d476c/wsfed` |
|<span data-ttu-id="15b09-193">IDENTIFICADOR del objeto de la aplicación</span><span class="sxs-lookup"><span data-stu-id="15b09-193">Application Object ID</span></span> | `a812f48b-d1e4-4c8e-93be-e4808c8ca3ac` |

> [!IMPORTANT]
> <span data-ttu-id="15b09-194">Reemplace el valor */saml2* en la dirección URL con */wsfed*.</span><span class="sxs-lookup"><span data-stu-id="15b09-194">Replace the */saml2* value in the URL with */wsfed*.</span></span> <span data-ttu-id="15b09-195">El extremo */saml2* procesará los tokens SAML 2,0.</span><span class="sxs-lookup"><span data-stu-id="15b09-195">The */saml2* endpoint will process SAML 2.0 tokens.</span></span> <span data-ttu-id="15b09-196">El extremo */wsfed* habilita el procesamiento de tokens SAML 1,1 y es necesario para la Federación SAML de SharePoint 2016.</span><span class="sxs-lookup"><span data-stu-id="15b09-196">The */wsfed* endpoint enables processing SAML 1.1 tokens and is required for SharePoint 2016 SAML federation.</span></span>

## <a name="step-4-configure-a-new-trusted-identity-provider-in-sharepoint-server-2016"></a><span data-ttu-id="15b09-197">Paso 4: configurar un nuevo proveedor de identidades de confianza en SharePoint Server 2016</span><span class="sxs-lookup"><span data-stu-id="15b09-197">Step 4: Configure a new trusted identity provider in SharePoint Server 2016</span></span>

<span data-ttu-id="15b09-198">Inicie sesión en el servidor de SharePoint Server 2016 y abra el shell de administración de SharePoint 2016.</span><span class="sxs-lookup"><span data-stu-id="15b09-198">Sign into the SharePoint Server 2016 server and open the SharePoint 2016 Management Shell.</span></span> <span data-ttu-id="15b09-199">Rellene los valores de $realm, $wsfedurl y $filepath de la tabla 1 y ejecute los siguientes comandos para configurar un nuevo proveedor de identidades de confianza.</span><span class="sxs-lookup"><span data-stu-id="15b09-199">Fill in the values of $realm, $wsfedurl, and $filepath from Table 1 and run the following commands to configure a new trusted identity provider.</span></span>

> [!TIP]
> <span data-ttu-id="15b09-200">Si no está familiarizado con PowerShell o desea obtener más información sobre cómo funciona PowerShell, consulte [SharePoint PowerShell](https://docs.microsoft.com/en-us/powershell/sharepoint/overview?view=sharepoint-ps).</span><span class="sxs-lookup"><span data-stu-id="15b09-200">If you're new to using PowerShell or want to learn more about how PowerShell works, see [SharePoint PowerShell](https://docs.microsoft.com/en-us/powershell/sharepoint/overview?view=sharepoint-ps).</span></span> 

```
$realm = "<Realm from Table 1>"
$wsfedurl="<SAML single sign-on service URL from Table 1>"
$filepath="<Full path to SAML signing certificate file from Table 1>"
$cert = New-Object System.Security.Cryptography.X509Certificates.X509Certificate2($filepath)
New-SPTrustedRootAuthority -Name "AzureAD" -Certificate $cert
$map = New-SPClaimTypeMapping -IncomingClaimType "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name" -IncomingClaimTypeDisplayName "name" -LocalClaimType "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn"
$map2 = New-SPClaimTypeMapping -IncomingClaimType "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname" -IncomingClaimTypeDisplayName "GivenName" -SameAsIncoming
$map3 = New-SPClaimTypeMapping -IncomingClaimType "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname" -IncomingClaimTypeDisplayName "SurName" -SameAsIncoming
$ap = New-SPTrustedIdentityTokenIssuer -Name "AzureAD" -Description "SharePoint secured by Azure AD" -realm $realm -ImportTrustCertificate $cert -ClaimsMappings $map,$map2,$map3 -SignInUrl $wsfedurl -IdentifierClaim "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"
```

<span data-ttu-id="15b09-201">A continuación, siga estos pasos para habilitar el proveedor de identidad de confianza para su aplicación:</span><span class="sxs-lookup"><span data-stu-id="15b09-201">Next, follow these steps to enable the trusted identity provider for your application:</span></span>
1. <span data-ttu-id="15b09-202">En administración central, vaya a **Administración de aplicaciones web** y seleccione la aplicación web que desea proteger con Azure ad.</span><span class="sxs-lookup"><span data-stu-id="15b09-202">In Central Administration, navigate to **Manage Web Application** and select the web application that you wish to secure with Azure AD.</span></span> 
2. <span data-ttu-id="15b09-203">En la cinta, haga clic en **proveedores de autenticación** y elija la zona que desea usar.</span><span class="sxs-lookup"><span data-stu-id="15b09-203">In the ribbon, click **Authentication Providers** and choose the zone that you wish to use.</span></span>
3. <span data-ttu-id="15b09-204">Seleccione **proveedor de identidad de confianza** y seleccione el proveedor de identificación que acaba de registrar con el nombre *AzureAD*.</span><span class="sxs-lookup"><span data-stu-id="15b09-204">Select **Trusted Identity provider** and select the identify provider you just registered named *AzureAD*.</span></span>  
4. <span data-ttu-id="15b09-205">En la configuración de dirección URL de la página de inicio de sesión, seleccione **Página de inicio de sesión personalizada** y proporcione el valor "/_trust/".</span><span class="sxs-lookup"><span data-stu-id="15b09-205">On the sign-in page URL setting, select **Custom sign in page** and provide the value "/_trust/".</span></span> 
5. <span data-ttu-id="15b09-206">Haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="15b09-206">Click **OK**.</span></span>

![Configurar el proveedor de autenticación](media/SAML11/fig10-configauthprovider.png)

> [!IMPORTANT]
> <span data-ttu-id="15b09-208">Es importante seguir todos los pasos, incluida la configuración de la página de inicio de sesión personalizada en "/_trust/", como se muestra.</span><span class="sxs-lookup"><span data-stu-id="15b09-208">It is important to follow all steps, including setting the custom sign in page to "/_trust/" as shown.</span></span> <span data-ttu-id="15b09-209">La configuración no funcionará correctamente a menos que se sigan todos los pasos.</span><span class="sxs-lookup"><span data-stu-id="15b09-209">The configuration will not work correctly unless all steps are followed.</span></span>

## <a name="step-5-set-the-permissions"></a><span data-ttu-id="15b09-210">Paso 5: establecer los permisos</span><span class="sxs-lookup"><span data-stu-id="15b09-210">Step 5: Set the permissions</span></span>

<span data-ttu-id="15b09-211">Se debe conceder acceso a la aplicación a los usuarios que iniciarán sesión en Azure AD y Access a SharePoint.</span><span class="sxs-lookup"><span data-stu-id="15b09-211">The users who will log into Azure AD and access SharePoint must be granted access to the application.</span></span> 

1. <span data-ttu-id="15b09-212">En Azure portal, abra el directorio de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="15b09-212">In the Azure Portal, open the Azure AD directory.</span></span> <span data-ttu-id="15b09-213">Haga clic en **aplicaciones de empresa**y, a continuación, en **todas las aplicaciones**.</span><span class="sxs-lookup"><span data-stu-id="15b09-213">Click **Enterprise Applications**, then click **All applications**.</span></span> <span data-ttu-id="15b09-214">Haga clic en la aplicación que creó anteriormente (integración de SAML de SharePoint).</span><span class="sxs-lookup"><span data-stu-id="15b09-214">Click the application that you created previously (SharePoint SAML Integration).</span></span>
2. <span data-ttu-id="15b09-215">Haga clic en **usuarios y grupos**.</span><span class="sxs-lookup"><span data-stu-id="15b09-215">Click **Users and Groups**.</span></span> 
3. <span data-ttu-id="15b09-216">Haga clic en **Agregar usuario** para agregar un usuario o grupo que tendrá permisos para iniciar sesión en SharePoint con Azure ad.</span><span class="sxs-lookup"><span data-stu-id="15b09-216">Click **Add user** to add a user or group who will have permissions to log into SharePoint using Azure AD.</span></span>
4. <span data-ttu-id="15b09-217">Seleccione el usuario o grupo y, a continuación, haga clic en **asignar**.</span><span class="sxs-lookup"><span data-stu-id="15b09-217">Select the user or group then click **Assign**.</span></span>
 
<span data-ttu-id="15b09-218">Se ha concedido permiso al usuario en Azure AD, pero también se le debe conceder el permiso en SharePoint.</span><span class="sxs-lookup"><span data-stu-id="15b09-218">The user has been granted permission in Azure AD, but also must be granted permission in SharePoint.</span></span> <span data-ttu-id="15b09-219">Siga estos pasos para establecer los permisos para obtener acceso a la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="15b09-219">Use the following steps to set the permissions to access the web application.</span></span>

1. <span data-ttu-id="15b09-220">En Administración central, haga clic en **Administración de aplicaciones**.</span><span class="sxs-lookup"><span data-stu-id="15b09-220">In Central Administration, click **Application Management**.</span></span>
2. <span data-ttu-id="15b09-221">En la sección **Aplicaciones web** de la página **Administración de aplicaciones**, haga clic en **Administrar aplicaciones web**.</span><span class="sxs-lookup"><span data-stu-id="15b09-221">On the **Application Management** page, in the **Web Applications** section, click **Manage web applications**.</span></span>
3. <span data-ttu-id="15b09-222">Haga clic en la aplicación web adecuada y, a continuación, haga clic en **Directiva de usuario**.</span><span class="sxs-lookup"><span data-stu-id="15b09-222">Click the appropriate web application, and then click **User Policy**.</span></span>
4. <span data-ttu-id="15b09-223">En Directiva de aplicación Web, haga clic en **Agregar usuarios**.</span><span class="sxs-lookup"><span data-stu-id="15b09-223">In Policy for Web Application, click **Add Users**.</span></span><br/><span data-ttu-id="15b09-224">![Buscar a un usuario por su notificación de nombre](media/SAML11/fig11-searchbynameclaim.png)</span><span class="sxs-lookup"><span data-stu-id="15b09-224">![Searching for a user by their name claim](media/SAML11/fig11-searchbynameclaim.png)</span></span><br/>
5. <span data-ttu-id="15b09-225">En el cuadro de diálogo **Agregar usuarios**, haga clic en la zona apropiada en la sección **Zonas** y, después, haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="15b09-225">In the **Add Users** dialog box, click the appropriate zone in **Zones**, and then click **Next**.</span></span>
6. <span data-ttu-id="15b09-226">En el cuadro de diálogo **Directiva de aplicación web** , en la sección **elegir usuarios** , haga clic en el icono **examinar** .</span><span class="sxs-lookup"><span data-stu-id="15b09-226">In the **Policy for Web Application** dialog box, in the **Choose Users** section, click the **Browse** icon.</span></span>
7. <span data-ttu-id="15b09-227">En el cuadro de texto **Buscar** , escriba el nombre de inicio de sesión de un usuario en el directorio y haga clic en **Buscar**.</span><span class="sxs-lookup"><span data-stu-id="15b09-227">In the **Find** textbox, type the sign-in name for a user in your directory and click **Search**.</span></span> <br/><span data-ttu-id="15b09-228">Ejemplo: *demouser@blueskyabove.onmicrosoft.com*.</span><span class="sxs-lookup"><span data-stu-id="15b09-228">Example: *demouser@blueskyabove.onmicrosoft.com*.</span></span>
8. <span data-ttu-id="15b09-229">En el encabezado AzureAD de la vista de lista, seleccione la propiedad Name y haga clic en **Agregar** y, a continuación, haga clic en **Aceptar** para cerrar el cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="15b09-229">Under the AzureAD heading in the list view, select the name property and click **Add** then click **OK** to close the dialog.</span></span>
9. <span data-ttu-id="15b09-230">En permisos, haga clic en **control total**.</span><span class="sxs-lookup"><span data-stu-id="15b09-230">In Permissions, click **Full Control**.</span></span><br/><span data-ttu-id="15b09-231">![Concesión de control total a un usuario de notificaciones](media/SAML11/fig12-grantfullcontrol.png)</span><span class="sxs-lookup"><span data-stu-id="15b09-231">![Granting full control to a claims user](media/SAML11/fig12-grantfullcontrol.png)</span></span><br/>
10. <span data-ttu-id="15b09-232">Haga clic en **Finalizar** y, después, en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="15b09-232">Click **Finish**, and then click **OK**.</span></span>

## <a name="step-6-add-a-saml-11-token-issuance-policy-in-azure-ad"></a><span data-ttu-id="15b09-233">Paso 6: agregar una directiva de emisión de token de SAML 1,1 en Azure AD</span><span class="sxs-lookup"><span data-stu-id="15b09-233">Step 6: Add a SAML 1.1 token issuance policy in Azure AD</span></span>

<span data-ttu-id="15b09-234">Cuando se crea la aplicación de Azure AD en el portal, el valor predeterminado es usar SAML 2,0.</span><span class="sxs-lookup"><span data-stu-id="15b09-234">When the Azure AD application is created in the portal, it defaults to using SAML 2.0.</span></span> <span data-ttu-id="15b09-235">SharePoint Server 2016 requiere el formato de token SAML 1,1.</span><span class="sxs-lookup"><span data-stu-id="15b09-235">SharePoint Server 2016 requires the SAML 1.1 token format.</span></span> <span data-ttu-id="15b09-236">El siguiente script quitará la Directiva SAML 2,0 predeterminada y agregará una nueva Directiva para emitir tokens SAML 1,1.</span><span class="sxs-lookup"><span data-stu-id="15b09-236">The following script will remove the default SAML 2.0 policy and add a new policy to issue SAML 1.1 tokens.</span></span> 

> <span data-ttu-id="15b09-237">Este código requiere descargar los ejemplos adjuntos que [demuestran la interacción con el gráfico de Azure Active](https://github.com/kaevans/spsaml11/tree/master/scripts)Directory.</span><span class="sxs-lookup"><span data-stu-id="15b09-237">This code requires downloading the accompanying [samples demonstrating interacting with Azure Active Directory Graph](https://github.com/kaevans/spsaml11/tree/master/scripts).</span></span> <span data-ttu-id="15b09-238">Si descarga los scripts como un archivo ZIP desde GitHub a un escritorio de Windows, asegúrese de desbloquear el `MSGraphTokenLifetimePolicy.psm1` archivo de módulo de script y `Initialize.ps1` el archivo de script (haga clic con el botón secundario en propiedades, elija desbloquear y haga clic en Aceptar).</span><span class="sxs-lookup"><span data-stu-id="15b09-238">If you download the scripts as a ZIP file from GitHub to a Windows desktop, make sure to unblock the `MSGraphTokenLifetimePolicy.psm1` script module file and the `Initialize.ps1` script file (right-click Properties, choose Unblock, click OK).</span></span> 
<span data-ttu-id="15b09-239">![Desbloqueo de archivos descargados](media/SAML11/fig17-unblock.png)</span><span class="sxs-lookup"><span data-stu-id="15b09-239">![Unblocking downloaded files](media/SAML11/fig17-unblock.png)</span></span>

<span data-ttu-id="15b09-240">Una vez que se haya descargado el script de ejemplo, cree un nuevo script de PowerShell con el código siguiente, reemplazando el `Initialize.ps1` marcador de posición por la ruta de acceso de archivo del equipo local descargado.</span><span class="sxs-lookup"><span data-stu-id="15b09-240">Once the sample script is downloaded, create a new PowerShell script using the following code, replacing the placeholder with the file path of the downloaded `Initialize.ps1` on your local machine.</span></span> <span data-ttu-id="15b09-241">Reemplace el marcador de posición del identificador de objeto de la aplicación por el identificador del objeto de la aplicación que escribió en la tabla 1.</span><span class="sxs-lookup"><span data-stu-id="15b09-241">Replace the application object ID placeholder with the application object ID that you entered in Table 1.</span></span> <span data-ttu-id="15b09-242">Una vez creado, ejecute el script de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="15b09-242">Once created, execute the PowerShell script.</span></span> 

```
function AssignSaml11PolicyToAppPrincipal
{
    Param(
        [Parameter(Mandatory=$true)]
        [string]$pathToInitializeScriptFile, 
        [Parameter(Mandatory=$true)]
        [string]$appObjectid
    )

    $folder = Split-Path $pathToInitializeScriptFile
    Push-Location $folder

    #Loads the dependent ADAL module used to acquire tokens
    Import-Module $pathToInitializeScriptFile 

    #Gets the existing token issuance policy
    $existingTokenIssuancePolicy = Get-PoliciesAssignedToServicePrincipal -servicePrincipalId $appObjectid | ?{$_.type -EQ "TokenIssuancePolicy"} 
    Write-Host "The following TokenIssuancePolicy policies are assigned to the service principal." -ForegroundColor Green
    Write-Host $existingTokenIssuancePolicy -ForegroundColor White
    $policyId = $existingTokenIssuancePolicy.objectId

    #Removes existing token issuance policy
    Write-Host "Only a single policy can be assigned to the service principal. Removing the existing policy with ID $policyId" -ForegroundColor Green
    Remove-PolicyFromServicePrincipal -policyId $policyId -servicePrincipalId $appObjectid

    #Creates a new token issuance policy and assigns to the service principal
    Write-Host "Adding the new SAML 1.1 TokenIssuancePolicy" -ForegroundColor Green
    $policy = Add-TokenIssuancePolicy -DisplayName SPSAML11 -SigningAlgorithm "http://www.w3.org/2001/04/xmldsig-more#rsa-sha256" -TokenResponseSigningPolicy TokenOnly -SamlTokenVersion "1.1"
    Write-Host "Assigning the new SAML 1.1 TokenIssuancePolicy $policy.objectId to the service principal $appObjectid" -ForegroundColor Green
    Set-PolicyToServicePrincipal -policyId $policy.objectId -servicePrincipalId $appObjectid
    Pop-Location
}

#Only edit the following two variables
$pathToInitializeScriptFile = "<file path of Initialize.ps1>"
$appObjectid = "<Application Object ID from Table 1>"

AssignSaml11PolicyToAppPrincipal $pathToInitializeScriptFile $appObjectid
```
> [!IMPORTANT]
> <span data-ttu-id="15b09-243">Los scripts de PowerShell no están firmados y es posible que se le pida que establezca la Directiva de ejecución.</span><span class="sxs-lookup"><span data-stu-id="15b09-243">The PowerShell scripts are not signed and you may be prompted to set the execution policy.</span></span> <span data-ttu-id="15b09-244">Para obtener más información sobre las directivas de ejecución, consulte [acerca de las directivas de ejecución](http://go.microsoft.com/fwlink/?LinkID=135170).</span><span class="sxs-lookup"><span data-stu-id="15b09-244">For more information on execution policies, see [About Execution Policies](http://go.microsoft.com/fwlink/?LinkID=135170).</span></span> <span data-ttu-id="15b09-245">Además, es posible que necesite abrir un símbolo del sistema con privilegios elevados para ejecutar correctamente los comandos contenidos en los scripts de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="15b09-245">Additionally, you may need to open an elevated command prompt to successfully execute the commands contained in the sample scripts.</span></span>

<span data-ttu-id="15b09-246">Estos comandos de PowerShell de ejemplo son ejemplos de cómo ejecutar consultas en la API de Graph.</span><span class="sxs-lookup"><span data-stu-id="15b09-246">These sample PowerShell commands are examples of how to execute queries against the Graph API.</span></span> <span data-ttu-id="15b09-247">Para obtener más información sobre las directivas de emisión de tokens con Azure AD, consulte la [referencia de la API de Graph para operaciones en la Directiva](https://msdn.microsoft.com/en-us/library/azure/ad/graph/api/policy-operations#create-a-policy).</span><span class="sxs-lookup"><span data-stu-id="15b09-247">For more details on Token Issuance Policies with Azure AD, see the [Graph API reference for operations on policy](https://msdn.microsoft.com/en-us/library/azure/ad/graph/api/policy-operations#create-a-policy).</span></span>

## <a name="step-7-verify-the-new-provider"></a><span data-ttu-id="15b09-248">Paso 7: comprobar el nuevo proveedor</span><span class="sxs-lookup"><span data-stu-id="15b09-248">Step 7: Verify the new provider</span></span>

<span data-ttu-id="15b09-249">Abra un explorador para la dirección URL de la aplicación web que configuró en los pasos anteriores.</span><span class="sxs-lookup"><span data-stu-id="15b09-249">Open a browser to the URL of the web application that you configured in the previous steps.</span></span> <span data-ttu-id="15b09-250">Se le redirige a iniciar sesión en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="15b09-250">You are redirected to sign into Azure AD.</span></span>

![Iniciar sesión en Azure AD configurado para Federación](media/SAML11/fig13-examplesignin.png)

<span data-ttu-id="15b09-252">Se le preguntará si desea mantener la sesión iniciada.</span><span class="sxs-lookup"><span data-stu-id="15b09-252">You are asked if you want to stay signed in.</span></span>

![¿Mantener la sesión iniciada?](media/SAML11/fig14-staysignedin.png)

<span data-ttu-id="15b09-254">Por último, puede tener acceso al sitio que ha iniciado sesión como usuario desde su inquilino de Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="15b09-254">Finally, you can access the site logged in as a user from your Azure Active Directory tenant.</span></span>

![Usuario ha iniciado sesión en SharePoint](media/SAML11/fig15-signedinsharepoint.png)

## <a name="managing-certificates"></a><span data-ttu-id="15b09-256">Administración de certificados</span><span class="sxs-lookup"><span data-stu-id="15b09-256">Managing certificates</span></span>
<span data-ttu-id="15b09-257">Es importante comprender que el certificado de firma que se ha configurado para el proveedor de identidades de confianza en el paso 4 anterior tiene una fecha de expiración y debe renovarse.</span><span class="sxs-lookup"><span data-stu-id="15b09-257">It is important to understand that the signing certificate that was configured for the trusted identity provider in step 4 above has an expiration date and must be renewed.</span></span> <span data-ttu-id="15b09-258">Consulte el artículo [administrar certificados para el inicio de sesión único federado en Azure Active Directory](https://docs.microsoft.com/en-us/azure/active-directory/active-directory-sso-certs) para obtener información sobre la renovación de certificados.</span><span class="sxs-lookup"><span data-stu-id="15b09-258">See the article [Manage certificates for federated single sign-on in Azure Active Directory](https://docs.microsoft.com/en-us/azure/active-directory/active-directory-sso-certs) for information on certificate renewal.</span></span> <span data-ttu-id="15b09-259">Una vez renovado el certificado en Azure AD, descárguelo en un archivo local y use el siguiente script para configurar el proveedor de identidades de confianza con el certificado de firma renovado.</span><span class="sxs-lookup"><span data-stu-id="15b09-259">Once the certificate has been renewed in Azure AD, download to a local file and use the following script to configure the trusted identity provider with the renewed signing certificate.</span></span> 

```
$filepath="<Full path to renewed SAML signing certificate file>"
$cert= New-Object System.Security.Cryptography.X509Certificates.X509Certificate2($filePath)
New-SPTrustedRootAuthority -Name "AzureAD" -Certificate $cert
Get-SPTrustedIdentityTokenIssuer "AzureAD" | Set-SPTrustedIdentityTokenIssuer -ImportTrustCertificate $cert
```
## <a name="configuring-one-trusted-identity-provider-for-multiple-web-applications"></a><span data-ttu-id="15b09-260">Configuración de un proveedor de identidades de confianza para varias aplicaciones Web</span><span class="sxs-lookup"><span data-stu-id="15b09-260">Configuring one trusted identity provider for multiple web applications</span></span>
<span data-ttu-id="15b09-261">La configuración funciona para una aplicación web única, pero necesita una configuración adicional si tiene previsto usar el mismo proveedor de identidad de confianza para varias aplicaciones Web.</span><span class="sxs-lookup"><span data-stu-id="15b09-261">The configuration works for a single web application, but needs additional configuration if you intend to use the same trusted identity provider for multiple web applications.</span></span> <span data-ttu-id="15b09-262">Por ejemplo, supongamos que hemos ampliado una aplicación web para usar `https://portal.contoso.local` la dirección URL y ahora desea autenticar también `https://sales.contoso.local` a los usuarios.</span><span class="sxs-lookup"><span data-stu-id="15b09-262">For example, assume we had extended a web application to use the URL `https://portal.contoso.local` and now want to authenticate the users to `https://sales.contoso.local` as well.</span></span> <span data-ttu-id="15b09-263">Para ello, es necesario actualizar el proveedor de identidades para que respete el parámetro WReply y actualizar el registro de la aplicación en Azure AD para agregar una dirección URL de respuesta.</span><span class="sxs-lookup"><span data-stu-id="15b09-263">To do this, we need to update the identity provider to honor the WReply parameter and update the application registration in Azure AD to add a reply URL.</span></span>

1. <span data-ttu-id="15b09-264">En Azure portal, abra el directorio de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="15b09-264">In the Azure Portal, open the Azure AD directory.</span></span> <span data-ttu-id="15b09-265">Haga clic en **registros de aplicaciones**y, a continuación, en **ver todas las aplicaciones**.</span><span class="sxs-lookup"><span data-stu-id="15b09-265">Click **App registrations**, then click **View all applications**.</span></span> <span data-ttu-id="15b09-266">Haga clic en la aplicación que creó anteriormente (integración de SAML de SharePoint).</span><span class="sxs-lookup"><span data-stu-id="15b09-266">Click the application that you created previously (SharePoint SAML Integration).</span></span>
2. <span data-ttu-id="15b09-267">Haga clic en **configuración**.</span><span class="sxs-lookup"><span data-stu-id="15b09-267">Click **Settings**.</span></span>
3. <span data-ttu-id="15b09-268">En la hoja configuración, haga clic en **URL de respuesta**.</span><span class="sxs-lookup"><span data-stu-id="15b09-268">In the settings blade, click **Reply URLs**.</span></span> 
4. <span data-ttu-id="15b09-269">Agregue la dirección URL de la aplicación web adicional `/_trust/default.aspx` con anexado a la dirección URL ( `https://sales.contoso.local/_trust/default.aspx`como) y haga clic en **Guardar**.</span><span class="sxs-lookup"><span data-stu-id="15b09-269">Add the URL for the additional web application with `/_trust/default.aspx` appended to the URL (such as `https://sales.contoso.local/_trust/default.aspx`) and click **Save**.</span></span> 
5. <span data-ttu-id="15b09-270">En el servidor de SharePoint, abra el **Shell de administración de sharepoint 2016** y ejecute los siguientes comandos, usando el nombre del emisor de tokens de identidad de confianza que usó anteriormente.</span><span class="sxs-lookup"><span data-stu-id="15b09-270">On the SharePoint server, open the **SharePoint 2016 Management Shell** and execute the following commands, using the name of the trusted identity token issuer that you used previously.</span></span>

```
$t = Get-SPTrustedIdentityTokenIssuer "AzureAD"
$t.UseWReplyParameter=$true
$t.Update()
```
6. <span data-ttu-id="15b09-271">En administración central, vaya a la aplicación web y habilite el proveedor de identidades de confianza existente.</span><span class="sxs-lookup"><span data-stu-id="15b09-271">In Central Administration, go to the web application and enable the existing trusted identity provider.</span></span> <span data-ttu-id="15b09-272">Recuerde también configurar la dirección URL de la página de inicio de sesión como página `/_trust/`de inicio de sesión personalizada.</span><span class="sxs-lookup"><span data-stu-id="15b09-272">Remember to also configure the sign-in page URL as a custom sign in page `/_trust/`.</span></span>
7. <span data-ttu-id="15b09-273">En administración central, haga clic en la aplicación web y elija **Directiva de usuario**.</span><span class="sxs-lookup"><span data-stu-id="15b09-273">In Central Administration, click the web application and choose **User Policy**.</span></span> <span data-ttu-id="15b09-274">Agregue un usuario con los permisos adecuados, tal y como se muestra anteriormente en este artículo.</span><span class="sxs-lookup"><span data-stu-id="15b09-274">Add a user with the appropriate permissions as demonstrated previously in this article.</span></span>

## <a name="fixing-people-picker"></a><span data-ttu-id="15b09-275">Corrección del selector de personas</span><span class="sxs-lookup"><span data-stu-id="15b09-275">Fixing People Picker</span></span>
<span data-ttu-id="15b09-276">Los usuarios ahora pueden iniciar sesión en SharePoint 2016 mediante identidades de Azure AD, pero todavía hay oportunidades para mejorar la experiencia del usuario.</span><span class="sxs-lookup"><span data-stu-id="15b09-276">Users can now log into SharePoint 2016 using identities from Azure AD, but there are still opportunities for improvement to the user experience.</span></span> <span data-ttu-id="15b09-277">Por ejemplo, la búsqueda de un usuario presenta varios resultados de búsqueda en el selector de personas.</span><span class="sxs-lookup"><span data-stu-id="15b09-277">For instance, searching for a user presents multiple search results in the people picker.</span></span> <span data-ttu-id="15b09-278">Hay un resultado de búsqueda para cada uno de los 3 tipos de notificación que se crearon en la asignación de notificación.</span><span class="sxs-lookup"><span data-stu-id="15b09-278">There is a search result for each of the 3 claim types that were created in the claim mapping.</span></span> <span data-ttu-id="15b09-279">Para elegir un usuario con el selector de personas, debe escribir su nombre de usuario exactamente y elegir el **nombre** de notificación resultado.</span><span class="sxs-lookup"><span data-stu-id="15b09-279">To choose a user using the people picker, you must type their user name exactly and choose the **name** claim result.</span></span>

![Resultados de la búsqueda de notificaciones](media/SAML11/fig16-claimssearchresults.png)

<span data-ttu-id="15b09-281">No hay ninguna validación de los valores que busque, lo que puede dar lugar a errores ortográficos o a los usuarios que elijan accidentalmente el tipo de notificación \*\*\*\* incorrecto para asignarlo, por ejemplo, la notificación de apellidos.</span><span class="sxs-lookup"><span data-stu-id="15b09-281">There is no validation on the values you search for, which can lead to misspellings or users accidentally choosing the wrong claim type to assign such as the **SurName** claim.</span></span> <span data-ttu-id="15b09-282">Esto puede impedir que los usuarios tengan acceso a los recursos correctamente.</span><span class="sxs-lookup"><span data-stu-id="15b09-282">This can prevent users from successfully accessing resources.</span></span>

<span data-ttu-id="15b09-283">Para ayudar con este escenario, hay una solución de código abierto denominada [AzureCP](https://yvand.github.io/AzureCP/) que proporciona un proveedor de notificaciones personalizado para SharePoint 2016.</span><span class="sxs-lookup"><span data-stu-id="15b09-283">To assist with this scenario, there is an open-source solution called [AzureCP](https://yvand.github.io/AzureCP/) that provides a custom claims provider for SharePoint 2016.</span></span> <span data-ttu-id="15b09-284">Usará el gráfico de Azure AD para resolver lo que los usuarios especifican y realizan la validación.</span><span class="sxs-lookup"><span data-stu-id="15b09-284">It will use the Azure AD Graph to resolve what users enter and perform validation.</span></span> <span data-ttu-id="15b09-285">Obtenga más información en [AzureCP](https://yvand.github.io/AzureCP/).</span><span class="sxs-lookup"><span data-stu-id="15b09-285">Learn more at [AzureCP](https://yvand.github.io/AzureCP/).</span></span> 

## <a name="additional-resources"></a><span data-ttu-id="15b09-286">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="15b09-286">Additional resources</span></span>

[<span data-ttu-id="15b09-287">Introducción a WS-Federation</span><span class="sxs-lookup"><span data-stu-id="15b09-287">Understanding WS-Federation</span></span>](https://go.microsoft.com/fwlink/p/?linkid=188052)
  
[<span data-ttu-id="15b09-288">Adopción de la nube y soluciones híbridas</span><span class="sxs-lookup"><span data-stu-id="15b09-288">Cloud adoption and hybrid solutions</span></span>](cloud-adoption-and-hybrid-solutions.md)
  
## <a name="join-the-discussion"></a><span data-ttu-id="15b09-289">Participar en la discusión</span><span class="sxs-lookup"><span data-stu-id="15b09-289">Join the discussion</span></span>

|<span data-ttu-id="15b09-290">**Póngase en contacto con nosotros**</span><span class="sxs-lookup"><span data-stu-id="15b09-290">**Contact us**</span></span>|<span data-ttu-id="15b09-291">**Descripción**</span><span class="sxs-lookup"><span data-stu-id="15b09-291">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="15b09-292">**¿Qué soluciones necesita?**</span><span class="sxs-lookup"><span data-stu-id="15b09-292">**What cloud adoption content do you need?**</span></span> <br/> |<span data-ttu-id="15b09-p136">Estamos creando contenido para soluciones que abarcan varios productos y servicios de Microsoft. Díganos qué piensa sobre nuestras soluciones entre servidores o solicite soluciones específicas por correo electrónico a [MODAcontent@microsoft.com](mailto:cloudadopt@microsoft.com?Subject=[Cloud%20Adoption%20Content%20Feedback]:%20).</span><span class="sxs-lookup"><span data-stu-id="15b09-p136">We are creating content for cloud adoption that spans multiple Microsoft cloud platforms and services. Let us know what you think about our cloud adoption content, or ask for specific content by sending email to [cloudadopt@microsoft.com](mailto:cloudadopt@microsoft.com?Subject=[Cloud%20Adoption%20Content%20Feedback]:%20).  </span></span><br/> |
|<span data-ttu-id="15b09-295">**Participe en la discusión sobre soluciones**</span><span class="sxs-lookup"><span data-stu-id="15b09-295">**Join the cloud adoption discussion**</span></span> <br/> |<span data-ttu-id="15b09-p137">Si es un apasionado de las soluciones basadas en la nube, puede unirse a Cloud Adoption Advisory Board (CAAB) para conectarse a una interesante comunidad de mayor tamaño formada por desarrolladores de contenido de Microsoft, profesionales del sector y clientes de todo el mundo. Para unirse, agregue a su usuario como miembro del [espacio CAAB (Cloud Adoption Advisory Board)](https://aka.ms/caab) de Microsoft Tech Community y envíenos un correo electrónico a [CAAB@microsoft.com](mailto:caab@microsoft.com?Subject=I%20just%20joined%20the%20Cloud%20Adoption%20Advisory%20Board!). Cualquiera puede leer contenido relacionado con la comunidad en el [blog de CAAB](https://blogs.technet.com/b/solutions_advisory_board/). Pero los miembros de CAAB reciben invitaciones a seminarios web privados donde se describen nuevos recursos y soluciones de adopción de la nube.  </span><span class="sxs-lookup"><span data-stu-id="15b09-p137">If you are passionate about cloud-based solutions, consider joining the Cloud Adoption Advisory Board (CAAB) to connect with a larger, vibrant community of Microsoft content developers, industry professionals, and customers from around the globe. To join, add yourself as a member of the [CAAB (Cloud Adoption Advisory Board) space](https://aka.ms/caab) of the Microsoft Tech Community and send us a quick email at [CAAB@microsoft.com](mailto:caab@microsoft.com?Subject=I%20just%20joined%20the%20Cloud%20Adoption%20Advisory%20Board!). Anyone can read community-related content on the [CAAB blog](https://blogs.technet.com/b/solutions_advisory_board/). However, CAAB members get invitations to private webinars that describe new cloud adoption resources and solutions.  </span></span><br/> |
|<span data-ttu-id="15b09-300">**Obtenga los archivos de arte que ve aquí**</span><span class="sxs-lookup"><span data-stu-id="15b09-300">**Get the art you see here**</span></span> <br/> |<span data-ttu-id="15b09-p138">Si quiere recibir una copia editable de las ilustraciones que se muestran en este artículo, estaremos encantados de enviárselas. Envíe su solicitud por correo electrónico, incluida la dirección URL y el título de la ilustración, a [cloudadopt@microsoft.com](mailto:cloudadopt@microsoft.com?subject=[Art%20Request]:%20).  </span><span class="sxs-lookup"><span data-stu-id="15b09-p138">If you want an editable copy of the art you see in this article, we'll be glad to send it to you. Email your request, including the URL and title of the art, to [cloudadopt@microsoft.com](mailto:cloudadopt@microsoft.com?subject=[Art%20Request]:%20).  </span></span><br/> |
   

