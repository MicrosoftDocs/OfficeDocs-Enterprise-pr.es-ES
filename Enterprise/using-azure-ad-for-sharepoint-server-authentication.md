---
title: "Utiliza AD Azure para autenticación de servidor de SharePoint"
ms.author: tracyp
author: MSFTTracyP
ms.reviewer:
- kirke
- josephd
- kirks
manager: laurawi
ms.date: 3/2/2018
ms.audience: ITPro
ms.topic: article
ms.service: o365-solutions
localization_priority: Normal
ms.collection:
- Ent_O365
- Ent_O365_Hybrid
ms.custom: Ent_Solutions
ms.assetid: 
description: "Resumen: Conozca cómo omitir el servicio de Control de acceso de Azure y utilizar SAML 1.1 para autenticar a los usuarios de SharePoint Server con Active Directory de Azure."
ms.openlocfilehash: 1e8ce1aad43e110311c1f5fcceca816871c07e9e
ms.sourcegitcommit: 2cfb30dd7c7a6bc9fa97a98f56ab8fe008504f41
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/09/2018
---
# <a name="using-azure-ad-for-sharepoint-server-authentication"></a><span data-ttu-id="45b3a-103">Utiliza AD Azure para autenticación de servidor de SharePoint</span><span class="sxs-lookup"><span data-stu-id="45b3a-103">Using Azure AD for SharePoint Server Authentication</span></span>

 <span data-ttu-id="45b3a-104">**Resumen:** Aprenda cómo autenticar a sus usuarios de 2016 de SharePoint Server con Active Directory de Azure.</span><span class="sxs-lookup"><span data-stu-id="45b3a-104">**Summary:** Learn how to authenticate your SharePoint Server 2016 users with Azure Active Directory.</span></span>
  
> [!NOTE]
> <span data-ttu-id="45b3a-105">En este artículo se basa en el trabajo de Kirk Evans, un administrador Principal de programas de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="45b3a-105">This article is based on the work of Kirk Evans, a Microsoft Principal Program Manager.</span></span> 

<blockquote>
<p><span data-ttu-id="45b3a-p101">En este artículo se refiere a los ejemplos de código para interactuar con el gráfico de Azure Active Directory. Puede descargar los ejemplos de código [aquí](https://github.com/kaevans/spsaml11/tree/master/scripts).</span><span class="sxs-lookup"><span data-stu-id="45b3a-p101">This article refers to code samples for interacting with Azure Active Directory Graph. You can download the code samples  [here](https://github.com/kaevans/spsaml11/tree/master/scripts).</span></span></p>
</blockquote>

<span data-ttu-id="45b3a-p102">SharePoint Server 2016 proporciona la capacidad para autenticar a los usuarios mediante la autenticación basada en notificaciones, facilitando la tarea de administrar los usuarios mediante la autenticación de con proveedores de identidades diferentes que confía pero otra persona administra. Por ejemplo, en lugar de administrar la autenticación del usuario a través de los servicios de dominio de Active Directory (AD DS), podría permitir a los usuarios autenticarse con Active Directory (AD Azure) de Azure. Esto permite la autenticación de los usuarios sólo nube con el sufijo onmicrosoft.com en su nombre de usuario, los usuarios sincronizan con un directorio local, invitó a los usuarios invitados desde otros directorios. También permite aprovechar las características de AD Azure como una autenticación multifactor y capacidades de reporting avanzadas.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p102">SharePoint Server 2016 provides the ability to authenticate users using claims-based authentication, making it easy to manage your users by authenticating them with different identity providers that you trust but someone else manages. For example, instead of managing user authentication through Active Directory Domain Services (AD DS), you could enable users to authenticate using Azure Active Directory (Azure AD). This enables authentication for cloud-only users with the onmicrosoft.com suffix in their username, users synchronized with an on-premises directory, and invited guest users from other directories. It also enables you to take advantage of Azure AD features such as multi-factor authentication and advanced reporting capabilities.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="45b3a-p103">La solución descrita en este artículo también puede utilizarse con SharePoint Server 2013; Sin embargo, tenga en cuenta que SharePoint Server 2013 llega al final del periodo de soporte técnico. Para obtener más información, vea [Directiva de ciclo de vida de Microsoft](https://support.microsoft.com/en-us/lifecycle/search?alpha=SharePoint%20Server%202013) y [Actualiza producto Directiva de servicio para SharePoint 2013](https://technet.microsoft.com/library/684173bb-e90a-4eb7-b268-b8d7458bc802(v=office.16).aspx).</span><span class="sxs-lookup"><span data-stu-id="45b3a-p103">The solution described in this article can also be used with SharePoint Server 2013; however, keep in mind that SharePoint Server 2013 is nearing the end of mainstream support. For more information, see [Microsoft Lifecycle Policy](https://support.microsoft.com/en-us/lifecycle/search?alpha=SharePoint%20Server%202013) and [Updated Product Servicing Policy for SharePoint 2013](https://technet.microsoft.com/library/684173bb-e90a-4eb7-b268-b8d7458bc802(v=office.16).aspx).</span></span>

<span data-ttu-id="45b3a-p104">Este artículo explica cómo puede usar AD Azure para autenticar a los usuarios en lugar de sus instalaciones en AD DS. En esta configuración, AD Azure se convierte en un proveedor de identidad de confianza para SharePoint Server 2016. Esta configuración agrega un método de autenticación de usuario que es independiente de la autenticación de AD DS utilizada por la propia instalación de SharePoint Server 2016. Para beneficiarse de este artículo, debe estar familiarizado con WS-Federation. Para obtener más información, consulte [Understanding WS-Federation](https://go.microsoft.com/fwlink/p/?linkid=188052).</span><span class="sxs-lookup"><span data-stu-id="45b3a-p104">This article explains how you can use Azure AD to authenticate your users instead of your on-premises AD DS. In this configuration, Azure AD becomes a trusted identity provider for SharePoint Server 2016. This configuration adds a user authentication method that is separate from the AD DS authentication used by the SharePoint Server 2016 installation itself. To benefit from this article, you should be familiar with WS-Federation. For more information, see [Understanding WS-Federation](https://go.microsoft.com/fwlink/p/?linkid=188052).</span></span>

![Uso de Azure AD para autenticación de SharePoint](images/SAML11/fig1-architecture.png)

<span data-ttu-id="45b3a-p105">Anteriormente, esta configuración habría requerido un servicio de federación como Azure Access Control Service (ACS) en la nube o en un entorno que aloja los servicios de federación de Active Directory (AD FS) transformar los símbolos (tokens) de SAML 2.0 SAML 1.1. Esta transformación ya no es necesaria debido a que ahora AD Azure permite emisores tokens SAML 1.1. El diagrama anterior muestra cómo funciona la autenticación para los usuarios de SharePoint 2016 en esta configuración, demostrando que ya no es un requisito para un intermediario realizar esta transformación.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p105">Previously, this configuration would have required a federation service such as Azure Access Control Service (ACS) in the cloud or an environment that hosts Active Directory Federation Services (AD FS) to transform tokens from SAML 2.0 to SAML 1.1. This transformation is no longer required as Azure AD now enables issuing SAML 1.1 tokens. The diagram above shows how authentication works for SharePoint 2016 users in this configuration, demonstrating that there is no longer a requirement for an intermediary to perform this transformation.</span></span>

> [!NOTE]
> <span data-ttu-id="45b3a-p106">Esta configuración funciona si el conjunto de servidores de SharePoint se hospeda en Azure máquinas virtuales o locales. No requiere abrir puertos de firewall adicional aparte de asegurar que los usuarios puede tener acceso a Active Directory de Azure desde su explorador.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p106">This configuration works whether the SharePoint farm is hosted in Azure virtual machines or on-premises. It does not require opening additional firewall ports other than ensuring users can access Azure Active Directory from their browser.</span></span>

<span data-ttu-id="45b3a-125">Para obtener información acerca de la accesibilidad de 2016 de SharePoint, consulte [Las pautas de accesibilidad de 2016 de SharePoint Server](https://go.microsoft.com/fwlink/p/?LinkId=393123).</span><span class="sxs-lookup"><span data-stu-id="45b3a-125">For information about SharePoint 2016 accessibility, see [Accessibility Guidelines in SharePoint Server 2016](https://go.microsoft.com/fwlink/p/?LinkId=393123).</span></span>

## <a name="configuration-overview"></a><span data-ttu-id="45b3a-126">Descripción general de la configuración</span><span class="sxs-lookup"><span data-stu-id="45b3a-126">Configuration overview</span></span>

<span data-ttu-id="45b3a-127">Siga estos pasos generales para configurar su entorno para utilizar AD Azure como proveedor de identidad de 2016 de SharePoint Server.</span><span class="sxs-lookup"><span data-stu-id="45b3a-127">Follow these general steps to set up your environment to use Azure AD as a SharePoint Server 2016 identity provider.</span></span>

1. <span data-ttu-id="45b3a-128">Crear un nuevo directorio de Azure AD o utilizar su directorio existente.</span><span class="sxs-lookup"><span data-stu-id="45b3a-128">Create a new Azure AD directory or use your existing directory.</span></span>
2. <span data-ttu-id="45b3a-129">Asegúrese de que la zona de la aplicación web que desea proteger con AD Azure está configurada para utilizar SSL.</span><span class="sxs-lookup"><span data-stu-id="45b3a-129">Ensure the zone for the web application that you want to secure with Azure AD is configured to use SSL.</span></span>
3. <span data-ttu-id="45b3a-130">Cree una nueva aplicación empresarial en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="45b3a-130">Create a new enterprise application in Azure AD.</span></span>
4. <span data-ttu-id="45b3a-131">Configurar un nuevo proveedor de identidad de confianza en SharePoint Server 2016.</span><span class="sxs-lookup"><span data-stu-id="45b3a-131">Configure a new trusted identity provider in SharePoint Server 2016.</span></span>
5. <span data-ttu-id="45b3a-132">Establezca los permisos para la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="45b3a-132">Set the permissions for the web application.</span></span>
6. <span data-ttu-id="45b3a-133">Agregue una directiva de emisión de token SAML 1.1 en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="45b3a-133">Add a SAML 1.1 token issuance policy in Azure AD.</span></span>
7. <span data-ttu-id="45b3a-134">Compruebe el nuevo proveedor.</span><span class="sxs-lookup"><span data-stu-id="45b3a-134">Verify the new provider.</span></span>

<span data-ttu-id="45b3a-135">Las secciones siguientes describen cómo realizar estas tareas.</span><span class="sxs-lookup"><span data-stu-id="45b3a-135">The following sections describe how to perform these tasks.</span></span>

## <a name="step-1-create-a-new-azure-ad-directory-or-use-your-existing-directory"></a><span data-ttu-id="45b3a-136">Paso 1: Crear un nuevo directorio de Azure AD o utilizar su directorio existente</span><span class="sxs-lookup"><span data-stu-id="45b3a-136">Step 1: Create a new Azure AD directory or use your existing directory</span></span>

<span data-ttu-id="45b3a-p107">En el Portal de Azure ([https://portal.azure.com](https://portal.azure.com)), cree un nuevo directorio. Proporcionar el nombre de la organización, nombre de dominio inicial y el país o región.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p107">In the Azure Portal ([https://portal.azure.com](https://portal.azure.com)), create a new directory. Provide the organization name, initial domain name, and the country or region.</span></span>

![Creación de un directorio](images/SAML11/fig2-createdirectory.png) 

 <span data-ttu-id="45b3a-p108">Si ya tiene un directorio como el que se usa para Microsoft Office 365 o la suscripción de Microsoft Azure, puede utilizar dicho directorio en su lugar. Debe tener permisos para registrar las aplicaciones en el directorio.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p108">If you already have a directory such as the one used for Microsoft Office 365 or your Microsoft Azure subscription, you can use that directory instead. You must have permissions to register applications in the directory.</span></span>

## <a name="step-2-ensure-the-zone-for-the-web-application-that-you-want-to-secure-with-azure-ad-is-configured-to-use-ssl"></a><span data-ttu-id="45b3a-142">Paso 2: Asegurar la zona para la aplicación web que desea proteger con AD Azure está configurada para utilizar SSL</span><span class="sxs-lookup"><span data-stu-id="45b3a-142">Step 2: Ensure the zone for the web application that you want to secure with Azure AD is configured to use SSL</span></span>

<span data-ttu-id="45b3a-p109">Este artículo fue escrito con la arquitectura de referencia en [una granja de SharePoint Server 2016 en Azure de alta disponibilidad de ejecución](https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/sharepoint). Secuencias de comandos de acompañamiento del artículo utilizados para implementar la solución descrita en [este artículo](https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/sharepoint) crean un sitio que no utiliza SSL.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p109">This article was written using the reference architecture in [Run a high availability SharePoint Server 2016 farm in Azure](https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/sharepoint). The article’s accompanying scripts used to deploy the solution described in [this article](https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/sharepoint) create a site that does not use SSL.</span></span>  

<span data-ttu-id="45b3a-p110">El uso de SAML requiere que la aplicación se ha configurado para utilizar SSL. Si la aplicación web de SharePoint no está configurada para utilizar SSL, siga estos pasos para crear un nuevo certificado autofirmado para configurar la aplicación web para SSL. Esta configuración sólo está pensada para un entorno de laboratorio y no está pensada para la producción. Entornos de producción deben utilizar un certificado de firma.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p110">Using SAML requires the application be configured to use SSL. If your SharePoint web application is not configured to use SSL, use the following steps to create a new self-signed certificate to configure the web application for SSL. This configuration is only meant for a lab environment and is not intended for production. Production environments should use a signed certificate.</span></span>

1. <span data-ttu-id="45b3a-p111">Vaya a **Administración Central** > **Gestión de aplicaciones** > **Administrar aplicaciones Web**y elija la aplicación web que debe ampliarse para que use SSL. Seleccione la aplicación web y haga clic en el botón de la **cinta de opciones de extender** . Ampliar la aplicación web utilice la misma dirección URL sin utilizar SSL con el puerto 443.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p111">Go to **Central Administration** > **Application Management** > **Manage Web Applications**, and choose the web application that needs to be extended to use SSL. Select the web application and click the **Extend ribbon** button. Extend the web application to use the same URL but use SSL with port 443.</span></span></br><span data-ttu-id="45b3a-152">![Ampliación de la aplicación web a otro sitio IIS](images/SAML11/fig3-extendwebapptoiis.png)</span><span class="sxs-lookup"><span data-stu-id="45b3a-152">![Extending the web app to another IIS site](images/SAML11/fig3-extendwebapptoiis.png)</span></span></br>
2. <span data-ttu-id="45b3a-153">En Administrador de IIS, haga doble clic en **Certificados de servidor**.</span><span class="sxs-lookup"><span data-stu-id="45b3a-153">In IIS Manager, double-click **Server Certificates**.</span></span>
3. <span data-ttu-id="45b3a-p112">En el panel **acciones** , haga clic en **Crear certificado autofirmado**. Escriba un nombre descriptivo para el certificado en la especifique un nombre descriptivo para el cuadro de certificado y, a continuación, haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p112">In the **Actions** pane, click **Create Self-Signed Certificate**. Type a friendly name for the certificate in the Specify a friendly name for the certificate box, and then click **OK**.</span></span>
4. <span data-ttu-id="45b3a-156">Desde el cuadro de diálogo **Modificar enlace de sitio** , asegúrese del nombre de host es el mismo que el nombre descriptivo, como se ilustra en la siguiente imagen.</span><span class="sxs-lookup"><span data-stu-id="45b3a-156">From the **Edit Site Binding** dialog box, ensure the host name is the same as the friendly name, as illustrated in the following image.</span></span></br><span data-ttu-id="45b3a-157">![Editar enlace de sitio en IIS](images/SAML11/fig4-editsitebinding.png)</span><span class="sxs-lookup"><span data-stu-id="45b3a-157">![Editing site binding in IIS](images/SAML11/fig4-editsitebinding.png)</span></span></br>

<span data-ttu-id="45b3a-158">Cada servidor web front-end en la granja de SharePoint requiere configurar el certificado para el enlace de sitio en IIS.</span><span class="sxs-lookup"><span data-stu-id="45b3a-158">Each of the web front end servers in the SharePoint farm will require configuring the certificate for the site binding in IIS.</span></span>


## <a name="step-3-create-a-new-enterprise-application-in-azure-ad"></a><span data-ttu-id="45b3a-159">Paso 3: Crear una nueva aplicación empresarial en Azure AD</span><span class="sxs-lookup"><span data-stu-id="45b3a-159">Step 3: Create a new enterprise application in Azure AD</span></span>

1. <span data-ttu-id="45b3a-p113">En el Portal de Azure ([https://portal.azure.com](https://portal.azure.com)), abra el directorio de AD de Azure. **Aplicaciones de la empresa**, haga clic en **nueva aplicación**. Elija **Galería de no aplicación**. Proporcione un nombre, como la *Integración de SAML de SharePoint* y haga clic en **Agregar**.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p113">In the Azure Portal ([https://portal.azure.com](https://portal.azure.com)), open your Azure AD directory. Click **Enterprise Applications**, then click **New application**. Choose **Non-gallery application**. Provide a name such as *SharePoint SAML Integration* and click **Add**.</span></span></br><span data-ttu-id="45b3a-164">![Agregar una nueva aplicación de galería no](images/SAML11/fig5-addnongalleryapp.png)</span><span class="sxs-lookup"><span data-stu-id="45b3a-164">![Adding a new non-gallery application](images/SAML11/fig5-addnongalleryapp.png)</span></span></br>
2. <span data-ttu-id="45b3a-p114">Haga clic en el vínculo de inicio de sesión único del panel de exploración para configurar la aplicación. Cambiar la lista desplegable **modo de inicio de sesión único** **basado en SAML de sesión** para mostrar las propiedades de configuración de SAML para la aplicación. Configurar con las siguientes propiedades:</span><span class="sxs-lookup"><span data-stu-id="45b3a-p114">Click the Single sign-on link in the navigation pane to configure the application. Change the **Single Sign-on Mode** dropdown to **SAML-based Sign-on** to reveal the SAML configuration properties for the application. Configure with the following properties:</span></span></br>
    - <span data-ttu-id="45b3a-168">Identificador:`urn:sharepoint:portal.contoso.local`</span><span class="sxs-lookup"><span data-stu-id="45b3a-168">Identifier: `urn:sharepoint:portal.contoso.local`</span></span>
    - <span data-ttu-id="45b3a-169">Dirección URL de respuesta:`https://portal.contoso.local/_trust/default.aspx`</span><span class="sxs-lookup"><span data-stu-id="45b3a-169">Reply URL: `https://portal.contoso.local/_trust/default.aspx`</span></span>
    - <span data-ttu-id="45b3a-170">URL de inicio de sesión:`https://portal.contoso.local/_trust/default.aspx`</span><span class="sxs-lookup"><span data-stu-id="45b3a-170">Sign-on URL: `https://portal.contoso.local/_trust/default.aspx`</span></span>
    - <span data-ttu-id="45b3a-171">Identificador de usuario:`user.userprincipalname`</span><span class="sxs-lookup"><span data-stu-id="45b3a-171">User Identifier: `user.userprincipalname`</span></span></br>
    - <span data-ttu-id="45b3a-172">Nota: No olvide cambiar las direcciones URL sustituyendo *portal.contoso.local* por la dirección URL del sitio de SharePoint que desea proteger.</span><span class="sxs-lookup"><span data-stu-id="45b3a-172">Note: Remember to change the URLs by replacing *portal.contoso.local* with the URL of the SharePoint site you want to secure.</span></span></br>
3. <span data-ttu-id="45b3a-173">Configurar una tabla (similar a la tabla 1 a continuación) incluye las filas siguientes:</span><span class="sxs-lookup"><span data-stu-id="45b3a-173">Set up a table (similar to Table 1 below) that includes the following rows:</span></span></br> 
    - <span data-ttu-id="45b3a-174">Territorio</span><span class="sxs-lookup"><span data-stu-id="45b3a-174">Realm</span></span>
    - <span data-ttu-id="45b3a-175">Ruta de acceso completa del archivo de certificado de firma de SAML</span><span class="sxs-lookup"><span data-stu-id="45b3a-175">Full path to SAML signing certificate file</span></span>
    - <span data-ttu-id="45b3a-176">URL SAML Single Sign-On service (sustituyendo */saml2* por */wsfed*)</span><span class="sxs-lookup"><span data-stu-id="45b3a-176">SAML Single Sign-On service URL (replacing */saml2* with */wsfed*)</span></span>
    - <span data-ttu-id="45b3a-177">Identificador de objeto de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="45b3a-177">Application Object ID.</span></span> </br>
<span data-ttu-id="45b3a-178">Copia el valor del *identificador* de la propiedad del *territorio* en una tabla (ver tabla 1 a continuación.)</span><span class="sxs-lookup"><span data-stu-id="45b3a-178">Copy the *Identifier* value into the *Realm* property into a table  (See Table 1 below.)</span></span>
4. <span data-ttu-id="45b3a-179">Guarde los cambios.</span><span class="sxs-lookup"><span data-stu-id="45b3a-179">Save your changes.</span></span>
5. <span data-ttu-id="45b3a-180">Haga clic en el vínculo **Configurar (nombre de la aplicación)** para tener acceso a la página de inicio de sesión de configuración.</span><span class="sxs-lookup"><span data-stu-id="45b3a-180">Click the **Configure (app name)** link to access the Configure sign-on page.</span></span></br><span data-ttu-id="45b3a-181">![Cómo configurar un inicio de sesión único en la página](images/SAML11/fig7-configssopage.png)</span><span class="sxs-lookup"><span data-stu-id="45b3a-181">![Configuring a single-sign on page](images/SAML11/fig7-configssopage.png)</span></span></br> 
    -  <span data-ttu-id="45b3a-p115">Haga clic en el vínculo de **SAML certificado de firma - Raw** para descargar el certificado de firma de SAML como un archivo con la extensión .cer. Copie y pegue la ruta de acceso completa del archivo descargado en la tabla.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p115">Click the **SAML Signing Certificate - Raw** link to download the SAML Signing Certificate as a file with the .cer extension. Copy and paste the full path to the downloaded file into your table.</span></span>
    - <span data-ttu-id="45b3a-184">Copie y pegue el vínculo SAML único Sign-On Service URL en su, sustituyendo la porción */saml2* de la dirección URL */wsfed*.</span><span class="sxs-lookup"><span data-stu-id="45b3a-184">Copy and paste the SAML Single Sign-On Service URL link into your, replacing the */saml2* portion of the URL with */wsfed*.</span></span></br>
6.  <span data-ttu-id="45b3a-p116">Desplácese hasta el panel de **Propiedades** para la aplicación. Copie y pegue el valor del identificador de objeto en la tabla que se configuró en el paso 3.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p116">Navigate to the **Properties** pane for the application. Copy and paste the Object ID value into the table you set up in Step 3.</span></span></br><span data-ttu-id="45b3a-187">![Panel de propiedades para la aplicación](images/SAML11/fig8-propertiespane.png)</span><span class="sxs-lookup"><span data-stu-id="45b3a-187">![Properties pane for the application](images/SAML11/fig8-propertiespane.png)</span></span></br>
7. <span data-ttu-id="45b3a-188">Con los valores capturados, asegúrese de que la tabla que se configuró en el paso 3 es similar a la tabla 1.</span><span class="sxs-lookup"><span data-stu-id="45b3a-188">Using the values you captured, make sure the table you set up in Step 3 resembles Table 1 below.</span></span>


| <span data-ttu-id="45b3a-189">Tabla 1: Los valores capturados</span><span class="sxs-lookup"><span data-stu-id="45b3a-189">Table 1: Values captured</span></span>  |  |
|---------|---------|
|<span data-ttu-id="45b3a-190">Territorio</span><span class="sxs-lookup"><span data-stu-id="45b3a-190">Realm</span></span> | `urn:sharepoint:portal.contoso.local` |
|<span data-ttu-id="45b3a-191">Ruta de acceso completa del archivo de certificado de firma de SAML</span><span class="sxs-lookup"><span data-stu-id="45b3a-191">Full path to SAML signing certificate file</span></span> | `C:/temp/SharePoint SAML Integration.cer`  |
|<span data-ttu-id="45b3a-192">Dirección URL del servicio de inicio de sesión único de SAML (reemplace /saml2 por /wsfed)</span><span class="sxs-lookup"><span data-stu-id="45b3a-192">SAML single sign-on service URL (replace /saml2 with /wsfed)</span></span> | `https://login.microsoftonline.com/b1726649-b616-460d-8d20-defab80d476c/wsfed` |
|<span data-ttu-id="45b3a-193">Id. de objeto de aplicación</span><span class="sxs-lookup"><span data-stu-id="45b3a-193">Application Object ID</span></span> | `a812f48b-d1e4-4c8e-93be-e4808c8ca3ac` |

> [!IMPORTANT]
> <span data-ttu-id="45b3a-p117">Sustituya el valor de */saml2* en la dirección URL */wsfed*. El extremo */saml2* procesará tokens SAML 2.0. El extremo de */wsfed* permite tokens SAML 1.1 de procesamiento y se requiere para la federación de SharePoint 2016 SAML.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p117">Replace the */saml2* value in the URL with */wsfed*. The */saml2* endpoint will process SAML 2.0 tokens. The */wsfed* endpoint enables processing SAML 1.1 tokens and is required for SharePoint 2016 SAML federation.</span></span>

## <a name="step-4-configure-a-new-trusted-identity-provider-in-sharepoint-server-2016"></a><span data-ttu-id="45b3a-197">Paso 4: Configurar un nuevo proveedor de identidad de confianza en SharePoint Server 2016</span><span class="sxs-lookup"><span data-stu-id="45b3a-197">Step 4: Configure a new trusted identity provider in SharePoint Server 2016</span></span>

<span data-ttu-id="45b3a-p118">Iniciar sesión en el servidor de SharePoint Server 2016 y abra el Shell de administración de SharePoint de 2016. Rellene los valores de $realm, $wsfedurl y $filepath en la tabla 1 y ejecute los comandos siguientes para configurar un nuevo proveedor de identidad de confianza.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p118">Sign into the SharePoint Server 2016 server and open the SharePoint 2016 Management Shell. Fill in the values of $realm, $wsfedurl, and $filepath from Table 1 and run the following commands to configure a new trusted identity provider.</span></span>

> [!TIP]
> <span data-ttu-id="45b3a-200">Si está acostumbrado a utilizar PowerShell o desea obtener más información acerca del funcionamiento de PowerShell, vea [SharePoint PowerShell](https://docs.microsoft.com/en-us/powershell/sharepoint/overview?view=sharepoint-ps).</span><span class="sxs-lookup"><span data-stu-id="45b3a-200">If you're new to using PowerShell or want to learn more about how PowerShell works, see [SharePoint PowerShell](https://docs.microsoft.com/en-us/powershell/sharepoint/overview?view=sharepoint-ps).</span></span> 

```
$realm = "<Realm from Table 1>"
$wsfedurl="<SAML single sign-on service URL from Table 1>"
$filepath="<Full path to SAML signing certificate file from Table 1>"
$cert = New-Object System.Security.Cryptography.X509Certificates.X509Certificate2($filepath)
New-SPTrustedRootAuthority -Name "AzureAD" -Certificate $cert
$map = New-SPClaimTypeMapping -IncomingClaimType "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name" -IncomingClaimTypeDisplayName "name" -LocalClaimType "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn"
$map2 = New-SPClaimTypeMapping -IncomingClaimType "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname" -IncomingClaimTypeDisplayName "GivenName" -SameAsIncoming
$map3 = New-SPClaimTypeMapping -IncomingClaimType "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname" -IncomingClaimTypeDisplayName "SurName" -SameAsIncoming
$ap = New-SPTrustedIdentityTokenIssuer -Name "AzureAD" -Description "SharePoint secured by Azure AD" -realm $realm -ImportTrustCertificate $cert -ClaimsMappings $map,$map2,$map3 -SignInUrl $wsfedurl -IdentifierClaim "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"
```

<span data-ttu-id="45b3a-201">A continuación, siga estos pasos para habilitar al proveedor de identidad de confianza para la aplicación:</span><span class="sxs-lookup"><span data-stu-id="45b3a-201">Next, follow these steps to enable the trusted identity provider for your application:</span></span>
1. <span data-ttu-id="45b3a-202">En Administración Central, vaya a **Administrar las aplicaciones Web** y seleccione la aplicación web que desea asegurar con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="45b3a-202">In Central Administration, navigate to **Manage Web Application** and select the web application that you wish to secure with Azure AD.</span></span> 
2. <span data-ttu-id="45b3a-203">En la cinta de opciones, haga clic en **Proveedores de autenticación** y elija la zona que desea utilizar.</span><span class="sxs-lookup"><span data-stu-id="45b3a-203">In the ribbon, click **Authentication Providers** and choose the zone that you wish to use.</span></span>
3. <span data-ttu-id="45b3a-204">Seleccione el **proveedor de identidades de confianza** y el proveedor de identidad que acaba de registrar denominado *AzureAD*.</span><span class="sxs-lookup"><span data-stu-id="45b3a-204">Select **Trusted Identity provider** and select the identify provider you just registered named *AzureAD*.</span></span>  
4. <span data-ttu-id="45b3a-205">En la configuración de dirección URL de la página de inicio de sesión, seleccione la **página de suscripción personalizados** y proporcionar el valor "/_trust/".</span><span class="sxs-lookup"><span data-stu-id="45b3a-205">On the sign-in page URL setting, select **Custom sign in page** and provide the value “/_trust/”.</span></span> 
5. <span data-ttu-id="45b3a-206">Haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="45b3a-206">Click **OK**.</span></span>

![Configurar el proveedor de autenticación](images/SAML11/fig10-configauthprovider.png)

## <a name="step-5-set-the-permissions"></a><span data-ttu-id="45b3a-208">Paso 5: Establecer los permisos</span><span class="sxs-lookup"><span data-stu-id="45b3a-208">Step 5: Set the permissions</span></span>

<span data-ttu-id="45b3a-209">Los usuarios que van a iniciar sesión en Azure AD y tener acceso a SharePoint deben tener acceso a la aplicación.</span><span class="sxs-lookup"><span data-stu-id="45b3a-209">The users who will log into Azure AD and access SharePoint must be granted access to the application.</span></span> 

1. <span data-ttu-id="45b3a-p119">En el Portal de Azure, abra el directorio de AD de Azure. **Aplicaciones de la empresa**, haga clic en **todas las aplicaciones**. Haga clic en la aplicación que creó anteriormente (integración de SAML de SharePoint).</span><span class="sxs-lookup"><span data-stu-id="45b3a-p119">In the Azure Portal, open the Azure AD directory. Click **Enterprise Applications**, then click **All applications**. Click the application that you created previously (SharePoint SAML Integration).</span></span>
2. <span data-ttu-id="45b3a-213">Haga clic en **usuarios y grupos**.</span><span class="sxs-lookup"><span data-stu-id="45b3a-213">Click **Users and Groups**.</span></span> 
3. <span data-ttu-id="45b3a-214">Haga clic en **Agregar usuario** para agregar un usuario o grupo que tenga permisos para iniciar sesión en SharePoint con Azure AD.</span><span class="sxs-lookup"><span data-stu-id="45b3a-214">Click **Add user** to add a user or group who will have permissions to log into SharePoint using Azure AD.</span></span>
4. <span data-ttu-id="45b3a-215">Seleccione el usuario o grupo y haga clic en **asignar**.</span><span class="sxs-lookup"><span data-stu-id="45b3a-215">Select the user or group then click **Assign**.</span></span>
 
<span data-ttu-id="45b3a-p120">El usuario tiene permiso de Azure AD, pero también debe tener permiso en SharePoint. Utilice los pasos siguientes para establecer los permisos para tener acceso a la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p120">The user has been granted permission in Azure AD, but also must be granted permission in SharePoint. Use the following steps to set the permissions to access the web application.</span></span>

1. <span data-ttu-id="45b3a-218">En Administración Central, haga clic en **Administración de aplicaciones**.</span><span class="sxs-lookup"><span data-stu-id="45b3a-218">In Central Administration, click **Application Management**.</span></span>
2. <span data-ttu-id="45b3a-219">En la sección **Aplicaciones web** de la página **Administración de aplicaciones**, haga clic en **Administrar aplicaciones web**.</span><span class="sxs-lookup"><span data-stu-id="45b3a-219">On the **Application Management** page, in the **Web Applications** section, click **Manage web applications**.</span></span>
3. <span data-ttu-id="45b3a-220">Haga clic en la aplicación web adecuada y, a continuación, haga clic en **Directiva de usuario**.</span><span class="sxs-lookup"><span data-stu-id="45b3a-220">Click the appropriate web application, and then click **User Policy**.</span></span>
4. <span data-ttu-id="45b3a-221">En directiva de aplicación Web, haga clic en **Agregar usuarios**.</span><span class="sxs-lookup"><span data-stu-id="45b3a-221">In Policy for Web Application, click **Add Users**.</span></span></br><span data-ttu-id="45b3a-222">![Buscar un usuario por su notificación de nombre](images/SAML11/fig11-searchbynameclaim.png)</span><span class="sxs-lookup"><span data-stu-id="45b3a-222">![Searching for a user by their name claim](images/SAML11/fig11-searchbynameclaim.png)</span></span></br>
5. <span data-ttu-id="45b3a-223">En el cuadro de diálogo **Agregar usuarios**, haga clic en la zona apropiada en la sección **Zonas** y, después, haga clic en **Siguiente**.</span><span class="sxs-lookup"><span data-stu-id="45b3a-223">In the **Add Users** dialog box, click the appropriate zone in **Zones**, and then click **Next**.</span></span>
6. <span data-ttu-id="45b3a-224">En el cuadro de diálogo **Directiva de aplicación Web** , en la sección **Elegir usuarios** , haga clic en el icono **Examinar** .</span><span class="sxs-lookup"><span data-stu-id="45b3a-224">In the **Policy for Web Application** dialog box, in the **Choose Users** section, click the **Browse** icon.</span></span>
7. <span data-ttu-id="45b3a-225">En el cuadro de texto **Buscar** , escriba el nombre de inicio de sesión para un usuario en el directorio y haga clic en **Buscar**.</span><span class="sxs-lookup"><span data-stu-id="45b3a-225">In the **Find** textbox, type the sign-in name for a user in your directory and click **Search**.</span></span> </br><span data-ttu-id="45b3a-226">Ejemplo: *demouser@blueskyabove.onmicrosoft.com*.</span><span class="sxs-lookup"><span data-stu-id="45b3a-226">Example: *demouser@blueskyabove.onmicrosoft.com*.</span></span>
8. <span data-ttu-id="45b3a-227">Bajo el título de AzureAD en la vista de lista, seleccione la propiedad name y haga clic en **Agregar** , a continuación, haga clic en **Aceptar** para cerrar el cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="45b3a-227">Under the AzureAD heading in the list view, select the name property and click **Add** then click **OK** to close the dialog.</span></span>
9. <span data-ttu-id="45b3a-228">En permisos, haga clic en **Control total**.</span><span class="sxs-lookup"><span data-stu-id="45b3a-228">In Permissions, click **Full Control**.</span></span></br><span data-ttu-id="45b3a-229">![Conceder control total a un usuario de reclamaciones](images/SAML11/fig12-grantfullcontrol.png)</span><span class="sxs-lookup"><span data-stu-id="45b3a-229">![Granting full control to a claims user](images/SAML11/fig12-grantfullcontrol.png)</span></span></br>
10. <span data-ttu-id="45b3a-230">Haga clic en **Finalizar** y, después, en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="45b3a-230">Click **Finish**, and then click **OK**.</span></span>

## <a name="step-6-add-a-saml-11-token-issuance-policy-in-azure-ad"></a><span data-ttu-id="45b3a-231">Paso 6: Agregar una directiva de emisión de token SAML 1.1 en Azure AD</span><span class="sxs-lookup"><span data-stu-id="45b3a-231">Step 6: Add a SAML 1.1 token issuance policy in Azure AD</span></span>

<span data-ttu-id="45b3a-p121">Cuando se crea la aplicación AD Azure en el portal, el valor predeterminado es mediante SAML 2.0. SharePoint Server 2016 requiere el formato de token SAML 1.1. La siguiente secuencia de comandos se quite la directiva predeterminada de SAML 2.0 y agregar una nueva directiva a tokens SAML 1.1 del problema. Este código requiere la descarga de la que se incluyen [ejemplos que muestran la interacción con Active Directory gráfico de Azure](https://github.com/kaevans/spsaml11/tree/master/scripts).</span><span class="sxs-lookup"><span data-stu-id="45b3a-p121">When the Azure AD application is created in the portal, it defaults to using SAML 2.0. SharePoint Server 2016 requires the SAML 1.1 token format. The following script will remove the default SAML 2.0 policy and add a new policy to issue SAML 1.1 tokens. This code requires downloading the accompanying [samples demonstrating interacting with Azure Active Directory Graph](https://github.com/kaevans/spsaml11/tree/master/scripts).</span></span>


```
Import-Module <file path of Initialize.ps1> 
$objectid = "<Application Object ID from Table 1>"
$saml2policyid = Get-PoliciesAssignedToServicePrincipal -servicePrincipalId $objectid | ?{$_.displayName -EQ "TokenIssuancePolicy"} | select objectId
Remove-PolicyFromServicePrincipal -policyId $saml2policyid -servicePrincipalId $objectid
$policy = Add-TokenIssuancePolicy -DisplayName SPSAML11 -SigningAlgorithm "http://www.w3.org/2001/04/xmldsig-more#rsa-sha256" -TokenResponseSigningPolicy TokenOnly -SamlTokenVersion "1.1"
Set-PolicyToServicePrincipal -policyId $policy.objectId -servicePrincipalId $objectid
```

<span data-ttu-id="45b3a-236">Para obtener más información sobre directivas de emisión de Token con AD Azure, consulte la [referencia de la API de gráfico para operaciones de directiva](https://msdn.microsoft.com/en-us/library/azure/ad/graph/api/policy-operations#create-a-policy).</span><span class="sxs-lookup"><span data-stu-id="45b3a-236">For more details on Token Issuance Policies with Azure AD, see the [Graph API reference for operations on policy](https://msdn.microsoft.com/en-us/library/azure/ad/graph/api/policy-operations#create-a-policy).</span></span>

## <a name="step-7-verify-the-new-provider"></a><span data-ttu-id="45b3a-237">Paso 7: Compruebe el nuevo proveedor</span><span class="sxs-lookup"><span data-stu-id="45b3a-237">Step 7: Verify the new provider</span></span>

<span data-ttu-id="45b3a-p122">Abra un explorador a la dirección URL de la aplicación web que configuró en los pasos anteriores. Se le redirige para iniciar sesión en Azure AD.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p122">Open a browser to the URL of the web application that you configured in the previous steps. You are redirected to sign into Azure AD.</span></span>

![Iniciar sesión en Azure AD configurado para la federación](images/SAML11/fig13-examplesignin.png)

<span data-ttu-id="45b3a-241">Le pregunta si desea permanecer conectado.</span><span class="sxs-lookup"><span data-stu-id="45b3a-241">You are asked if you want to stay signed in.</span></span>

![¿Permanecer conectado?](images/SAML11/fig14-staysignedin.png)

<span data-ttu-id="45b3a-243">Por último, puede tener acceso el sitio iniciado sesión como un usuario de su arrendatario Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="45b3a-243">Finally, you can access the site logged in as a user from your Azure Active Directory tenant.</span></span>

![Usuario que ha iniciado sesión en SharePoint](images/SAML11/fig15-signedinsharepoint.png)

## <a name="managing-certificates"></a><span data-ttu-id="45b3a-245">Administración de certificados</span><span class="sxs-lookup"><span data-stu-id="45b3a-245">Managing certificates</span></span>
<span data-ttu-id="45b3a-p123">Es importante comprender que el certificado de firma que se ha configurado para el proveedor de identidad de confianza en el paso 4 anterior tiene una fecha de vencimiento y debe renovarse. Vea el artículo [Administrar certificados para federados, single sign-on en Azure Active Directory](https://docs.microsoft.com/en-us/azure/active-directory/active-directory-sso-certs) para obtener información sobre la renovación de certificados. Una vez que se ha renovado el certificado en Active Directory de Azure, descarga en un archivo local y utilizar la siguiente secuencia de comandos para configurar el proveedor de identidad de confianza con el certificado de firma renovado.</span><span class="sxs-lookup"><span data-stu-id="45b3a-p123">It is important to understand that the signing certificate that was configured for the trusted identity provider in step 4 above has an expiration date and must be renewed. See the article [Manage certificates for federated single sign-on in Azure Active Directory](https://docs.microsoft.com/en-us/azure/active-directory/active-directory-sso-certs) for information on certificate renewal. Once the certificate has been renewed in Azure AD, download to a local file and use the following script to configure the trusted identity provider with the renewed signing certificate.</span></span> 

```
$filepath="<Full path to renewed SAML signing certificate file>"
$cert= New-Object System.Security.Cryptography.X509Certificates.X509Certificate2($filePath)
New-SPTrustedRootAuthority -Name "AzureAD" -Certificate $cert
Get-SPTrustedIdentityTokenIssuer "AzureAD" | Set-SPTrustedIdentityTokenIssuer -ImportTrustCertificate $cert
```



## <a name="additional-resources"></a><span data-ttu-id="45b3a-249">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="45b3a-249">Additional resources</span></span>

[<span data-ttu-id="45b3a-250">Introducción a WS-Federation</span><span class="sxs-lookup"><span data-stu-id="45b3a-250">Understanding WS-Federation</span></span>](https://go.microsoft.com/fwlink/p/?linkid=188052)
  
[<span data-ttu-id="45b3a-251">Adopción de la nube y soluciones híbridas</span><span class="sxs-lookup"><span data-stu-id="45b3a-251">Cloud adoption and hybrid solutions</span></span>](cloud-adoption-and-hybrid-solutions.md)
  
## <a name="join-the-discussion"></a><span data-ttu-id="45b3a-252">Participar en la discusión</span><span class="sxs-lookup"><span data-stu-id="45b3a-252">Join the discussion</span></span>

|<span data-ttu-id="45b3a-253">**Póngase en contacto con nosotros**</span><span class="sxs-lookup"><span data-stu-id="45b3a-253">**Contact us**</span></span>|<span data-ttu-id="45b3a-254">**Descripción**</span><span class="sxs-lookup"><span data-stu-id="45b3a-254">**Description**</span></span>|
|:-----|:-----|
|<span data-ttu-id="45b3a-255">**¿Qué soluciones necesita?**</span><span class="sxs-lookup"><span data-stu-id="45b3a-255">**What cloud adoption content do you need?**</span></span> <br/> |<span data-ttu-id="45b3a-p124">Estamos creando contenido para la adopción en la nube que abarca varios servicios y plataformas en la nube de Microsoft. Díganos qué opina sobre nuestro contenido de adopción en la nube o solicite contenido específico enviando un correo electrónico a [cloudadopt@microsoft.com](mailto:cloudadopt@microsoft.com?Subject=[Cloud%20Adoption%20Content%20Feedback]:%20).  </span><span class="sxs-lookup"><span data-stu-id="45b3a-p124">We are creating content for cloud adoption that spans multiple Microsoft cloud platforms and services. Let us know what you think about our cloud adoption content, or ask for specific content by sending email to [cloudadopt@microsoft.com](mailto:cloudadopt@microsoft.com?Subject=[Cloud%20Adoption%20Content%20Feedback]:%20).  </span></span><br/> |
|<span data-ttu-id="45b3a-258">**Participe en la discusión sobre soluciones**</span><span class="sxs-lookup"><span data-stu-id="45b3a-258">**Join the cloud adoption discussion**</span></span> <br/> |<span data-ttu-id="45b3a-p125">Si es un apasionado de las soluciones basadas en la nube, puede unirse a Cloud Adoption Advisory Board (CAAB) para conectarse a una interesante comunidad de mayor tamaño formada por desarrolladores de contenido de Microsoft, profesionales del sector y clientes de todo el mundo. Para unirse, agregue a su usuario como miembro del [espacio CAAB (Cloud Adoption Advisory Board)](https://aka.ms/caab) de Microsoft Tech Community y envíenos un correo electrónico a [CAAB@microsoft.com](mailto:caab@microsoft.com?Subject=I%20just%20joined%20the%20Cloud%20Adoption%20Advisory%20Board!). Cualquiera puede leer contenido relacionado con la comunidad en el [blog de CAAB](https://blogs.technet.com/b/solutions_advisory_board/). Pero los miembros de CAAB reciben invitaciones a seminarios web privados donde se describen nuevos recursos y soluciones de adopción de la nube.  </span><span class="sxs-lookup"><span data-stu-id="45b3a-p125">If you are passionate about cloud-based solutions, consider joining the Cloud Adoption Advisory Board (CAAB) to connect with a larger, vibrant community of Microsoft content developers, industry professionals, and customers from around the globe. To join, add yourself as a member of the [CAAB (Cloud Adoption Advisory Board) space](https://aka.ms/caab) of the Microsoft Tech Community and send us a quick email at [CAAB@microsoft.com](mailto:caab@microsoft.com?Subject=I%20just%20joined%20the%20Cloud%20Adoption%20Advisory%20Board!). Anyone can read community-related content on the [CAAB blog](https://blogs.technet.com/b/solutions_advisory_board/). However, CAAB members get invitations to private webinars that describe new cloud adoption resources and solutions.  </span></span><br/> |
|<span data-ttu-id="45b3a-262">**Obtenga los archivos de arte que ve aquí**</span><span class="sxs-lookup"><span data-stu-id="45b3a-262">**Get the art you see here**</span></span> <br/> |<span data-ttu-id="45b3a-p126">Si quiere recibir una copia editable de las ilustraciones que se muestran en este artículo, estaremos encantados de enviárselas. Envíe su solicitud por correo electrónico, incluida la dirección URL y el título de la ilustración, a [cloudadopt@microsoft.com](mailto:cloudadopt@microsoft.com?subject=[Art%20Request]:%20).  </span><span class="sxs-lookup"><span data-stu-id="45b3a-p126">If you want an editable copy of the art you see in this article, we'll be glad to send it to you. Email your request, including the URL and title of the art, to [cloudadopt@microsoft.com](mailto:cloudadopt@microsoft.com?subject=[Art%20Request]:%20).  </span></span><br/> |
   

