---
title: Resistencia de datos de Exchange online en Microsoft 365
ms.author: josephd
author: JoeDavies-MSFT
manager: laurawi
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
f1.keywords:
- NOCSH
description: En este artículo, encontrará una explicación de los diversos aspectos de la resistencia de datos en Exchange Online y Microsoft 365.
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: 18d8179f37cb97316b71a43cccfc631a5cc550da
ms.sourcegitcommit: 8634215e257ba2d49832a8f5947700fd00f18ece
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/10/2020
ms.locfileid: "46606616"
---
# <a name="exchange-online-data-resiliency-in-microsoft-365"></a><span data-ttu-id="ef8e9-103">Resistencia de datos de Exchange online en Microsoft 365</span><span class="sxs-lookup"><span data-stu-id="ef8e9-103">Exchange Online Data Resiliency in Microsoft 365</span></span>

<span data-ttu-id="ef8e9-104">Hay dos tipos de daños que pueden afectar a una base de datos de Exchange: los daños físicos, que suelen deberse a problemas de hardware (en particular, del hardware de almacenamiento) y a los daños lógicos, que se producen debido a otros factores.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-104">There are two types of corruption that can affect an Exchange database: physical corruption, which is typically caused by hardware (in particular, storage hardware) problems, and logical corruption, which occurs due to other factors.</span></span> <span data-ttu-id="ef8e9-105">Por lo general, hay dos tipos de daños lógicos que pueden producirse dentro de una base de datos de Exchange:</span><span class="sxs-lookup"><span data-stu-id="ef8e9-105">Generally, there are two types of logical corruption that can occur within an Exchange database:</span></span> 
- <span data-ttu-id="ef8e9-106">**Daño lógico de base** de datos: la suma de comprobación de la página de la base de datos coincide, pero los datos de la página son incorrectos lógicamente.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-106">**Database logical corruption** - The database page checksum matches, but the data on the page is wrong logically.</span></span> <span data-ttu-id="ef8e9-107">Esto puede ocurrir cuando el motor de base de datos (el motor de almacenamiento extensible (ESE)) intenta escribir una página de base de datos y, aunque el sistema operativo devuelve un mensaje de operación correcta, los datos nunca se escriben en el disco o se escriben en el lugar equivocado.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-107">This can occur when the database engine (the Extensible Storage Engine (ESE)) attempts to write a database page and even though the operating system returns a success message, the data is either never written to the disk or it's written to the wrong place.</span></span> <span data-ttu-id="ef8e9-108">Esto se conoce como un *vaciado perdido*.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-108">This is referred to as a *lost flush*.</span></span> <span data-ttu-id="ef8e9-109">ESE incluye numerosas características y protecciones diseñadas para evitar daños físicos en una base de datos y otros escenarios de pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-109">ESE includes numerous features and safeguards that are designed to prevent physical corruption of a database and other data loss scenarios.</span></span> <span data-ttu-id="ef8e9-110">Para evitar que los vaciados perdidos pierdan datos, ESE incluye un mecanismo de detección de vaciado perdido en la base de datos junto con una característica (restauración de una sola página) para corregirlo.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-110">To prevent lost flushes from losing data, ESE includes a lost flush detection mechanism in the database along with a feature (single page restore) to correct it.</span></span> 
- <span data-ttu-id="ef8e9-111">**Almacenar los daños lógicos** : los datos se agregan, eliminan o manipulan de una manera que el usuario no espera.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-111">**Store logical corruption** - Data is added, deleted, or manipulated in a way that the user doesn't expect.</span></span> <span data-ttu-id="ef8e9-112">Normalmente, estos casos son causados por aplicaciones de otros fabricantes.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-112">These cases are generally caused by third-party applications.</span></span> <span data-ttu-id="ef8e9-113">Solo se considera un daño, por lo general, porque el usuario lo ve como un daño.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-113">It's generally only corruption in the sense that the user views it as corruption.</span></span> <span data-ttu-id="ef8e9-114">El almacén de Exchange considera que la transacción que produce los daños de lógica es una serie de operaciones MAPI válidas.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-114">The Exchange store considers the transaction that produced the logical corruption to be a series of valid MAPI operations.</span></span> <span data-ttu-id="ef8e9-115">Las características de [conservación local](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds) de Exchange Online proporcionan protección para almacenar los daños lógicos (porque impide que un usuario o una aplicación eliminen el contenido de forma permanente).</span><span class="sxs-lookup"><span data-stu-id="ef8e9-115">The [In-Place Hold](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds) features in Exchange Online provides protection from store logical corruption (because it prevents content from being permanently deleted by a user or an application).</span></span> 

<span data-ttu-id="ef8e9-116">Exchange Online realiza varias comprobaciones de coherencia en los archivos de registro replicados durante la inspección de registros y la reproducción de registros.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-116">Exchange Online performs several consistency checks on replicated log files during both log inspection and log replay.</span></span> <span data-ttu-id="ef8e9-117">Estas comprobaciones de coherencia impiden que el sistema replique los daños físicos.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-117">These consistency checks prevent physical corruption from being replicated by the system.</span></span> <span data-ttu-id="ef8e9-118">Por ejemplo, durante la inspección de registros, hay una comprobación de integridad física que comprueba el archivo de registro y valida que la suma de comprobación registrada en el archivo de registro coincida con la suma de comprobación generada en la memoria.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-118">For example, during log inspection, there is a physical integrity check which verifies the log file and validates that the checksum recorded in the log file matches the checksum generated in memory.</span></span> <span data-ttu-id="ef8e9-119">Además, se examina el encabezado del archivo de registro para asegurarse de que la firma del archivo de registro registrada en el encabezado del registro coincide con la del archivo de registro.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-119">In addition, the log file header is examined to make sure the log file signature recorded in the log header matches that of the log file.</span></span> <span data-ttu-id="ef8e9-120">Durante la reproducción del registro, el archivo de registro sufre más análisis.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-120">During log replay, the log file undergoes further scrutiny.</span></span> <span data-ttu-id="ef8e9-121">Por ejemplo, el encabezado de la base de datos también contiene la firma del registro que se compara con la firma del archivo de registro para asegurarse de que coinciden.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-121">For example, the database header also contains the log signature which is compared with the log file's signature to ensure they match.</span></span> 

<span data-ttu-id="ef8e9-122">La protección contra daños en los datos de buzones de correo en Exchange Online se consigue mediante el uso de la protección de datos nativa de Exchange, una estrategia de resistencia que aprovecha la replicación en el nivel de la aplicación en varios servidores y varios centros de datos, junto con otras características que ayudan a evitar la pérdida de datos debido a daños o a otros motivos.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-122">Protection against corruption of mailbox data in Exchange Online is achieved by using Exchange Native Data Protection, a resiliency strategy that leverages application-level replication across multiple servers and multiple datacenters along with other features that help protect data from being lost due to corruption or other reasons.</span></span> <span data-ttu-id="ef8e9-123">Estas características incluyen características nativas administradas por Microsoft o la propia aplicación de Exchange Online, como:</span><span class="sxs-lookup"><span data-stu-id="ef8e9-123">These features include native features that are managed by Microsoft or the Exchange Online application itself, such as:</span></span>

- [<span data-ttu-id="ef8e9-124">Grupos de disponibilidad de datos</span><span class="sxs-lookup"><span data-stu-id="ef8e9-124">Data Availability Groups</span></span>](https://docs.microsoft.com/exchange/back-up-email)
- <span data-ttu-id="ef8e9-125">Corrección de bits único</span><span class="sxs-lookup"><span data-stu-id="ef8e9-125">Single Bit Correction</span></span> 
- <span data-ttu-id="ef8e9-126">Análisis de bases de datos en línea</span><span class="sxs-lookup"><span data-stu-id="ef8e9-126">Online Database Scanning</span></span> 
- <span data-ttu-id="ef8e9-127">Detección de vaciado perdida</span><span class="sxs-lookup"><span data-stu-id="ef8e9-127">Lost Flush Detection</span></span> 
- <span data-ttu-id="ef8e9-128">Restauración de una sola página</span><span class="sxs-lookup"><span data-stu-id="ef8e9-128">Single Page Restore</span></span> 
- <span data-ttu-id="ef8e9-129">Servicio de replicación de buzones</span><span class="sxs-lookup"><span data-stu-id="ef8e9-129">Mailbox Replication Service</span></span> 
- <span data-ttu-id="ef8e9-130">Comprobaciones del archivo de registro</span><span class="sxs-lookup"><span data-stu-id="ef8e9-130">Log File Checks</span></span> 
- <span data-ttu-id="ef8e9-131">Implementación en un sistema de archivos resistente</span><span class="sxs-lookup"><span data-stu-id="ef8e9-131">Deployment on Resilient File System</span></span> 

<span data-ttu-id="ef8e9-132">Para obtener más información sobre las características nativas enumeradas anteriormente, haga clic en los hipervínculos anteriores y vea a continuación para obtener información adicional y detalles sobre los elementos sin hipervínculos.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-132">For more information on the native features listed above, click on the above hyperlinks, and see below for additional information and for details on items without hyperlinks.</span></span> <span data-ttu-id="ef8e9-133">Además de estas características nativas, Exchange Online también incluye características de resistencia de datos que los clientes pueden administrar, como:</span><span class="sxs-lookup"><span data-stu-id="ef8e9-133">In addition to these native features, Exchange Online also includes data resiliency features that customers can manage, such as:</span></span> 
- [<span data-ttu-id="ef8e9-134">Recuperación de elemento único (habilitada de forma predeterminada)</span><span class="sxs-lookup"><span data-stu-id="ef8e9-134">Single Item Recovery (enabled by default)</span></span>](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages) 
- [<span data-ttu-id="ef8e9-135">Conservación local y retención por juicio</span><span class="sxs-lookup"><span data-stu-id="ef8e9-135">In-Place Hold and Litigation Hold</span></span>](https://docs.microsoft.com/exchange/security-and-compliance/in-place-and-litigation-holds) 
- [<span data-ttu-id="ef8e9-136">Retención de elementos eliminados y buzones de correo eliminados temporalmente (ambos habilitados de forma predeterminada)</span><span class="sxs-lookup"><span data-stu-id="ef8e9-136">Deleted Item Retention and Soft-Deleted Mailboxes (both enabled by default)</span></span>](https://docs.microsoft.com/exchange/recipients-in-exchange-online/delete-or-restore-mailboxes) 

## <a name="database-availability-groups"></a><span data-ttu-id="ef8e9-137">Grupos de disponibilidad de base de datos</span><span class="sxs-lookup"><span data-stu-id="ef8e9-137">Database Availability Groups</span></span> 
<span data-ttu-id="ef8e9-138">Todas las bases de datos de buzones de correo de Microsoft 365 se hospedan en un [grupo de disponibilidad de base de datos (Dag)](https://docs.microsoft.com/exchange/back-up-email) y se replican en centros de datos independientes geográficamente dentro de la misma región.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-138">Every mailbox database in Microsoft 365 is hosted in a [database availability group (DAG)](https://docs.microsoft.com/exchange/back-up-email) and replicated to geographically-separate datacenters within the same region.</span></span> <span data-ttu-id="ef8e9-139">La configuración más común es cuatro copias de bases de datos en cuatro centros de datos; sin embargo, algunas regiones tienen menos centros de datos (las bases de datos se replican en tres centros de datos en la India y dos centros de datos en Australia y Japón).</span><span class="sxs-lookup"><span data-stu-id="ef8e9-139">The most common configuration is four database copies in four datacenters; however, some regions have fewer datacenters (databases are replicated to three datacenters in India, and two datacenters in Australia and Japan).</span></span> <span data-ttu-id="ef8e9-140">Sin embargo, en todos los casos, todas las bases de datos de buzones tienen cuatro copias que se distribuyen en varios centros de datos, lo que garantiza que los datos del buzón de correo estén protegidos del software, el hardware o incluso los errores del centro de datos.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-140">But in all cases, every mailbox database has four copies that are distributed across multiple datacenters, thereby ensuring that mailbox data is protected from software, hardware, and even datacenter failures.</span></span> 

<span data-ttu-id="ef8e9-141">A partir de estas cuatro copias, tres de ellas están configuradas como de alta disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-141">Out of these four copies, three of them are configured as highly available.</span></span> <span data-ttu-id="ef8e9-142">La cuarta copia se configura como una [copia retrasada](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies)de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-142">The fourth copy is configured as a [lagged database copy](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies).</span></span> <span data-ttu-id="ef8e9-143">La copia de base de datos atrasada no está destinada a la recuperación de buzones individuales o la recuperación de elementos de buzón.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-143">The lagged database copy is not intended for individual mailbox recovery or mailbox item recovery.</span></span> <span data-ttu-id="ef8e9-144">Su objetivo es proporcionar un mecanismo de recuperación para el caso excepcional de que se produzcan daños lógicos catastróficos en todo el sistema.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-144">Its purpose is to provide a recovery mechanism for the rare event of system-wide, catastrophic logical corruption.</span></span> 

<span data-ttu-id="ef8e9-145">Las copias de base de datos atrasadas en Exchange online están configuradas con un tiempo de retardo de reproducción de archivo de registro de siete días.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-145">Lagged database copies in Exchange Online are configured with a seven-day log file replay lag time.</span></span> <span data-ttu-id="ef8e9-146">Además, el administrador de retardo de reproducción de Exchange está habilitado para proporcionar la reproducción dinámica de archivos de registro para las copias retrasadas a fin de permitir copias de bases de datos atrasadas para la reparación automática y la administración del crecimiento del archivo de registro.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-146">In addition, the Exchange Replay Lag Manager is enabled to provide dynamic log file play down for lagged copies to allow lagged database copies to self-repair and manage log file growth.</span></span> <span data-ttu-id="ef8e9-147">Aunque las copias de base de datos retrasadas se usan en Exchange Online, es importante comprender que no son una copia de seguridad de un momento dado garantizado.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-147">Although lagged database copies are used in Exchange Online, it is important to understand that they are not a guaranteed point-in-time backup.</span></span> <span data-ttu-id="ef8e9-148">Las copias de base de datos atrasadas en Exchange Online tienen un umbral de disponibilidad, normalmente alrededor del 90%, debido a que los períodos en los que se pierde el disco que contiene una copia retrasada se pierden debido a un error en el disco, la copia retrasada se convierte en una copia de alta disponibilidad (debido a la reproducción automática), así</span><span class="sxs-lookup"><span data-stu-id="ef8e9-148">Lagged database copies in Exchange Online have an availability threshold, typically around 90%, due to periods where the disk containing a lagged copy is lost due to disk failure, the lagged copy becoming a highly-available copy (due to automatic play down), as well as the periods where the lagged database copy is re-building the log replay queue.</span></span> 

## <a name="transport-resilience"></a><span data-ttu-id="ef8e9-149">Resistencia de transporte</span><span class="sxs-lookup"><span data-stu-id="ef8e9-149">Transport Resilience</span></span> 
<span data-ttu-id="ef8e9-150">Exchange Online incluye dos características principales de resistencia de transporte: la redundancia de instantáneas y la red de seguridad.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-150">Exchange Online includes two primary transport resilience features: Shadow Redundancy and Safety Net.</span></span> <span data-ttu-id="ef8e9-151">La redundancia de instantáneas mantiene una copia redundante de un mensaje mientras está en tránsito.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-151">Shadow Redundancy keeps a redundant copy of a message while it is in transit.</span></span> <span data-ttu-id="ef8e9-152">La red de seguridad mantiene una copia redundante de un mensaje después de que el mensaje se entregue correctamente.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-152">Safety Net keeps a redundant copy of a message after the message is successfully delivered.</span></span> 

<span data-ttu-id="ef8e9-153">Con la redundancia de instantáneas, cada servidor de transporte de Exchange Online hace una copia de cada mensaje que recibe antes de confirmar que recibe correctamente el mensaje al servidor de envío.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-153">With Shadow Redundancy, each Exchange Online transport server makes a copy of each message it receives before it acknowledges successfully receiving the message to the sending server.</span></span> <span data-ttu-id="ef8e9-154">Esto hace que todos los mensajes de la canalización de transporte sean redundantes mientras están en tránsito.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-154">This makes all messages in the transport pipeline redundant while in transit.</span></span> <span data-ttu-id="ef8e9-155">Si Exchange Online determina que el mensaje original se perdió en el tránsito, se entrega una copia redundante del mensaje.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-155">If Exchange Online determines the original message was lost in transit, a redundant copy of the message is redelivered.</span></span> 

<span data-ttu-id="ef8e9-156">Red de seguridad es una cola de transporte que está asociada con el servicio de transporte en un servidor de buzones de correo.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-156">Safety Net is a transport queue that is associated with the Transport service on a Mailbox server.</span></span> <span data-ttu-id="ef8e9-157">Esta cola almacena copias de mensajes correctamente procesados por el servidor.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-157">This queue stores copies of messages that were successfully processed by the server.</span></span> <span data-ttu-id="ef8e9-158">Cuando una base de datos de buzones o un error del servidor requieren activar una copia obsoleta de la base de datos de buzones, los mensajes de la cola de seguridad de la red se reenvían automáticamente a la nueva copia activa de la base de datos de buzones.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-158">When a mailbox database or server failure requires activating an out-of-date copy of the mailbox database, messages in the Safety Net queue are automatically resubmitted to the new active copy of the mailbox database.</span></span> <span data-ttu-id="ef8e9-159">La red de seguridad también es redundante, lo que elimina el transporte como un punto único de error.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-159">Safety Net is also redundant, thereby eliminating transport as a single point of failure.</span></span> <span data-ttu-id="ef8e9-160">Usa el concepto de una red de seguridad principal y una red de seguridad de instantáneas donde la red de seguridad principal no está disponible durante más de 12 horas, las solicitudes de reenvío se convierten en solicitudes de reenvío de instantánea y los mensajes se vuelven a entregar desde la red de seguridad de instantáneas.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-160">It uses the concept of a Primary Safety Net and a Shadow Safety Net wherein if the Primary Safety Net is unavailable for more than 12 hours, resubmit requests become shadow resubmit requests, and messages are re-delivered from the Shadow Safety Net.</span></span>

<span data-ttu-id="ef8e9-161">Los reenvíos de mensajes desde la red de seguridad se inician automáticamente mediante el componente Active Manager del servicio de replicación de Microsoft Exchange que administra los Dag y las copias de bases de datos de buzones.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-161">Message resubmissions from Safety Net are automatically initiated by the Active Manager component of the Microsoft Exchange Replication service that manages DAGs and mailbox database copies.</span></span> <span data-ttu-id="ef8e9-162">No se requiere ninguna acción manual para reenviar mensajes desde la red de seguridad.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-162">No manual actions are required to resubmit messages from Safety Net.</span></span> 

## <a name="single-bit-correction"></a><span data-ttu-id="ef8e9-163">Corrección de bits único</span><span class="sxs-lookup"><span data-stu-id="ef8e9-163">Single Bit Correction</span></span> 
<span data-ttu-id="ef8e9-164">ESE incluye un mecanismo para detectar y resolver errores CRC de un solo bit (también conocidos como volteo de un bit) que son el resultado de errores de hardware (y, como tal, representan daños físicos).</span><span class="sxs-lookup"><span data-stu-id="ef8e9-164">ESE includes a mechanism to detect and resolve single-bit CRC errors (aka single-bit flips) that are the result of hardware errors (and as such they represent physical corruption).</span></span> <span data-ttu-id="ef8e9-165">Cuando se producen estos errores, ESE los corrige automáticamente y registra un evento en el registro de eventos.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-165">When these errors occur, ESE automatically corrects them and logs an event in the event log.</span></span> 

## <a name="online-database-scanning"></a><span data-ttu-id="ef8e9-166">Análisis de bases de datos en línea</span><span class="sxs-lookup"><span data-stu-id="ef8e9-166">Online Database Scanning</span></span> 
<span data-ttu-id="ef8e9-167">El análisis de base de datos en línea (también conocido como suma de comprobación de *base de datos*) es el proceso en el que ese usa un comprobador de coherencia de la base de datos para leer cada página y comprobar si hay errores</span><span class="sxs-lookup"><span data-stu-id="ef8e9-167">Online database scanning (also known as *database checksumming*) is the process where an ESE uses a database consistency checker to read each page and check for page corruption.</span></span> <span data-ttu-id="ef8e9-168">El objetivo principal es detectar daños físicos y vaciados perdidos que podrían no ser detectados por operaciones transaccionales.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-168">The primary purpose is to detect physical corruption and lost flushes that may not be getting detected by transactional operations.</span></span> <span data-ttu-id="ef8e9-169">El análisis de bases de datos también realiza operaciones de bloqueo posterior a la tienda.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-169">Database scanning also performs post-store crash operations.</span></span> <span data-ttu-id="ef8e9-170">El espacio se puede perder debido a bloqueos y el análisis de base de datos en línea busca y recupera el espacio perdido.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-170">Space can be leaked due to crashes, and online database scanning finds and recovers lost space.</span></span> <span data-ttu-id="ef8e9-171">El sistema está diseñado pensando en que todas las bases de datos se digitalizan completamente una vez cada siete días.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-171">The system is designed with the expectation that every database is fully scanned once every seven days.</span></span> 

## <a name="lost-flush-detection"></a><span data-ttu-id="ef8e9-172">Detección de vaciado perdida</span><span class="sxs-lookup"><span data-stu-id="ef8e9-172">Lost Flush Detection</span></span> 
<span data-ttu-id="ef8e9-173">Un vaciado perdido se produce cuando una operación de escritura de base de datos que el subsistema de disco o el sistema operativo devolvió como completada no se escribió en el disco o se escribió en una ubicación incorrecta.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-173">A lost flush occurs when a database write operation that the disk subsystem/operating system returned as completed did not actually get written to disk, or was written in the wrong location.</span></span> <span data-ttu-id="ef8e9-174">Las incidencias de vaciado perdidas pueden resultar en daños lógicos de base de datos, por lo que, para evitar que los vaciados perdidos provoquen pérdida de datos, ESE incluye un mecanismo de detección de vaciado perdido.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-174">Lost flush incidents can result in database logical corruption, so to prevent lost flushes from resulting in lost data, ESE includes a lost flush detection mechanism.</span></span> <span data-ttu-id="ef8e9-175">A medida que las páginas de base de datos se escriben en copias pasivas, se realiza una comprobación de los vaciados perdidos en la copia activa.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-175">As database pages are written to passive copies, a check is performed for lost flushes on the active copy.</span></span> <span data-ttu-id="ef8e9-176">Si se detecta un vaciado perdido, ESE puede reparar el proceso mediante un proceso de revisión de página.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-176">If a lost flush is detected, ESE can repair the process using a page patching process.</span></span> 

## <a name="single-page-restore"></a><span data-ttu-id="ef8e9-177">Restauración de una sola página</span><span class="sxs-lookup"><span data-stu-id="ef8e9-177">Single Page Restore</span></span> 
<span data-ttu-id="ef8e9-178">La restauración de página única, aka *Page Patching*, es un proceso automático en el que las páginas de base de datos dañadas se reemplazan por copias en buen estado de una réplica en buen estado.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-178">Single page restore, aka *page patching*, is an automatic process where corrupt database pages are replaced by healthy copies from a healthy replica.</span></span> <span data-ttu-id="ef8e9-179">El proceso de reparación de una página dañada depende de si la copia de la base de datos está activa o pasiva.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-179">The repair process for a corrupt page depends on whether the database copy is active or passive.</span></span> <span data-ttu-id="ef8e9-180">Cuando una copia de base de datos activa encuentra una página dañada, puede copiar una página de una de sus réplicas, siempre que la página que copie esté completamente actualizada.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-180">When an active database copy encounters a corrupted page, it can copy a page from one of its replicas, provided the page it copies is completely up-to-date.</span></span> <span data-ttu-id="ef8e9-181">Esto se consigue al colocar una solicitud para la página en la secuencia de registro, que es la base de la replicación de la base de datos de buzones.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-181">This is accomplished by putting a request for the page into the log stream, which is the basis of mailbox database replication.</span></span> <span data-ttu-id="ef8e9-182">En cuanto una réplica detecta la solicitud de la página, le responde enviando una copia de la página a la copia de la base de datos solicitante.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-182">As soon as a replica encounters the page request it responds by sending a copy of the page to the requesting database copy.</span></span> <span data-ttu-id="ef8e9-183">La restauración de página única también proporciona un mecanismo de comunicación asincrónica del activo para solicitar una página de las réplicas, incluso si las réplicas están actualmente sin conexión.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-183">Single page restore also provides an asynchronous communication mechanism for the active to request a page from replicas, even if the replicas are currently offline.</span></span> 

<span data-ttu-id="ef8e9-184">En caso de que se dañe una copia de base de datos pasiva, incluida una copia de base de datos atrasada, ya que estas copias siempre están detrás de su copia activa, siempre es seguro copiar cualquier página de la copia activa a una copia pasiva.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-184">In case of corruption in a passive database copy, including a lagged database copy, because these copies are always behind their active copy, it is always safe to copy any page from the active copy to a passive copy.</span></span> <span data-ttu-id="ef8e9-185">Una copia de base de datos pasiva es, por naturaleza, altamente disponible, por lo que, durante el proceso de revisión de página, se suspende la reproducción de registros, pero la copia de registros sigue.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-185">A passive database copy is by nature highly available, so during the page patching process, log replaying is suspended, but log copying continues.</span></span> <span data-ttu-id="ef8e9-186">La copia pasiva de la base de datos recupera una copia de la página dañada de la copia activa, espera hasta que se copie e inspeccione el archivo de registro que cumpla el requisito de generación de registro máximo necesario y, a continuación, se revisa la página dañada.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-186">The passive database copy retrieves a copy of the corrupted page from the active copy, waits until the log file which meets the maximum required log generation requirement is copied and inspected, and then patches the corrupt page.</span></span> <span data-ttu-id="ef8e9-187">Una vez que se ha aplicado la revisión a la página, se reanuda la reproducción del registro.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-187">Once the page has been patched, log replay resumes.</span></span> <span data-ttu-id="ef8e9-188">El proceso es el mismo para la copia retrasada de la base de datos, excepto en que la base de datos atrasada reproduce primero todos los archivos de registro que son necesarios para lograr un estado revisable.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-188">The process is the same for the lagged database copy, except that the lagged database first replays all log files that are necessary to achieve a patchable state.</span></span> 

## <a name="mailbox-replication-service"></a><span data-ttu-id="ef8e9-189">Servicio de replicación de buzones</span><span class="sxs-lookup"><span data-stu-id="ef8e9-189">Mailbox Replication Service</span></span> 
<span data-ttu-id="ef8e9-190">Mover buzones es una parte fundamental de la administración de un servicio de correo electrónico a gran escala.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-190">Moving mailboxes is a key part of managing a large-scale email service.</span></span> <span data-ttu-id="ef8e9-191">Siempre se actualizan las tecnologías y las actualizaciones de hardware y versiones, así que tener un sistema sólido y reducido que permita a nuestros ingenieros realizar este trabajo mientras se mantiene el buzón de correo se mueve transparente a los usuarios (al asegurarse de que permanecen en línea durante todo el proceso) es clave y se asegura de que el proceso se escale correctamente a medida que los buzones se agrandan.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-191">There are always updated technologies and hardware and version upgrades to deal with, so having a robust, throttled system that enables our engineers to accomplish this work while keeping the mailbox moves transparent to users (by making sure they stay online throughout the process) is key and making sure that the process scales up gracefully as mailboxes get larger and larger.</span></span> 

<span data-ttu-id="ef8e9-192">El servicio de replicación de buzones de correo de Exchange (MRS) es responsable de mover buzones entre bases de datos.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-192">The Exchange Mailbox Replication Service (MRS) is responsible for moving mailboxes between databases.</span></span> <span data-ttu-id="ef8e9-193">Durante el movimiento, MRS realiza una comprobación de coherencia en todos los elementos del buzón.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-193">During the move, MRS performs a consistency check on all items within the mailbox.</span></span> <span data-ttu-id="ef8e9-194">Si se encuentra un problema de coherencia, MRS corregirá el problema o pasará por alto los elementos dañados, con lo que se quitará el daño del buzón.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-194">If a consistency issue is found, MRS will either correct the problem, or skip the corrupted items, thereby removing the corruption from the mailbox.</span></span> 

<span data-ttu-id="ef8e9-195">Como MRS es un componente de Exchange Online, podemos realizar cambios en su código para solucionar nuevas formas de daños que se detectan en el futuro.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-195">Because MRS is a component of Exchange Online, we can make changes in its code to address new forms of corruption that are detected in the future.</span></span> <span data-ttu-id="ef8e9-196">Por ejemplo, si se detecta un problema de coherencia que MRS no puede corregir, podemos analizar el daño, cambiar el código MRS y corregir la incoherencia (si sabemos cómo).</span><span class="sxs-lookup"><span data-stu-id="ef8e9-196">For example, if we detect a consistency issue that MRS is not able to fix, we can analyze the corruption, change the MRS code and correct the inconsistency (if we understand how to).</span></span> 

## <a name="log-file-checks"></a><span data-ttu-id="ef8e9-197">Comprobaciones del archivo de registro</span><span class="sxs-lookup"><span data-stu-id="ef8e9-197">Log File Checks</span></span> 
<span data-ttu-id="ef8e9-198">Todos los archivos de registro de transacciones generados por una base de datos de Exchange experimentan varias formas de comprobaciones de coherencia.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-198">All transaction log files generated by an Exchange database undergo several forms of consistency checks.</span></span> <span data-ttu-id="ef8e9-199">Cuando se crea un archivo de registro, lo primero que debe hacer es escribir un patrón de bits y, a continuación, se realiza una serie de escrituras en el registro.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-199">When a log file is created, the first thing done is a bit pattern is written and then a series of log writes is performed.</span></span> <span data-ttu-id="ef8e9-200">Esto permite a Exchange Online ejecutar una serie de comprobaciones (vaciado perdido, CRC y otras comprobaciones) para validar cada archivo de registro a medida que se escribe y de nuevo cuando se replica.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-200">This enables Exchange Online to execute a series of checks (lost flush, CRC and other checks) to validate each log file as it is written, and again as it is replicated.</span></span> 

## <a name="deployment-on-resilient-file-system"></a><span data-ttu-id="ef8e9-201">Implementación en un sistema de archivos resistente</span><span class="sxs-lookup"><span data-stu-id="ef8e9-201">Deployment on Resilient File System</span></span> 
<span data-ttu-id="ef8e9-202">Para ayudar a evitar que se produzcan daños en el nivel del sistema de archivos, Exchange Online se está implementando en particiones del sistema de archivos resistente (ReFS) para proporcionar funciones de recuperación mejoradas.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-202">To help prevent corruption from occurring at the file system level, Exchange Online is being deployed on Resilient File System (ReFS) partitions to provide improved recovery capabilities.</span></span> <span data-ttu-id="ef8e9-203">ReFS es un sistema de archivos en Windows Server 2012 y versiones posteriores diseñado para ser más resistente contra daños en los datos, lo que maximiza la disponibilidad e integridad de los datos.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-203">ReFS is a file system in Windows Server 2012 and later that is designed to be more resilient against data corruption thereby maximizing data availability and integrity.</span></span> <span data-ttu-id="ef8e9-204">Concretamente, ReFS incorpora mejoras en la forma en que se actualizan los metadatos, lo que ofrece una mejor protección para los datos y reduce los casos de corrupción de datos.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-204">Specifically, ReFS brings improvements in the way that metadata is updated which offers better protection for data and reduces data corruption cases.</span></span> <span data-ttu-id="ef8e9-205">También usa las sumas de comprobación para comprobar la integridad de los datos de archivo y los metadatos, lo que garantiza que se encuentren y reparen fácilmente los datos dañados.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-205">It also uses checksums to verify the integrity of file data and metadata ensuring that data corruption is easily found and repaired.</span></span> 

<span data-ttu-id="ef8e9-206">Exchange Online aprovecha varias ventajas de ReFS:</span><span class="sxs-lookup"><span data-stu-id="ef8e9-206">Exchange Online takes advantage of several ReFS benefits:</span></span> 
- <span data-ttu-id="ef8e9-207">Una mayor resistencia en la integridad de los datos significa menos incidentes de daños en los datos.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-207">More resiliency in data integrity means fewer data corruption incidents.</span></span> <span data-ttu-id="ef8e9-208">La reducción del número de incidentes de daños implica menos reinicializaciones de base de datos innecesarias.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-208">Reducing the number of corruption incidents means fewer unnecessary database reseeds.</span></span> 
- <span data-ttu-id="ef8e9-209">La suma de comprobación que se ejecuta en los metadatos permite detectar casos de daños de forma rápida y más determinista, lo que nos permite corregir los daños en los datos del cliente antes de que ocurran errores en gris en los volúmenes de datos.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-209">Checksum running on metadata enabling detections of corruption cases sooner and more deterministically, allowing us to fix customer data corruption before grey failures occur on data volumes.</span></span>
- <span data-ttu-id="ef8e9-210">Diseñado para funcionar correctamente con conjuntos de datos extremadamente grandes (petabytes y más grandes) sin impacto en el rendimiento</span><span class="sxs-lookup"><span data-stu-id="ef8e9-210">Designed to work well with extremely large data sets—petabytes and larger—without performance impact</span></span>
- <span data-ttu-id="ef8e9-211">Compatibilidad con otras características usadas por Exchange Online, como el cifrado de BitLocker.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-211">Support for other features used by Exchange Online, such as BitLocker encryption.</span></span> 

<span data-ttu-id="ef8e9-212">Exchange Online también se beneficia de otras características de ReFS:</span><span class="sxs-lookup"><span data-stu-id="ef8e9-212">Exchange Online also benefits from other ReFS features:</span></span> 
- <span data-ttu-id="ef8e9-213">**Integridad (secuencias de integridad)** : ReFS almacena los datos de una manera que los protege de muchos de los errores comunes que normalmente pueden provocar la pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-213">**Integrity (Integrity Streams)** - ReFS stores data in a way that protects it from many of the common errors that can normally cause data loss.</span></span> <span data-ttu-id="ef8e9-214">Microsoft 365 Search usa secuencias de integridad para ayudar con la detección de daños en el disco inicial y las sumas de comprobación del contenido de los archivos.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-214">Microsoft 365 Search uses Integrity Streams to help with early disk corruption detection and checksums of file content.</span></span> <span data-ttu-id="ef8e9-215">La característica también reduce los incidentes de daños causados por "escrituras incompletas" (cuando una operación de escritura no se completa debido a interrupciones de energía, etc.).</span><span class="sxs-lookup"><span data-stu-id="ef8e9-215">The feature also reduces corruption incidents caused by “Torn Writes” (when a write operation does not complete due to power outages, etc.).</span></span> 
- <span data-ttu-id="ef8e9-216">**Availability (Valor_residual)** : ReFS da prioridad a la disponibilidad de los datos.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-216">**Availability (Salvage)** - ReFS prioritizes the availability of data.</span></span> <span data-ttu-id="ef8e9-217">Históricamente, los sistemas de archivos solían ser susceptibles de daños en los datos, lo que requeriría que el sistema se desconectase para su reparación.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-217">Historically, file systems were often susceptible to data corruption that would require the system to be taken offline for repair.</span></span> <span data-ttu-id="ef8e9-218">Aunque rara vez se produce algún daño, ReFS implementa Salvage, una característica que elimina los datos dañados del espacio de nombres en un volumen activo y garantiza que los datos correctos no se ven perjudicados por los datos no reparables.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-218">Although rare, if corruption does occur, ReFS implements salvage, a feature that removes the corrupt data from the namespace on a live volume and ensures that good data is not adversely affected by non-repairable corrupt data.</span></span> <span data-ttu-id="ef8e9-219">La aplicación de la característica de recuperación y el aislamiento de los datos dañados para los volúmenes de bases de datos de Exchange Online significa que podemos mantener las bases de datos no afectadas en un volumen dañado en buen estado entre el momento de la corrupción y la acción de reparación.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-219">Applying the Salvage feature and isolating data corruption to Exchange Online database volumes means that we can keep non-affected databases on a corrupted volume healthy between the time of corruption and repair action.</span></span> <span data-ttu-id="ef8e9-220">Esto aumenta la disponibilidad de las bases de datos que normalmente se verían afectadas por problemas de daños en el disco.</span><span class="sxs-lookup"><span data-stu-id="ef8e9-220">This increases the availability of databases that would normally be affected by such disk corruption issues.</span></span> 